/*
 * Copyright (C) 2012, Nokia gate5 GmbH Berlin
 *
 * These coded instructions, statements, and computer programs contain
 * unpublished proprietary information of Nokia gate5 GmbH, and are
 * copy protected by law. They may not be disclosed to third parties
 * or copied or duplicated in any form, in whole or in part, without
 * the specific, prior written permission of Nokia gate5 GmbH.
 */
(function(g,a,c,f,d){var b=d.call([]);if(!g.isArray)g.isArray=function(e){return d.call(e)===b};if(!c.trim)c.trim=function(){return this.replace(/^\s*/,"").replace(/\s*$/,"")};if(!a.bind)a.bind=function(b){var h=this,a;return 1<arguments.length?(a=f.call(arguments,1),function(){return h.apply(b,arguments.length?a.concat(f.call(arguments)):a)}):function(){return arguments.length?h.apply(b,arguments):h.call(b)}};window.history.pushState||function(b,h){function a(b,e,d,c){history_js.setStorage(d,{state:b,
title:e});history_js.hash=d;c?(d||(d=h.hash||"#"),h.replace(d)):h.hash=d}if(!("pushState"in b.history))history_js={},"sessionStorage"in b&&b.JSON?(history_js.setStorage=function(h,a){b.sessionStorage[h]=JSON.stringify(a)},history_js.getStorage=function(h){return b.sessionStorage[h]?JSON.parse(b.sessionStorage[h]):void 0}):(history_js.fake_storage={},history_js.setStorage=function(b,h){history_js.fake_storage[b]=h},history_js.getStorage=function(b){return history_js.fake_storage[b]}),b.history.pushState=
function(b,h,e){a(b,h,e,!1)},b.history.replaceState=function(b,h,e){a(b,h,e,!0)},history_js.hashchange=function(){var a=h.hash;if(a!==history_js.hash)history_js.hash=a,a=history_js.hash?history_js.getStorage(history_js.hash):{},"onpopstate"in b&&"function"===typeof b.onpopstate&&b.onpopstate.apply(b,[{state:a?a.state:null}])},"onhashchange"in b?b.onhashchange=history_js.hashchange:history_js.hashInterval=setInterval(function(){h.hash!==history_js.hash&&history_js.hashchange()},100),h.hash&&history_js.hashchange()}(window,
document.location)})(Array,Function.prototype,String.prototype,[].slice,{}.toString);
(function(){if(!this.nokia||!this.nokia.mh5){var g={},a={},c=c||this.mh5Config||{};nokia=this.nokia||{};nokia.mh5=this.nokia.mh5={assetsPath:"",win:c.win||this,doc:c.doc||this.document,modulePaths:c.modulePaths||{},buildNS:function(a){var f;for(var a=a.split("."),d=0,b=nokia.mh5.win,e;e=a[d++];)f=b[e]=b[e]||{isNs:!0},b=f;return b},provide:function(c){a[c]=1;return nokia.mh5.buildNS(c)},require:function(c){if(a[c])return nokia.mh5.resolve(c);if(g[c])throw Error("Circular Reference in require chain: "+
g);g[c]=1;nokia.mh5.buildNS(c);var d=nokia.mh5.getLoadPath(c);try{nokia.mh5._getScript(d)}catch(b){throw Error("Could not load "+c+", reason: "+b.message);}finally{delete g[c]}a[c]||(a[c]=1);return nokia.mh5.resolve(c)},_getScript:function(a){var d=new XMLHttpRequest;d.open("GET",a,!1);d.send(null);var b=d.status;if(!(!b&&location&&"file:"===location.protocol||200<=b&&300>b||304===b||1223===b||0===b))throw Error("Unable to load "+a+" status: "+d.status);return nokia.mh5.win.eval(d.responseText)},
getLoadPath:function(a,d){var b=nokia.mh5.modulePaths[a];if(!b)for(var e=a.split("."),h=e.pop(),c=[];e.length;){b=e.join(".");if(b=nokia.mh5.modulePaths[b]){b+=c.join("/");b+="/"!==b.charAt(b.length-1)?"/"+h:h;break}c.splice(0,0,e.pop())}return b+("."+(d||"js"))}};nokia.mh5.modulePaths["nokia.mh5"]=nokia.mh5.modulePaths["nokia.mh5"]||function(){for(var a=document.getElementsByTagName("script"),d=0,b=/(^|\/|\\)core[\.\w]*?\.js$/i,e="",h,c,m;h=a[d++];)if(h=h.src||"",c=h.match(b)){if(-1===h.indexOf("://")){e=
nokia.mh5.win.location.href;m=e.indexOf("#");var g=e.indexOf("?");m=m>g&&-1<g?g:m;e=-1<m?e.substring(0,m):e;e=e.substring(0,e.lastIndexOf("/")+1)}m=e+h.substring(0,c.index);m="/"===m.charAt(m.length-1)?m:m+"/"}return m}()}}).call(this);
nokia.mh5.each=function(g,a,c){if(!g)return null;var f=0,d=g.length,b,c=c||g;if("number"!==typeof d||"[object Object]"===Object.prototype.toString.call(g)&&!(d-1 in g))for(b in g){if(g.hasOwnProperty(b)&&!1===a.call(c,g[b],b,g))break}else for(b=g[0];f<d&&!1!==a.call(c,b,f,g);b=g[++f]);return g};
nokia.mh5.extend=function(g,a){for(var c=Object,f=c.defineProperty,d=c.getOwnPropertyNames,c=c.getOwnPropertyDescriptor,b=[].slice.call(arguments,1),e=0,h=b.length,j,m,p,o,q;e<h;++e)for(a=b[e],o=a?d(a):[],j=0,m=o.length;j<m;++j)p=o[j],(q=c(a,p))?q.enumerable&&("function"!==typeof a||"prototype"!==p)&&f(g,p,q):g[p]=a[p];return g};
nokia.mh5.extendDeep=function(g,a){for(var c in a)if(a.hasOwnProperty(c))if(a[c]&&g[c]&&"object"===typeof g[c]&&!Array.isArray(g[c])){var f=g[c];g[c]={};nokia.mh5.extend(g[c],f);nokia.mh5.extendDeep(g[c],a[c])}else a[c]&&"object"===typeof a[c]&&!Array.isArray(a[c])?(g[c]={},nokia.mh5.extendDeep(g[c],a[c])):g[c]=a[c];return g};
nokia.mh5.type=function(g){return null===g&&"null"||void 0===g&&"undefined"||g.callee&&"arguments"||"object"===typeof g&&"number"===typeof g.length&&!g.propertyIsEnumerable("length")&&"array"||g instanceof Date&&"date"||typeof g};nokia.mh5.resolve=function(g,a){a=a||nokia.mh5.win;return!g?a:g.split(".").reduce(function(a,f){return a&&a[f]},a)};
nokia.mh5.Class=function(g){function a(a,m){var g=!m,o;g?m=typeof a===e?a():a:typeof m===e&&(m=m(a[d]));o=h.call(m,f)?m[f]:!g?function(){a.apply(this,arguments)}:function(){};g?(c.prototype=m,o[d]=new c):(nokia.mh5.extend(o,a),c[d]=a[d],nokia.mh5.extend(o[d]=new c,m));o[d][f]=o;h.call(m,b)&&nokia.mh5.extend(o,m[b]);return o}var c=function(){},f="constructor",d="prototype",b="statics",e="function",h=g.Object[d].hasOwnProperty;a[d]=g.Function[d];return a}(this);nokia.mh5.buildNS("nokia.mh5.i18n_languages");
nokia.mh5.i18n_languages.en={"Error.applicationCredential":"appId or appCode are missing. Please apply for api credentials at http://nka.fi/EvZeT","Error.controlProperty":"Control property is not defined","Error.prepareBindings":"%value% can't be bound because %snmspa% can't be resolved","Error.propertyCannotBeOverwritten":"Property: '%name%' cannot be overwritten","Error.customContentNotAllowed":"You can't use custom content with the name %name% because it's already in use","Error.unableToRemove":"Removing '%name%' is not possible",
"Error.routeTooLong":"Walking routes aren't available for routes longer than %maxWalkingDistance%.","Warning.placeId":"`id` property in place object was changed to `placeId`","Notification.addedToFavourites":"Added to your Favourites","Notification.cantFindLocation":"Can't find your location. Please enter your starting point above.","Notification.connectionError":"Connection error. Please try again later.","Notification.destInWalkingDistance":"Destination is in walking distance.","Notification.error":"An error occurred",
"Notification.favouritesNoSaved":"Favourite cannot be saved","Notification.goOnline":"Go online to search for places and addresses.","Notification.goOnlineForRouting":"Go online to use the routing service.","Notification.goOnlinePlaceHolder":"Go online to search...","Notification.lookingForCurrentPosition":"Looking for your current position...","Notification.noGPSSignal":"GPS signal lost","Notification.noModeAvailable":"%mode% mode is unavailable.","Notification.noPublicTransportService":"Public transport routing is not available for this area.",
"Notification.noResult":"No results","Notification.noResultFound":"No results found","Notification.noRoutingService":"Routing service is currently unavailable. Please try again later.","Notification.offRoute":"You seem to be off route by %value%","Notification.placeRemovedByOwner":"Sorry.<br>We don't have any information about this place anymore.","Notification.placeError":"Sorry.<br>An error occured while loading the place.<br>Please try again later.","Notification.positionNotAvailable":"Your current location is not available.",
"Notification.removedFromFavourites":"Removed from your Favourites","Notification.routeCalculation":"Calculating route...","Notification.searchProblem":"There's a problem at the moment. Please try searching again later.","Notification.serverError":"Server error. Please try again later.","Notification.unableToLoadImage":"The image could not be loaded. Sorry!","Notification.trafficInBeta":"Traffic view is still in beta.",eating:"Eating out",shopping:"Shopping","going-out":"Going out",sights:"Sights",
maps:"Maps",layers:"Layers",mapControl:"Map control",mapTermsOfUse:"Terms of Use",about:"About",beta:"beta",basic:"basic",businessOwner:"Business Owner",call:"Call",cancel:"Cancel",done:"Done",favourite:"Favourite",favourites:"Favourites",feedback:"Feedback",from:"From",guides:"Guides",highest:"highest",hr:"hr",min:"min",km:"km",location:"location",minApprox:"min approx",more:"More",nearbyPlaces:"Nearby places",ok:"Ok",place:"place",refresh:"Refresh",retry:"Retry",reviews:"Reviews",route:"Route",
save:"Save",search:"Search",searchPlaces:"Search for places",searching:"Searching",send:"Send",sending:"Sending",signin:"Sign in",signout:"Sign out",share:"Share",source:"Source",start:"Start",submit:"Submit",take:"Take",hi:"Hi %name%!",thankYou:"Thank you.",to:"To",towards:"towards",web:"Web",welcome:"Welcome!",sms:"SMS",tel:"tel",email:"Email",shareVia:"share via",imagesProvidedBy:"Images provided by: ",contentProvidedBy:"Content provided by: ",openingTimes:"Opening hours",placeDescription:"Place description",
followFor:"Follow for",saveMapArea:"Save a map area",paymentMethods:"Payment methods",PT:"Public Transport",addingA:"Adding a",removingA:"Removing a",currentLocation:"Current location",messageHere:"Message here",shareAPlace:"Share a place","EP.idLikeTo":"I'd like to share a","EP.linkWithYou":"link with you via Nokia Maps","SMS.plsEnterNum":"Please enter the recipient's mobile number<br />(in international format, e.g. +441234567890)","SMS.plsCheckNum":"Please check the phone number format.","SMS.alsoShort":"You can also add a short personal message (optional):",
"SMS.enterCaptcha":"Enter here the characters you see here into the box below.","SMS.wrongCaptcha":"Something went wrong with the security code. Please try again.","SMS.enterCode":"Enter the code here","SMS.unableToSend":"The message could not be sent. Please try again later.","FV.startSaving":"Start saving them now","FV.startSavingHint":"The places you love are at your fingertips when you add them to your Favourites","FV.takeAllFavourites":"Sign in and take your Favourites with you","FV.simplyTap":"Simply tap the blue star on the Place details page.",
"FV.tapTheHighlighted":"Tap the yellow star and the Place is no longer in your list.","FV.syncing":"Syncing...","FV.syncedFavourites":"Everything is synced.","FV.addedButUnsyncedFavourites":"Added but not yet synced.","FV.addedNotSignedIn":"Added to Favourites.","FV.addedSignedIn":"Added to Favourites and syncing...","FV.removedNotSignedIn":"Removed from Favourites.","FV.removedSignedIn":"Removed from Favourites and syncing...","FV.signInToSyncronize":"Sign in to sync.","FV.couldNotSync":"Could not sync.",
"RA.arriveAt":"Arrive at","RA.departFrom":"Depart from","RA.drive":"drive","RA.walk":"walk","RA.walkTo":"Walk to","UI.SettingsDialog.mapView":"Map view","UI.SettingsDialog.satView":"Satellite view","UI.SettingsDialog.PTView":"Public transport view","UI.SettingsDialog.trafficView":"Live traffic view","UI.SettingsDialog.Km":"Kilometres","UI.SettingsDialog.Miles":"Miles","UI.SettingsDialog.Accidents":"Accidents","UI.SettingsDialog.Congestions":"Congestions","UI.SettingsDialog.Constructions":"Constructions",
"UI.SettingsDialog.Others":"Other","maps.BP.bookmark":"To get the most from Nokia Maps, add our app as a bookmark to your home screen.","maps.BP.install":"To install the app, tap the button %dir% and then 'Add to Home Screen'.","maps.CVD.details":"Level of detail you can expect:","maps.CVD.viewDetails":"Level of detail in current view:","maps.CVD.tooLarge":"This area is too large. Pan and zoom to centre on the neighbourhood you want to save.","maps.CVD.goOnline":"You have to go online to save the map.",
"maps.CVD.rangeOfDetails":"Here's the range of detail you can see in saved map areas. Keep in mind, the more detail you want, the smaller the area of your map.","maps.CVD.world":"Basic details","maps.CVD.country":"Some details","maps.CVD.city":"Average details","maps.CVD.district":"Lots of details","maps.CVD.street":"Maximum details","maps.CVD.worldDesc":"See continents, countries, cities, motorways, road numbers and forests","maps.CVD.countryDesc":"See countries, cities, districts, motorways, main streets, road numbers, airports, forests and lakes",
"maps.CVD.cityDesc":"See cities, districts, detailed street grids, railways &amp; stations, major public transport, parks and lakes","maps.CVD.districtDesc":"See districts, more detailed street grids, railways, all public transport, buildings, parks and paths","maps.CVD.streetDesc":"See all streets and names, railways, all public transport, all buildings, parks and paths","maps.SPD.startDownload":"Start your download","maps.SPD.savingArea":"Saving your map area","maps.SPD.instructionStart":"Map downloads can be large, so remember to use Wi-Fi.<br><br>Don't close this app while saving your map, and make sure your screensaver doesn't switch on.",
"maps.SPD.instructionLoad":"Map downloads can be large, so remember to use Wi-Fi.<br><br>Don't close this app while saving your map, and make sure your screensaver doesn't switch on.","maps.SPD.instructionFinished":"Your map's been saved.<br>You can find it now in your springboard.<br><br><span style='font-weight: bold'>Keep in mind that saving a new map area always replaces the last one you saved.</span>","maps.SPD.keepInMind":"Keep in mind that saving a new map area always replaces the last one you saved.",
"maps.SPD.minZoom":"Your min zoom level","maps.SPD.maxZoom":"Your max zoom level","maps.SPD.waiting":"Waiting for download to start...","maps.SPD.smtUnexpected":"Something unexpected happened during the download.","maps.SB.saveMap":"Save a map area","maps.SB.viewMap":"View your saved map","maps.NPS.recommend":"How likely are you to recommend Nokia Maps to a friend or colleague?","maps.NPS.notLikely":"Not at all likely","maps.NPS.extremelyLikely":"Extremely likely","maps.NPS.why":"Please tell us why you gave this score:",
"maps.NPS.enterMessage":"Enter message here...","maps.NPS.NPP":'Your information will be treated according to the <a href="http://nokia.mobi/privacy/policy" target="blank">Nokia Privacy Policy</a>.',"maps.NPS.noSend":"Unable to send. Please try again.","maps.Nav.headDirectionforDistance":"Head %direction% for %distance%","maps.Nav.reachedDestination":"You have reached your destination","maps.Nav.speeding":"Speed too high for walking mode. Navigation will continue when speed has decreased.","maps.Nav.tryAgain":"There was a problem downloading",
"maps.Nav.disclaimerTitle":"Using audio directions","maps.Nav.disclaimerPoint1":"Be aware of your surroundings and keep an eye open for cars and other urban challenges.","maps.Nav.disclaimerPoint2":"Make sure your phone's display doesn't go dark, you might not be able to hear the navigation instructions clearly. To use the service, you need to download the voice instructions (1.9MB).","maps.Nav.disclaimerPoint3":"Using Nokia services may involve large amounts of data moving through your service provider's network. Not all services may be available or 100% accurate all the time. Using this service could also involve sending information about your location.",
"maps.Nav.disclaimerPoint4":'By tapping \u201cLoad audio\u201d you confirm that you have read and agreed to the <a href="http://nokia.mobi/privacy/services/terms/nokia-service" onclick="event.stopPropagation();" target="blank">Nokia Service Terms</a> and <a href="http://nokia.mobi/privacy/policy" onclick="event.stopPropagation();" target="blank">Privacy Policy</a>. For more information <a href="http://nokia.mobi/privacy/services/map-apps" onclick="event.stopPropagation();" target="blank">click here</a>.',
"maps.Nav.success":"Download finished","maps.Nav.load":"Load audio","maps.Nav.start":"Start journey","maps.Traffic.incidentDescription":"on %origin% towards %direction%","maps.Traffic.incidentDescriptionNoDirection":"on %origin%","maps.Traffic.incidentAt":"at %start%","maps.Traffic.incidentUnidir":"from %start% to %end%","maps.Traffic.incidentBidir":"between %start% and %end%","maps.Traffic.incidentStartTime":"Start time","maps.Traffic.incidentEndTime":"Estimated end time","maps.Traffic.incidentDateFormat":"%month%/%day%/%year% %hour%:%minute%",
"maps.Traffic.criticalityTitle":"Criticality","maps.Traffic.critical":"Critical","maps.Traffic.major":"Major","maps.Traffic.minor":"Minor"};nokia.mh5.provide("nokia.mh5.utils");
(function(g){function a(b,a){return void 0!==this[a]?this[a]:""}var c={},f=g.localStorage||{getItem:function(b){return f["_"+b]},setItem:function(b,a){f["_"+b]=a}},d={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};nokia.mh5.utils={place:{getCategoryIconForFav:function(b){var a={accommodation:"01",hotel:"01",motel:"01",hostel:"01",camping:"14","business-services":"02","atm-bank-exchange":"15","police-emergency":"19","post-office":"20","tourist-information":"21","petrol-station":"18","car-rental":"17",
"car-dealer-repair":"16","travel-agency":"02","communication-media":"02","business-industry":"02",service:"02","eat-drink":"03",restaurant:"03","snacks-fast-food":"03","bar-pub":"22","coffee-tea":"23",facilities:"04","hospital-health-care-facility":"26","government-community-facility":"25","education-facility":"04",library:"27","fair-convention-facility":"24","parking-facility":"28","toilet-rest-area":"29","sports-facility-venue":"30",facility:"04","going-out":"05","dance-night-club":"33",cinema:"32",
"theatre-music-culture":"05",casino:"31","administrative-areas-buildings":"06","administrative-region":"06","city-town-village":"35","street-square":"06","outdoor-area-complex":"06",building:"06","leisure-outdoor":"07",recreation:"07","amusement-holiday-park":"34","natural-geographical":"08","body-of-water":"36","mountain-hill":"08","undersea-feature":"08","forest-heath-vegetation":"08",shopping:"09","kiosk-convenience-store":"09",mall:"09","department-store":"09","food-drink":"09",bookshop:"09",
pharmacy:"37","electronics-shop":"09","hardware-house-garden-shop":"09","clothing-accessories-shop":"09","sport-outdoor-shop":"09",shop:"09","sights-museums":"10","landmark-attraction":"38",museum:"10","religious-place":"39",transport:"11",airport:"40","railway-station":"43","public-transport":"11","ferry-terminal":"41","taxi-stand":"42"};return(a[b]?a[b]:"06")+"_01.icon.mh5.basic.png"},getCategoryIcon:function(b){var a=nokia.mh5.assetsPath+"img/categories/",h;if(b.categoryIcon)return b.categoryIcon;
if(!b.icon)b.icon="06.icon";h=b.icon.match(/((\d+)(_\d{2})?\.icon)/);a+=b.favourite&&!h[4]?h[2]+"_01.icon":h[1];return a+".mh5.basic.png"},categoryIdentifier:function(){for(var b=["business-services",["service",215,207,258,"business-services",269,"atm-bank-exchange",47,"car-rental",20,"car-dealer-repair",2,46,51,56,"travel-agency",277,"communication-media",278,"business-industry",5],"transport",["transport",272,218,53,"airport",43,"railway-station",41,"public-transport",58,"ferry-terminal",35,"taxi-stand",
216],"shopping",["food-drink",143,"shop",23,"shopping",270,142,23,"clothing-accessories",205,"clothing-accessories-shop",205,"mall",24,"department-store",189,"electronics",196,"electronics-shop",196,"hardware-house-garden",194,"hardware-house-garden-shop",194,"bookshop",276,"sport-outdoor-shop",191,"kiosk-24-7-convenience-store",197,"kiosk-convenience-store",197],"accommodation",["accommodation",271,"hostel",173,"hotel",38,"motel",174,"camping",32],"going-out",["going-out",274,"dance-or-night-club",
203,"dance-night-club",203,"casino",3,"cinema",4,"theatre-music-culture",181],"facilities",["facilities",261,212,268,"facility",261,212,"fair-convention-facility",7,"government-or-community-facility",12,"government-community-facility",12,"library",31,"parking-facility",39],"natural-geographical",["natural-geographical",265,"body-of-water",262,"mountain-or-hill",45,"undersea-feature",260,"forest-heat-or-other-vegetation",259,"forest-heath-vegetation",259],"administrative-areas-buildings",["administrative-region",
279,"city-town-or-village",283,"city-town-village",283,"outdoor-area-complex",263,"building",280,"administrative-areas-buildings",266],"eat-drink",["bar-pub",33,"eat-drink",275,"restaurant",22,"coffee-tea",63,"snacks-fast-food",64],"leisure-outdoor",["amusement-or-holiday-park",1,"amusement-holiday-park",1,"leisure-outdoor",267,"recreation",48],"sights-museums",["sights-museums",273,213,"landmark-attraction",27,211,213,163,153,150,147,148,149,184,"museum",14],"address",["address",284],"religious-place",
["religious-place",158],"pharmacy",["pharmacy",49],"education-facility",["education-facility",106],"hospital-health-care-facility",["hospital-or-health-care-facility",200,209,"hospital-health-care-facility",200,209],"sport-facility-venue",["sport-outdoor",220,"sports-outdoor",220,"sport-facility-venue",220,"sports-facility-venue",220],"police-emergency",["police-emergency",40],"post-office",["post-office",19],"tourist-information",["tourist-information",28],"petrol-station",["petrol-station",17]],
a={},h={},d=[].indexOf,c=[].forEach,f=function(b){var c=""+this;"number"==typeof b&&9E6>b&&(h[b+9E6]=c,a.hasOwnProperty(c)||(a[c]=[]),0>d.call(a[c],b+9E6)&&a[c].push(b+9E6));h[b]=c},g=0,q=b.length;g<q;g+=2)c.call(b[g+1],f,b[g]);return function(b,d){var c=h[b];return d?a[c].join(","):c}}()},getLocalStorageValue:function(b){return f.getItem(b)},setLocalStorageValue:function(b,a){try{f.setItem(b,a)}catch(h){return!1}return!0},formatString:function(b,e){return b.replace(/%([^%]+)%/g,a.bind(e))},escapeHTML:function(b){return(""+
b).replace(/&(?!\w+;)|[<>"']/g,function(b){return d[b]||b})},cacheObject:function(b,a){if(void 0===a)return c[b];c[b]=a},purify:function(b){if(!(b instanceof Object))return b;var a={},h;for(h in b)if(b.hasOwnProperty(h)&&!("_bindings"===h||b[h]instanceof HTMLElement))a[h]=b[h];return a},formatDistance:function(b,a){return"mi"==a?161>=b?10*Math.round(3.281*b/10)+"ft":(160900>b?(b/1609).toFixed(1):Math.round(b/1609))+"mi":1E3>b?Math.round(b)+"m":(1E5>b?(b/1E3).toFixed(1):Math.round(b/1E3))+"km"},formatTime:function(b){var a=
Math.round(b/60);return 20<a&&55>a?5*Math.ceil(a/5)+"min":55<=a?0.5*Math.ceil(b/1800)+"hr":a+"min"},formatURLParams:function(b){return Object.keys(b).map(function(a){return encodeURIComponent(a)+"="+encodeURIComponent(b[a]+"")}).join("&")},isPlace:function(b){return!(!b.placeId||!b.placeId.match(/([\w\d]{8}-[\w\d]{32})/))}}})(this);nokia.mh5.provide("nokia.mh5.i18n");
nokia.mh5.i18n=function(){function g(b,a){if(b in f)return b=f[b],a?c(b,a):b}var a=/\/(combined\.js|mh5\.js|src\/).*$/,c=nokia.mh5.utils.formatString,f={},d=this,b,e;[].forEach.call(document.querySelectorAll("script"),function(b){!e&&a.test(b.src)&&(e=b.src.replace(a,"")+"/lang/")});Object.defineProperty(g,"language",{get:function(){return b},set:function(a){b=a;d.nokia_mh5_i18n=nokia.mh5.i18n_languages[a];f=d.nokia_mh5_i18n;delete d.nokia_mh5_i18n;nokia.mh5.utils.setLocalStorageValue("nokia.mh5.i18n",
b)}});"nokia_mh5_i18n"in d?(f=d.nokia_mh5_i18n,delete d.nokia_mh5_i18n):g.language=nokia.mh5.utils.getLocalStorageValue("nokia.mh5.i18n")||"en";return g}.call(this);nokia.mh5.provide("nokia.mh5.jsonp");
nokia.mh5.jsonp=function(){var g=0,a=window.document,c;return function(f,d,b){var e="MH5_"+g++,h=a.createElement("script"),j=function(){try{delete window[e]}catch(b){window[e]=null}h.parentNode.removeChild(h)},m=setTimeout(function(){window[e].call(this,{error:"timeout"})},~~b||15E3);nokia.mh5.event.add(h,"error",function(){});c||(c=a.head||a.getElementsByTagName("head")[0]||a.documentElement);window[e]=function(){j();clearTimeout(m);d.apply(this,arguments)};c.insertBefore(h,c.lastChild).src=f+"="+
e;return{uri:f,timeout:b,cancel:function(){clearTimeout(m);return h&&h.parentNode?(window[e]=j,!0):!1}}}}();nokia.mh5.provide("nokia.mh5.connectors.story.StoryAdapter");
(function(){var g=nokia.mh5.i18n,a="",c="initializing";nokia.mh5.connectors.story.StoryAdapter={msgList:{"000":g("Notification.connectionError"),"010":g("Notification.connectionError"),"020":g("Notification.serverError"),207:g("Notification.serverError"),400:g("Notification.serverError"),403:g("Notification.connectionError"),404:g("Notification.connectionError"),412:g("Notification.connectionError"),500:g("Notification.serverError")},createShareLink:function(a){return link=a.placeId?"http://maps.nokia.com/services/place/"+
a.placeId:"http://maps.nokia.com/map="+a.latitude+","+a.longitude+",16/title="+encodeURIComponent(a.name)},shortLink:function(a,d){nokia.mh5.jsonp("http://m.maps.nokia.com/releases/1.7.22/server/ushare/short.php?longUrl="+encodeURIComponent(a)+"&jsonp",function(b){d(b?b.shortUrl:"")})},init:function(f){if("initialized"!=c){var d=function(b){var e=b||{};!b||e.error||!e.sectoken?(e.success=!1,e.errorMessage=this.msgList["000"]):(e.success=!!(200==e.retCode||403==e.retCode),e.success?(a=e.sectoken,c=
"initialized"):e.errorMessage=this.msgList[e.retCode+""]);f(e)}.bind(this);nokia.mh5.jsonp("http://m.maps.nokia.com/releases/1.7.22/server/ushare/auth.php?jsonp",d)}else f({success:!0})},_getState:function(){return c},getCaptcha:function(f){if("initialized"==c){var d=function(b){var a=b||{};if(b.error)a.success=!1,a.errorMessage=this.msgList["000"];else if(a.success=200==a.result.retCode,!a.success)a.errorMessage=this.msgList[a.result.retCode+""];f(a)}.bind(this);nokia.mh5.jsonp("http://m.maps.nokia.com/releases/1.7.22/server/ushare/captcha.php?sectoken="+
a+"&jsonp",d)}else f({success:!1,errorMessage:this.msgList["010"]})},share:function(f,d){d.url=nokia.mh5.connectors.story.StoryAdapter.createShareLink(d.place);var b="";if("initialized"==c){var e;e=function(b){var a=b||{};if(!b||b.error)a.success=!1,a.errorMessage=this.msgList["000"],f(a);else if(a.success=200==a.result.retCode,!a.success)a.errorMessage=this.msgList[a.result.retCode+""];f(a)}.bind(this);switch(d.targets){case "default@sm":b="http://m.maps.nokia.com/releases/1.7.22/server/ushare/share.php?sectoken="+
a+"&version=1.1&captchaId="+encodeURIComponent(d.captcha.captchaId)+"&captchaVerifyText="+encodeURIComponent(d.captcha.captchaVerifyText)+"&targets=default@sm&type="+encodeURIComponent(d.type)+"&msg="+encodeURIComponent(d.msg)+"&participantSMSPhone="+encodeURIComponent(d.participantSMSPhone)+"&phoneNumber=&title="+encodeURIComponent(d.title)+"&url="+encodeURIComponent(d.url)+(d.place.placeId?"&shareDataObj="+this.encodeShareData(d.place):"");break;case "default@vk":case "default@fb":case "default@tw":case "default@gb":case "default@me":b=
"http://m.maps.nokia.com/releases/1.7.22/server/ushare/share.php?sectoken="+a+"&version=1.1&targets="+d.targets+"&type="+encodeURIComponent(d.type)+"&title="+encodeURIComponent(d.title)+"&url="+encodeURIComponent(d.url)+"&shareDataObj="+this.encodeShareData(d.place);break;default:f({success:!1,errorMessage:this.msgList["020"]})}nokia.mh5.jsonp(b+"&jsonp",e)}else f({success:!1,errorMessage:this.msgList["010"]})},encodeShareData:function(a){return encodeURIComponent(JSON.stringify(a.placeId?{serviceName:"Nokia Maps",
serviceURL:"http://maps.nokia.com",descriptions:{shareString1:a.name,shareString2:a.address,shareString3:a.categoryGroup+" / "+a.category,shareString4:"",shareString5:a.phone},location:{placesId:a.placeId,latitude:""+a.latitude,longitude:""+a.longitude,streetName:a.address,houseNumber:"",cityName:"",stateOrProvince:"",postalCode:"",districtName:"",countryCode:"",countryName:""}}:{serviceName:"Nokia Maps",serviceURL:"http://maps.nokia.com",descriptions:{shareString1:a.name},location:{placesId:"",latitude:""+
a.latitude,longitude:""+a.longitude,streetName:a.address,houseNumber:"",cityName:"",stateOrProvince:"",postalCode:"",districtName:"",countryCode:"",countryName:""}}))}}})();nokia.mh5.provide("nokia.mh5.platform");
(function(g){var a=g.navigator,c=a.userAgent.toLowerCase(),f=c.match(/\w{2}-\w{2}/)&&RegExp.lastMatch,d=nokia.mh5.win.location.href,b=g.outerHeight*g.outerWidth/(g.devicePixelRatio||1),d=/lo=tablet/.test(d)||!/lo=phone/.test(d)&&!/ip(?:hone|od)/.test(c)&&(/gt-p1000/.test(c)||614400<b||/iPad/.test(a.platform));nokia.mh5.platform={iphone:/iPhone/.test(a.platform),ipod:/iPod/.test(a.platform),ipad:/iPad/.test(a.platform),ios:/(iPhone)|(iPod)|(iPad)/.test(a.platform),android:/android/.test(c),playbook:/playbook/.test(c),
blackberry:/blackberry/.test(c),tablet:d,phone:!d,android_webview:!!nokia.mh5.win.android_js_interface,symbian_qt:/symbian/.test(c)&&/safari/.test(c),n9:/nokian9/.test(c),ios_webview:/(iPhone)|(iPod)|(iPad)/.test(a.platform)&&/phonegap/.test(c),ie:/msie/.test(c),language:f||a.language||a.browserLanguage,cssTransform3dSupported:function(){var b=nokia.mh5.doc.createElement("div"),a=["perspectiveProperty","WebkitPerspective","MozPerspective","OPerspective","msPerspective"],d=!1,c;for(c in a)if(a[c]in
b.style){d=!0;break}b.className="mh5_cssTransform3dTest";nokia.mh5.doc.body.appendChild(b);d=d&&"relative"===nokia.mh5.win.getComputedStyle(b,null).position;b.parentNode&&b.parentNode.removeChild(b);return d}(),hideAddressBar:function(b){var a="undefined"==typeof g.orientation||0===g.orientation||180==g.orientation,d;if(nokia.mh5.platform.iphone||nokia.mh5.platform.ipod)g.document.body.style.minHeight=(a?416:268)+"px",d=setTimeout(function(){clearTimeout(d);g.scrollTo(0,0)},0);else if(nokia.mh5.platform.android)var c=
setTimeout(function(){clearTimeout(c);b&&"orientationchange"===b.type&&g.scrollTo(0,0);var a=g.devicePixelRatio;if(!a||1>a)a=0.9;g.document.body.style.minHeight=g.outerHeight/a+"px";d=setTimeout(function(){clearTimeout(d);g.scrollTo(0,1)},1)},nokia.mh5.platform.hideAddressBar.DELAY)}};nokia.mh5.platform.hideAddressBar.DELAY=200;if(nokia.mh5.platform.ios)nokia.mh5.platform.ios={io4:-1!==c.indexOf("os 4_"),io5:-1!==c.indexOf("os 5_")};if(nokia.mh5.platform.android)a=/android ([0-9].[0-9])/.exec(c),
c=/(Chrome)/.exec(c),nokia.mh5.platform.android={version:a&&0<a.length&&a[1],browser:c?"chrome":"default"};nokia.mh5.platform.undetectable=!(nokia.mh5.platform.ios||nokia.mh5.platform.android||nokia.mh5.platform.blackberry||nokia.mh5.platform.playbook)})(this);nokia.mh5.provide("nokia.mh5.event");
nokia.mh5.event&&nokia.mh5.event.fire||function(g){function a(b){var a=b.replace(A,"");return function(h,d,c,e){if(!u.call(s,"on"+d)||!1!==s["on"+d](a,h,d,c,e))h[b](u.call(Q,d)?Q[d]:d,c,e)}}function c(b,a,h,d){b==D?y(b,a,h,d):w.push("add",b,a,h,d)}function f(b,a,h,d){b==D?O(b,a,h,d):w.push("remove",b,a,h,d)}function d(b){g[this](b,e,!0);g.documentElement[this](b,e,!0)}function b(b,a,h,d,c){var e=g.createEvent("Event");e.initEvent(u.call(Q,a)?Q[a]:a,u.call(h,"bubbles")?!!h.bubbles:d,u.call(h,"cancelable")?
!!h.cancelable:c);e.data=h;e.name=a;b.dispatchEvent(e);return e}function e(e){var n=(e.touches||[e])[0].target,e=/^touch/.test(e.type);if(w){if(!e&&(/input/i.test(n.nodeName)||nokia.mh5.platform.android))e="ontouchend"in g;B.forEach(d,t);Object.defineProperty(s,"isTouch",{value:e});Q=s.isTouch?{down:"touchstart",move:"touchmove",up:"touchend"}:{down:"mousedown",move:"mousemove",up:"mouseup"};Q.press=Q.down;Q.release=Q.up;I=y;P=O;F=b;h(z);n=0;for(e=w.length;n<e;n+=5)if("string"==typeof w[n])s[w[n]](w[n+
1],w[n+2],w[n+3],w[n+4]);else F(w[n],w[n+1],w[n+2],w[n+3],w[n+4]);a=B=c=f=d=w=null}}function h(b){var a=s.isTouch,a={type:v,mouse:!a,touch:a};for(z=null;b.length;)b.shift()(a)}function j(b,a,h){"function"==typeof b.handleEvent?b.handleEvent(this):b.call(this.target,this);this.stopped&&h.splice(0,h.length)}function m(){this.stopped=!0}function p(){this.defaultPrevented=!0}var o=["insertedintodocument"],q="__evt__"+Math.random(),v="pointerdetect",s={one:function(b,a,h,d){[].concat(a).forEach(function(a){s.add(b,
a,function S(e){s.remove(b,a,S,d);j.call(e,h)},d)});return s},add:function(b,a,d,e){[].concat(a).forEach(function(a){if(!b||b===D||b instanceof C)if(a===v)z?z.push(d):h([d]);else if(~o.indexOf(a))s["on"+a]("add",b,a,d,e);else I(b,a,d,!!e);else{var c=b[q]||(b[q]={}),c=c[a]||(c[a]=[]);0>c.indexOf(d)&&c.push(d)}});return s},remove:function(b,a,h,d){[].concat(a).forEach(function(a){if(!b||b===D||b instanceof C)if(a===v)z&&(a=z.indexOf(h),~a&&z.splice(a,1));else if(~o.indexOf(a))s["on"+a]("remove",b,a,
h,d);else P(b,a,h,!!d);else{var e=b[q]||(b[q]={}),e=e[a]||(e[a]=[]),a=e.indexOf(h);~a&&e.splice(a,1)}});return s},fire:function(b,a,h,d,e){var c;[].concat(a).forEach(function(a){!b||b===D||b instanceof C?c=F(b||D,a,h||{},null==d?!0:!!d,null==e?!0:!!e):((b[q]||{})[a]||[]).slice(0).forEach(j,c={target:b,currentTarget:b,type:a,data:h,stopPropagation:h&&h.stopPropagation||m,preventDefault:h&&h.preventDefault||p})});return c}},u=s.hasOwnProperty,D=g.defaultView,C=D.Node||D.HTMLElement,B="touchstart,touchmove,touchend,mousedown,mousemove,mouseup,mousewheel,DOMMouseScroll".split(","),
A="EventListener",n="add"+A,t="remove"+A,w=[],z=[],y=a(n),O=a(t),I=c,P=f,F=function(a,h,d,e,c){a==D?b(a,h,d,e,c):w.push(a,h,d,e,c)},Q={};B.forEach(d,n);Object.defineProperty(nokia.mh5,"event",{writable:!1,configurable:!1,enumerable:!0,value:Object.defineProperties(s,{add:{value:s.add},remove:{value:s.remove},fire:{value:s.fire}})})}(nokia.mh5.doc);nokia.mh5.provide("nokia.mh5.dom");
(function(g){function a(b){if(!g.jstestdriver)return b.stopPropagation(),!1}function c(a){a=b.defaultView.getComputedStyle(a,null);return 1E3*(parseFloat(a.getPropertyValue("-webkit-transition-duration")||a.getPropertyValue("-moz-transition-duration")||a.getPropertyValue("transition-duration"))||0)}var f=g.RegExp,d=nokia.mh5.doc.body,b=g.document;b.createEvent("Event");b.addEventListener("touchstart",function(){},!0);var e=nokia.mh5.dom={touchStart:"down",touchMove:"move",touchEnd:"up",contains:function(b,
a){return b.contains?b.contains(a):!!(b.compareDocumentPosition(a)&16)},isNativeScrollingSupported:function(){return!1},containsPoint:function(b,a,e){var b=b.getBoundingClientRect(),c=nokia.mh5.doc.documentElement.clientTop||d.clientTop||0,f=nokia.mh5.doc.documentElement.clientLeft||d.clientLeft||0,g=nokia.mh5.win.pageYOffset||nokia.mh5.doc.documentElement.scrollTop||d.scrollTop,v=nokia.mh5.win.pageXOffset||nokia.mh5.doc.documentElement.scrollLeft||d.scrollLeft;return a>b.left+v-f&&a<b.right+v-f&&
e>b.top+g-c&&e<b.bottom+g-c},dimensions:function(b){return"scrollTo"in b&&b.document?(b=b.document.documentElement,{width:b.clientWidth,height:b.clientHeight}):{width:b.offsetWidth,height:b.offsetHeight}},addClass:function(b,a){e.hasClass(b,a)||(b.className+=(b.className?" ":"")+a)},hasClass:function(b,a){return(new f("(?:^|\\s+)"+a+"(?:\\s+|$)","g")).test(b.className)},removeClass:function(b,a){for(var d=1,e=arguments.length;d<e;d++)b.className=b.className.replace(new f("(?:^|\\s+)"+arguments[d]+
"(\\s+|$)","g"),"$1").trim()},addEvent:nokia.mh5.event.add,removeEvent:nokia.mh5.event.remove,fireEvent:nokia.mh5.event.fire,query:function(a,d){return Array.prototype.slice.call((d||b).querySelectorAll(a))},byId:function(a,d){return(d||b).getElementById(a)},transition:function(){var b,e=arguments.length,f,g;"function"===typeof arguments[e-1]&&(b=arguments[e-1],e--);var o=Array.prototype.slice.call(arguments,0,e),q=function(){f&&(clearTimeout(f),f=0,nokia.mh5.dom.removeEvent(d,"tap",a,!0),nokia.mh5.dom.removeEvent(o[0].node,
"webkitTransitionEnd",q,!1),nokia.mh5.dom.removeEvent(o[0].node,"MSTransitionEnd",q,!1),b&&setTimeout(b,0))};nokia.mh5.dom.addEvent(d,"tap",a,!0);o.forEach(function(b){b.fromTransformClass&&nokia.mh5.dom.addClass(b.node,b.fromTransformClass)});setTimeout(function(){o.forEach(function(b){b.fromTransformClass&&nokia.mh5.dom.removeClass(b.node,b.fromTransformClass);nokia.mh5.dom.addClass(b.node,b.transitionClass);nokia.mh5.dom.addClass(b.node,b.toTransformClass)});g=c(o[0].node)+2E3;f=setTimeout(q,g)},
0);nokia.mh5.dom.addEvent(o[0].node,"webkitTransitionEnd",q,!1);nokia.mh5.dom.addEvent(o[0].node,"MSTransitionEnd",q,!1)},doTransition:function(b){var e=b.node,c=b.parentNode||e.parentNode||d,f=b.previousNode||!1,g=b.type+"Transition";b.transition=!0;if(!e)return!1;g=nokia.mh5.dom[g];nokia.mh5.dom.addEvent(d,"tap",a,!0);b.isHistory&&!b.persistance?c.insertBefore(e,f):(f&&nokia.mh5.dom.addClass(f,"mh5_transition_center"),"fade"===b.type&&nokia.mh5.dom.addClass(b.fadeNode?b.fadeNode:e,"in"===b.mode?
"mh5_transition_hide":"mh5_transition_show"),"out"!==b.mode&&!b.persistence&&c.appendChild(e));if(b.onNodeAttached)b.onNodeAttached();g(b)},slideTransition:function(e){var c=e.previousNode,f=e.node,g=0,o="mh5_transition_"+(e.isHistory?"right":"left"),q="mh5_transition_"+(e.isHistory?"left":"right"),v;e.transition?(nokia.mh5.dom.removeClass(f,"[A-Za-z0-9_]*transition[A-Za-z0-9_]*"),nokia.mh5.dom.addClass(f,q),setTimeout(function(){nokia.mh5.dom.addClass(c,"mh5_transition_slide");nokia.mh5.dom.addClass(f,
"mh5_transition_slide");var a=b.defaultView.getComputedStyle(e.node,null);e.duration=1E3*(parseFloat(a.getPropertyValue("-webkit-transition-duration")||a.getPropertyValue("-moz-transition-duration")||a.getPropertyValue("transition-duration"))||0);g=setTimeout(v,e.duration+2E3);setTimeout(function(){nokia.mh5.dom.removeClass(f,q);nokia.mh5.dom.removeClass(c,"mh5_transition_center");nokia.mh5.dom.addClass(c,o)},0)},0)):g=setTimeout(v,1);v=function(){g&&(clearTimeout(g),g=0,nokia.mh5.dom.removeEvent(d,
"tap",a,!0),nokia.mh5.dom.removeEvent(f,"webkitTransitionEnd",v,!1),nokia.mh5.dom.removeClass(c,"mh5_transition_slide"),nokia.mh5.dom.removeClass(f,"mh5_transition_slide"),nokia.mh5.dom.removeClass(c,o),c.parentNode&&c.parentNode.removeChild(c),e.callback&&e.callback())};nokia.mh5.dom.addEvent(f,"webkitTransitionEnd",v,!1)},fadeTransition:function(e){e.fadeNode=e.fadeNode||e.node;if(!e.transition)return!1;var c=0,f=e.isHistory,g;setTimeout(function(){nokia.mh5.dom.addClass(e.fadeNode,"mh5_transition_fade");
var a=b.defaultView.getComputedStyle(e.node,null);e.duration=1E3*(parseFloat(a.getPropertyValue("-webkit-transition-duration")||a.getPropertyValue("-moz-transition-duration")||a.getPropertyValue("-ms-transition-duration")||a.getPropertyValue("transition-duration"))||0);c=setTimeout(g,e.duration+2E3);f||(nokia.mh5.dom.addClass(e.fadeNode,"mh5_transition_"+("in"===e.mode?"show":"hide")),nokia.mh5.dom.removeClass(e.fadeNode,"mh5_transition_"+("in"===e.mode?"hide":"show")))},0);g=function(){c&&(clearTimeout(c),
c=0,"out"===e.mode&&!e.persistence&&e.node.parentNode&&e.node.parentNode.removeChild(e.node),nokia.mh5.dom.removeEvent(d,"tap",a,!0),nokia.mh5.dom.removeEvent(e.node,"webkitTransitionEnd",g,!1),nokia.mh5.dom.removeEvent(e.node,"MSTransitionEnd",g,!1),nokia.mh5.dom.removeEvent(e.node,"tap",g),nokia.mh5.dom.removeClass(e.node,"mh5_transition_fade"),nokia.mh5.dom.removeClass(e.fadeNode,"in"===e.mode?"mh5_transition_show":"mh5_transition_hide"),e.callback&&e.callback())};nokia.mh5.dom.addEvent(e.node,
"webkitTransitionEnd",g,!1);nokia.mh5.dom.addEvent(e.node,"MSTransitionEnd",g,!1)}}})(this);nokia.mh5.provide("nokia.mh5.history");
(function(){var g=[],a=nokia.mh5.win.history,c=-1;nokia.mh5.history={back:function(){a.back()},pushState:function(f,d,b){g[++c]=f;a.pushState({index:c},d,b)},replaceState:function(f,d,b){-1===c&&(c=0);g[c]=f;a.replaceState({index:c},d,b)},reset:function(){g=[];c=-1}};nokia.mh5.win.onpopstate=function(f){if(nokia.mh5.history.catchNextOnPopState){nokia.mh5.history.catchNextOnPopState(f.state?g[f.state.index]:null);delete nokia.mh5.history.catchNextOnPopState;var d=nokia.mh5.win.onpopstate;nokia.mh5.win.onpopstate=
function(){nokia.mh5.win.onpopstate=d};a.forward()}else if(f.state){var b=f.state.index>c;c=f.state.index;f=b?c:c+1;if(g[f])(f=g[f].onPopState)&&f(g[c],b)}}})();nokia.mh5.provide("nokia.mh5.event.ontap");
(function(){function g(){nokia.mh5.dom.addClass(this,"mh5_active")}function a(){nokia.mh5.dom.removeClass(this,"mh5_active")}function c(b){b.stopPropagation();b=b.touches[0];h=this._tap_={x:b.screenX,y:b.screenY,c:!0,e:b};g.call(this)}function f(a){if((h=this._tap_)&&h.c)a=a.touches[0],h.c=10>b(h.x-a.screenX)&&10>b(h.y-a.screenY)}function d(b){b.stopPropagation();if(h=this._tap_)delete this._tap_,a.call(this),h.c&&(this.noPreventDefault||b.preventDefault(),e.fire(this,"tap",h.e))}var b=Math.abs,e=
nokia.mh5.event,h;e.ontap=function(b,h,p,o,q){e.isTouch?(e[b](h,"down",c,q),e[b](h,"move",f,q),e[b](h,"up",d,q),h[b+"EventListener"]("tap",o,q)):(e[b](h,"down",g,q),e[b](h,"mouseout",a,q),e[b](h,"up",a,q),e[b](h,"click",o,q))}})();nokia.mh5.provide("nokia.mh5.event.onviewportchange");
(function(g,a,c,f,d){function b(b){g.event.fire(b,"viewportchange",this)}function e(e){f=0;a.forEach(b,e)}function h(b){clearTimeout(f);f=setTimeout(e,g.platform.hideAddressBar.DELAY+50,b)}g.win.addEventListener("orientationchange",h,!0);g.win.addEventListener("resize",h,!0);g.win.addEventListener("focus",h,!0);g.event.onviewportchange=function(b,e,h,f,g){d=a.indexOf(e);0>d&&(d=a.push(e)-1,c[d]=0);c[d]+="add"==b?1:-1;1>c[d]&&(a.splice(d,1),c.splice(d,1));e[b+"EventListener"]("viewportchange",f,g)}})(nokia.mh5,
[],[],0);nokia.mh5.provide("nokia.mh5.ui.Control");
nokia.mh5.ui.Control=new nokia.mh5.Class(function(){function g(a,b,e,c){if(!a._bindings||!a._bindings[b])return-1;a=a._bindings[b];for(b=a.length-1;0<=b;--b)if(a[b].object===e&&a[b].property===c)return b;return-1}var a=function(a,b){var e=a.indexOf(b);return-1!==e&&e===a.length-b.length},c=function(a,b,e,c){a._bindings=a._bindings||{};a._bindings[b]=a._bindings[b]||[];a._bindings[b].push({object:e,property:c});var f=Object.getOwnPropertyDescriptor(a,b)||Object.getOwnPropertyDescriptor(a.constructor.prototype,
b);if(!f||!f.set){var g=a[b];Object.defineProperty(a,b,{get:function(){return g},set:function(e){if(!(g===e&&"object"!==typeof g&&!Array.isArray(g))){var c=g;g=e;var h,f;if(a._bindings[b])for(var j=a._bindings[b].length-1;0<=j;--j)h=a._bindings[b][j].object,f=a._bindings[b][j].property,"function"===typeof f?f.call(h,e,c):h[f]=e}}})}"function"===typeof c?c.call(e,a[b]):e[c]=a[b]},f=function(a,b,e,c){a._bindings=a._bindings||{};a._bindings[b]=a._bindings[b]||[];a._bindings[b].push({object:e,property:c});
"function"!==nokia.mh5.type(c)&&(e[c]=a[b]);var f="change";if((a instanceof HTMLInputElement||a instanceof HTMLTextAreaElement)&&"value"===b)f="keyup";nokia.mh5.dom.addEvent(a,f,function(){"function"===nokia.mh5.type(c)?c.call(e,a[b]):e[c]=a[b]})};return{statics:{watch:function(a,b,e,h){a instanceof HTMLElement?f(a,b,e,h):c(a,b,e,h)},bindingExists:function(a,b,e,c){return-1<g(a,b,e,c)},removeBinding:function(a,b,e,c){e=g(a,b,e,c);-1<e&&(c=a._bindings[b],c.splice(e,1),0===c.length&&delete a._bindings[b])}},
constructor:function(a,b){this._attachTouchHandler=this._attachTouchHandler.bind(this);nokia.mh5.extend(this,a);this.parent=b;this.root=nokia.mh5.doc.createElement(this.rootHtmlElementName||"div");(this.hScroll||this.vScroll)&&this._setupScrolling();if(this.innerHTML)this.getContentRoot().innerHTML=this.innerHTML;!this.dontBind&&!b&&(this.prepareBindings(),this.prepareDidChangeNotifications());this.cssClass&&0<this.cssClass.length&&nokia.mh5.dom.addClass(this.root,this.cssClass);if(this.id)this.root.id=
this.id;this.onClick&&this._attachTouchHandler();if(void 0===this.visible)this.visible=!0;nokia.mh5.each(this.listeners,function(b,a){nokia.mh5.event.add(this,a,b)},this)},getRootOwnerByClass:function(a){for(var b=this;"parent"in b&&!(b instanceof a);)b=b.parent;return b},_setupScrolling:function(){var a=this;a.scrollContainer=nokia.mh5.doc.createElement("div");a.root.appendChild(a.scrollContainer);a.scrollContainer.style.display="inline-block";var b=nokia.mh5.doc.createElement(a.scrollContainerElementName||
"div");a.scrollContainer.appendChild(b);if(nokia.mh5.dom.isNativeScrollingSupported())a.root.style["overflow-x"]=a.hScroll?"scroll":"hidden",a.root.style["overflow-y"]=a.vScroll?"scroll":"hidden";else{var e,c,f,g,p;a._scroll=new iScroll(a.root,{hScroll:a.hScroll,hScrollbar:!1===a.hScrollbar?!1:!0,vScroll:a.vScroll,vScrollbar:!1===a.vScrollbar?!1:!0,hideScrollbar:!0,bounce:!1===a.bounce?!1:!0,scrollbarClass:"mh5_scrollbar"+(a.scrollbarClass?" "+a.scrollbarClass:""),onBeforeScrollStart:function(b){e=
b.touches?b.touches[0]:b;c=e.pageX;f=e.pageY;a._scrolled=!1},onBeforeScrollMove:function(b){e=b.touches?b.touches[0]:b;g=Math.abs(e.pageX-c);p=Math.abs(e.pageY-f);(!a.vScroll&&g>p||!a.hScroll&&p>g)&&b.preventDefault();a._scrolled=!0},checkDOMChanges:!0});a._scroll.refresh=a._scroll.refresh.bind(a._scroll)}a.hScroll&&nokia.mh5.dom.addClass(a.scrollContainer,"mh5_hScroll");a.vScroll&&nokia.mh5.dom.addClass(a.scrollContainer,"mh5_vScroll")},_attachTouchHandler:function(){nokia.mh5.dom.addEvent(this.root,
"tap",function(a){if(!this._isScrolled())this.onClick(a)}.bind(this),!1)},_isScrolled:function(){return!this._scrolled||400>=(new Date).getTime()-this._scroll.startTime?!1:!0},visibleDidChange:function(a){nokia.mh5.dom[a?"removeClass":"addClass"](this.root,"mh5_hidden")},prepareBindings:function(){var c=nokia.mh5.ui.Control,b;for(b in this)if(a(b,"Binding")){var e=this[b],h=b.slice(0,-7),f=e.split("#"),g=2===f.length?f[0]:null,p=2===f.length?f[1]:f[0],o=null,f=p.split("."),f=f[f.length-1],p=p.substring(0,
p.indexOf("."+f)),o=null,o="this"===g?this:g?nokia.mh5.require(g):nokia.mh5.win;if(!o)throw Error(nokia.mh5.i18n("Error.prepareBindings",{value:e,snmspa:g}));o=nokia.mh5.resolve(p,o);c.watch(o,f,this,h)}},prepareDidChangeNotifications:function(){var c=nokia.mh5.ui.Control,b,e,h;for(h in this)a(h,"DidChange")&&(b=this[h],e=h.slice(0,-9),c.watch(this,e,this,b))},getContentRoot:function(){return this.scrollContainer?this.scrollContainer.children[0]:this.root}}});nokia.mh5.provide("nokia.mh5.ui.AutoLayout");
nokia.mh5.ui.AutoLayout=new nokia.mh5.Class({constructor:function(g){this.setProperties(g)},setProperties:function(g){nokia.mh5.extend(this,g)},reset:function(){}});nokia.mh5.provide("nokia.mh5.ui.Container");
nokia.mh5.ui.Container=new nokia.mh5.Class(nokia.mh5.ui.Control,function(g){var a=nokia.mh5.i18n;return{constructor:function(c,f){nokia.mh5.extendDeep(this,c);for(var d=this.children=this.children||[],b=nokia.mh5.doc.createDocumentFragment(),e,h,j=0,m=d.length;j<m;j++)if(c=e=this[d[j]]){h=c.control;if(!h)throw Error(a("Error.controlProperty"),e);this[d[j]]=e=new h(c,this);e.root&&b.appendChild(e.root)}d=this.dontBind;if(!f)this.dontBind=!0;g.constructor.call(this,{},f);this.dontBind=d;this.getContentRoot().appendChild(b);
c=this.layout||{};h=c.type||nokia.mh5.ui.AutoLayout;this.layout=new h(c);this.layout.setProperties({container:this});this.parent||(this.build(),this.dontBind||(this.prepareBindings(),this.prepareDidChangeNotifications()))},build:function(){for(var a,f=0,d=this.children.length;f<d;f++)a=this.children[f],this[a]&&this[a].build&&this[a].build()},prepareDidChangeNotifications:function(){for(var a,f=0,d=this.children.length;f<d;f++)a=this.children[f],(a=this[a])&&a.prepareDidChangeNotifications&&!a.dontBind&&
a.prepareDidChangeNotifications();g.constructor.prototype.prepareDidChangeNotifications.call(this)},prepareBindings:function(){for(var a,f=0,d=this.children.length;f<d;f++)a=this.children[f],(a=this[a])&&a.prepareBindings&&!a.dontBind&&a.prepareBindings();g.constructor.prototype.prepareBindings.call(this)},add:function(a,f){this.children=this.children.concat(f);this[f]=a;a.parent=this;a.root&&this.getContentRoot().appendChild(a.root)},insertBefore:function(a,f,d){var b=this.children.indexOf(d);if(-1!==
b)d=this[d],this.children=this.children.concat([]),this.children.splice(b,0,f),this[f]=a,a.parent=this,a.root&&d.root&&this.getContentRoot().insertBefore(a.root,d.root)},remove:function(a){var f=this.children.indexOf(a);if(-1!==f){var d=this[a];delete this[a];this.children=this.children.concat([]);this.children.splice(f,1);d.root&&this.getContentRoot().removeChild(d.root)}}}});nokia.mh5.provide("nokia.mh5.ui.ColumnLayout");
nokia.mh5.ui.ColumnLayout=new nokia.mh5.Class(nokia.mh5.ui.AutoLayout,function(g){return{setProperties:function(a){g.setProperties.call(this,a);if(a=this.container)a=a.getContentRoot(),"stretch"===this.align&&nokia.mh5.dom.addClass(a,"stretch"),nokia.mh5.dom.addClass(a,"mh5_ColumnLayout")},reset:function(){g.reset.call(this);var a=this.container.getContentRoot();nokia.mh5.dom.removeClass(a,"mh5_ColumnLayout");nokia.mh5.dom.removeClass(a,"stretch")}}});nokia.mh5.provide("nokia.mh5.ui.RowLayout");
nokia.mh5.ui.RowLayout=new nokia.mh5.Class(nokia.mh5.ui.AutoLayout,function(g){return{setProperties:function(a){g.setProperties.call(this,a);if(a=this.container)a=a.getContentRoot(),"stretch"===this.align&&nokia.mh5.dom.addClass(a,"stretch"),nokia.mh5.dom.addClass(a,"mh5_RowLayout")},reset:function(){g.reset.call(this);var a=this.container.getContentRoot();nokia.mh5.dom.removeClass(a,"mh5_RowLayout");nokia.mh5.dom.removeClass(a,"stretch")}}});nokia.mh5.provide("nokia.mh5.ui.List");
nokia.mh5.ui.List=new nokia.mh5.Class(nokia.mh5.ui.Container,function(g){return{cssClass:"mh5_List",rootHtmlElementName:"ul",scrollContainerElementName:"ul",layout:{type:nokia.mh5.ui.RowLayout},itemClass:new nokia.mh5.Class(nokia.mh5.ui.Control,function(a){return{rootHtmlElementName:"li",cssClass:"mh5_DefaultListItem",constructor:function(c,f){a.constructor.call(this,c,f);this.update()},update:function(){var a="";this.icon&&(a+="<img src='"+this.icon+"'></img>");this.text&&(a+="<div>"+this.text+"</div>");
this.root.innerHTML=a}}}),constructor:function(a,c){this.items=[];this.renderedItems=[];var a=a||{},f=a.onClick;delete a.onClick;if(a.hScroll||a.vScroll)this.rootHtmlElementName="div";g.constructor.call(this,a,c);this.onClick=f;var d=this.getContentRoot();d.noPreventDefault=!!a.noPreventDefault;nokia.mh5.dom.addEvent(d,"tap",function(a){if(!a._fake&&d.hasChildNodes())for(var a=(a.hasOwnProperty("data")?a.data.target:null)||a.target,a=1!=a.nodeType?a.parentNode:a,e=0,c=d.childNodes.length;e<c;e++)if(nokia.mh5.dom.contains(d.children[e],
a)){if(this.onClick)this.onClick(e,d.children[e]);nokia.mh5.event.fire(this,"tap",{index:e,item:this.items[e]});break}}.bind(this),!0);a.onClick=f},add:function(a,c,f){if(void 0===c)c=this.items.length;var d=[c,0],b=nokia.mh5.doc.createDocumentFragment(),e,h,g=[],m=this.getContentRoot();Array.isArray(a)||(a=[a]);f||(d=d.concat(a),this.items.splice.apply(this.items,d));for(f=0,h=a.length;f<h;f++)e=this._createItem(a[f]),g.push(e),b.appendChild(e.root);m.children[c]?m.insertBefore(b,m.children[c]):
m.appendChild(b);d.length=2;d=d.concat(g);this.renderedItems.splice.apply(this.renderedItems,d);this._scroll&&setTimeout(this._scroll.refresh,0)},remove:function(a){if(a===this.items)this.items=[];else{Array.isArray(a)||(a=[a]);var c,f=a.length,d=0;for(_listRoot=this.getContentRoot();d<f;d++)c=this.items.indexOf(a[d]),-1<c&&(this.items.splice(c,1),this.renderedItems.splice(c,1),_listRoot.removeChild(_listRoot.children[c]))}},_createItem:function(a){var c={};if(this.itemMapping)for(k in this.itemMapping)c[k]=
a[this.itemMapping[k]];else for(k in a)a.hasOwnProperty(k)&&(c[k]=a[k]);return c.itemClass?new c.itemClass(c,this):new this.itemClass(c,this)},itemsDidChange:function(a){for(var c=this.getContentRoot(),f=this.renderedItems.length-1;0<=f;f--)c.removeChild(this.renderedItems[f].root);this.renderedItems=[];this.add(a,0,!0)},update:function(a,c){if(a&&void 0!=c){var f=this.getContentRoot();if(this.items[c]){var d=this._createItem(a);this.items[c]=a;this.renderedItems[c]=d;f.replaceChild(d.root,f.children[c])}}else this.itemsDidChange(this.items)},
scrollTo:function(a,c){this._scroll&&this._scroll.scrollTo(a,c,300)},scrollToElement:function(a){this._scroll&&this.renderedItems[a]&&this._scroll.scrollToElement(this.renderedItems[a].root,300)}}});nokia.mh5.provide("nokia.mh5.ui.Button");
nokia.mh5.ui.Button=new nokia.mh5.Class(nokia.mh5.ui.Control,function(g){return{rootHtmlElementName:"a",cssClass:"mh5_Button",constructor:function(a,c){a=a||{};this._userOnClick=a.onClick;delete a.onClick;g.constructor.call(this,a,c);a.onClick=this._userOnClick;this.update()},onClick:function(a){a&&a.stopPropagation();if(!this.disabled){var c=this.root;this.link?(c.href=this.link,setTimeout(function(){c.removeAttribute("href")},1E3)):a&&a.preventDefault();this._userOnClick&&this._userOnClick.apply(this,
arguments)}},textDidChange:function(){this.update()},iconDidChange:function(){this.update()},disabledDidChange:function(a){nokia.mh5.dom[a?"addClass":"removeClass"](this.root,"mh5_disabled")},update:function(){var a=this.icon,c=this.iconClass,f=this.text||"",d=this.root,b=this.disabled,e="";if(this.target)d.target=this.target;d.className=(this.cssClass||"")+(""!==f?" mh5_textButton":"");nokia.mh5.dom[b?"addClass":"removeClass"](d,"mh5_disabled");a&&(e+="<img src='"+a+"'/>");c&&(e+="<div class='"+
c+"'/>");f&&(e+="<div class='mh5_ButtonText'>"+f+"</div>");d.innerHTML=e;this.visibleDidChange(this.visible)}}});nokia.mh5.provide("nokia.mh5.ui.Notification");
nokia.mh5.ui.Notification=new nokia.mh5.Class(nokia.mh5.ui.Button,function(g){return{statics:{TIMEOUT_DEFAULT:3E3,TIMEOUT_INFINITY:0},cssClass:"mh5_Notification",innerHTML:'<div class="mh5_NotificationText"></div>',timeout:3E3,textDidChange:function(){this.update()},visibleDidChange:function(a){g.visibleDidChange.call(this,a);if(void 0!==this._timeoutId)clearTimeout(this._timeoutId),this._timeoutId=void 0;if(this.visible&&0<this.timeout)this._timeoutId=setTimeout(function(){this.visible=!1}.bind(this),
this.timeout)},update:function(){this.root.children[0].innerHTML!=this.text&&this.visibleDidChange(this.visible);this.root.children[0].innerHTML=this.text?this.text:""}}});nokia.mh5.provide("nokia.mh5.ui.Rating");
nokia.mh5.ui.Rating=new nokia.mh5.Class(nokia.mh5.ui.Control,function(g){return{value:0,count:0,cssClass:"mh5_Rating",constructor:function(a,c){g.constructor.call(this,a,c);this.update()},update:function(){var a="",c=0,f=Math.min(5,Math.round(2*this.value)/2);if(0===f)this.root.innerHTML="";else{for(;++c<=f;)a+='<div class="star"></div>';0!=Math.round(f)-f&&(c++,a+='<div class="halfstar"></div>');for(;5>=c++;)a+='<div class="nostar"></div>';0<this.count&&(a+='<div class="count">('+this.count+")</div>");
this.root.innerHTML=a}},countDidChange:function(){this.update()},valueDidChange:function(){this.update()}}});nokia.mh5.provide("nokia.mh5.components.PlaceSummary");
nokia.mh5.components.PlaceSummary=new nokia.mh5.Class(nokia.mh5.ui.Container,function(g){var a=nokia.mh5.i18n;return{cssClass:"mh5_PlaceSummary mh5_standardBackgroundColorDark",layout:{type:nokia.mh5.ui.ColumnLayout},children:["details"],details:{control:nokia.mh5.ui.Container,cssClass:"details"},constructor:function(a){g.constructor.call(this,a);this.update()},update:function(c){if(c){var f="";c.name&&(f+='<h1 onclick="javascript:void(0)">'+c.name+"</h1>");c.categoryTitle&&(f+="<h3>"+c.categoryTitle+
"</h3>");c.address&&c.address!==c.name&&(f+='<h2 class="address" onclick="javascript:void(0)">'+c.address.replace(/\n/g,", ")+"</h2>");if(c.ratingValue){if(!this.ratingComponent)this.ratingComponent=new nokia.mh5.ui.Rating;this.ratingComponent.value=c.ratingValue;this.ratingComponent.count=c.ratingCount;f+=this.ratingComponent.root.outerHTML}c.providerName&&(f+='<div class="mh5_source">'+a("source")+": "+c.providerName+"</div>");this.details&&(this.details.root.innerHTML=f)}else this.clear()},clear:function(){this.details.root.innerHTML=
""}}});nokia.mh5.provide("nokia.mh5.connectors.story.StoryListItem");
nokia.mh5.connectors.story.StoryListItem=new nokia.mh5.Class(nokia.mh5.ui.Control,function(g){return{rootHtmlElementName:"li",cssClass:"mh5_ListItem",constructor:function(a){g.constructor.call(this,a);this.update()},update:function(){var a,c;a='<div class="mh5_ColumnLayout"><div class="mh5_icon"></div>'+('<div class="name">'+this.text+"</div>");a+='<div class="status"></div></div>';this.href?(c=this.root.appendChild(nokia.mh5.doc.createElement("a")),c.href=this.href,c.target="_blank"):c=this.root;
c.innerHTML=a}}});nokia.mh5.provide("nokia.mh5.ui.TextInput");
nokia.mh5.ui.TextInput=new nokia.mh5.Class(nokia.mh5.ui.Control,function(g){var a=function(a){var f=nokia.mh5.doc.createElement("input");f.setAttribute("type",a);return"text"!==f.type||"datetime"===a};return{cssClass:"mh5_TextInput",placeholder:"",value:"",constructor:function(c,f){var d=nokia.mh5.event.add,c=c||{};c.clear=void 0!==c.clear?c.clear:!0;this.innerHTML="<form  class='mh5_ColumnLayout stretch'><input type='"+(c.type?a(c.type)?c.type:"text":"text")+"' autocomplete='off'>"+(!nokia.mh5.platform.android&&
c.clear?"<div class='mh5_TextInputClear mh5_hidden'></div>":"")+"</form>";g.constructor.call(this,c,f);var b=this.root.children[0],e=b.children[0],h=b.children[1];this.input=e;this.placeholderDidChange();if(this.value)e.value=this.value;nokia.mh5.ui.Control.watch(this,"placeholder",this,this.placeholderDidChange);nokia.mh5.ui.Control.watch(e,"value",this,"value");var j=this;d(e,"focus",function(a){if(nokia.mh5.platform.android&&nokia.mh5.dom.hasClass(nokia.mh5.doc.body,"mh5_hwacc_body"))j._restoreHWAcceleration=
!0,nokia.mh5.dom.removeClass(nokia.mh5.doc.body,"mh5_hwacc_body");nokia.mh5.platform.ios&&nokia.mh5.event.fire(nokia.mh5.win,"hideAddressBar",{},!0,!0);nokia.mh5.dom.addClass(j.root,"focus");0<j.value.length&&h&&nokia.mh5.dom.removeClass(h,"mh5_hidden");if(j.onFocus)j.onFocus(a);nokia.mh5.event.fire(j,"focus",a)});d(e,"blur",function(a){if(j._restoreHWAcceleration)nokia.mh5.dom.addClass(nokia.mh5.doc.body,"mh5_hwacc_body"),j._restoreHWAcceleration=!1;nokia.mh5.dom.removeClass(j.root,"focus");h&&nokia.mh5.dom.addClass(h,
"mh5_hidden");if(j.onBlur)j.onBlur(a);nokia.mh5.event.fire(j,"blur",a)});h&&nokia.mh5.dom.addEvent(h,"down",function(a){a.stopPropagation();a.preventDefault();j.value="";e.value=""},!0);d(b,"submit",function(a){j.value=e.value;e.blur();a.preventDefault();a.stopPropagation();nokia.mh5.event.fire(this,"submit",a);return!1}.bind(this),!0)},isFocused:function(){return nokia.mh5.dom.hasClass(this.root,"focus")},blur:function(){this.root.children[0].children[0].blur()},focus:function(){this.root.children[0].children[0].focus()},
valueDidChange:function(){var a=this.root.children[0].children[1],f=this.root.children[0].children[0];if(f.value!==this.value)f.value=this.value||"";if(a&&this.isFocused())nokia.mh5.dom[0<this.value.length?"removeClass":"addClass"](a,"mh5_hidden")},placeholderDidChange:function(a){if(a&&this.input&&"placeholder"in this.input)this.input.placeholder=a}}});nokia.mh5.provide("nokia.mh5.ui.TextArea");
nokia.mh5.ui.TextArea=new nokia.mh5.Class(nokia.mh5.ui.Control,function(g){return{cssClass:"mh5_ColumnLayout stretch",rootHtmlElementName:"div",constructor:function(a,c){this.innerHTML='<textarea class="mh5_TextArea"></textarea>';g.constructor.call(this,a,c);var f=this.root.children[0],d=this;nokia.mh5.ui.Control.watch(f,"value",this,"value");nokia.mh5.dom.addEvent(f,"focus",function(a){if(nokia.mh5.platform.android&&nokia.mh5.dom.hasClass(nokia.mh5.doc.body,"mh5_hwacc_body"))d._restoreHWAcceleration=
!0,nokia.mh5.dom.removeClass(nokia.mh5.doc.body,"mh5_hwacc_body");nokia.mh5.event.fire(d,"focus",a)});nokia.mh5.dom.addEvent(f,"blur",function(a){if(d._restoreHWAcceleration)nokia.mh5.dom.addClass(nokia.mh5.doc.body,"mh5_hwacc_body"),d._restoreHWAcceleration=!1;nokia.mh5.event.fire(d,"blur",a)});if(this.placeholder&&"placeholder"in f)f.placeholder=this.placeholder;this.rows&&(f.rows=this.rows);this.maxlength&&(f.maxLength=this.maxlength)}}});nokia.mh5.provide("nokia.mh5.ui.Page");
nokia.mh5.ui.Page=new nokia.mh5.Class(nokia.mh5.ui.Container,function(){return{cssClass:"mh5_Page",visible:!1,model:null,getHash:function(){return"{}"},getNavigationState:function(){return this.model?nokia.mh5.utils.purify(this.model):{}},intoView:function(g){var a=nokia.mh5.dom.query(g)[0];a&&setTimeout(function(){window.scroll&&window.scroll(0,a.offsetTop)},1E3)},setModel:function(g){this.model=g}}});nokia.mh5.provide("nokia.mh5.connectors.story.BasePlugin");
nokia.mh5.connectors.story.BasePlugin=new nokia.mh5.Class(nokia.mh5.ui.Page,function(g){return{constructor:function(a,c){g.constructor.call(this);this.story=c;this.prevView=a;this.callSequenceIndex=-1;this.callSequence=[];this.genericCB=this.genericCB.bind(this)},showView:function(a){this.originOnpopstate=nokia.mh5.win.onpopstate;nokia.mh5.win.onpopstate=function(){this.hideView(a)}.bind(this);this.prevView.parentElement.replaceChild(a,this.prevView)},hideView:function(a){nokia.mh5.win.onpopstate=
this.originOnpopstate;nokia.mh5.win.history.forward();this.root.parentNode&&a.parentElement.replaceChild(this.prevView,a)},_nextStep:function(a){this.callSequenceIndex+=a||1;if(this.callSequenceIndex<this.callSequence.length)if(a=this.callSequence[this.callSequenceIndex],"adapter"==a.target)nokia.mh5.connectors.story.StoryAdapter[a.asyncMethod](this.genericCB,a.arg);else{if("plugin"==a.target)this[a.asyncMethod](this.genericCB,a.arg)}else this.callback({success:!0})},genericCB:function(a){this.callSequence[this.callSequenceIndex].cb.call(this,
a)},processSequence:function(){this.callSequence&&this.callSequenceIndex&&this.callback&&this._nextStep()}}});nokia.mh5.provide("nokia.mh5.connectors.story.SmsPlugin");
nokia.mh5.connectors.story.SmsPlugin=new nokia.mh5.Class(nokia.mh5.connectors.story.BasePlugin,function(g){var a=nokia.mh5.i18n;return{cssClass:"mh5_smsShare",children:"header,notification,phoneNumberLabel,phoneNumberLabel_error,phoneNumberInput,messageLabel,messageInput,securityCodeLabel,securityCodeLabel_error,image,text,actions".split(","),layout:{type:nokia.mh5.ui.RowLayout},header:{control:nokia.mh5.ui.Container,rootHtmlElementName:"header",cssClass:"mh5_header mh5_standardBackgroundColorDark",
children:["headline","placeSummary"],headline:{control:nokia.mh5.ui.Control,rootHtmlElementName:"h1",cssClass:"mh5_headline",innerHTML:a("shareVia")+" "+a("sms")},placeSummary:{control:nokia.mh5.components.PlaceSummary}},notification:{control:nokia.mh5.ui.Notification,visible:!1},phoneNumberLabel:{control:nokia.mh5.ui.Control,cssClass:"mh5_Label",rootHtmlElementName:"label",innerHTML:a("SMS.plsEnterNum")},phoneNumberLabel_error:{control:nokia.mh5.ui.Control,cssClass:"mh5_Label error",visible:!1,rootHtmlElementName:"label",
innerHTML:a("SMS.plsCheckNum")},phoneNumberInput:{control:nokia.mh5.ui.TextInput,type:a("tel"),clear:!1,value:"+"},messageLabel:{control:nokia.mh5.ui.Control,cssClass:"mh5_Label",rootHtmlElementName:"label",innerHTML:a("SMS.alsoShort")},messageInput:{control:nokia.mh5.ui.TextArea,rows:3,maxlength:140,placeholder:a("messageHere")+"..."},securityCodeLabel:{control:nokia.mh5.ui.Control,cssClass:"mh5_Label",rootHtmlElementName:"label",innerHTML:a("SMS.enterCaptcha")},securityCodeLabel_error:{control:nokia.mh5.ui.Control,
rootHtmlElementName:"label",cssClass:"mh5_Label error",innerHTML:a("SMS.wrongCaptcha"),visible:!1},image:{control:nokia.mh5.ui.Control,rootHtmlElementName:"img",cssClass:"mh5_captchaImage",src:"",srcDidChange:function(a){this.root.src=a}},text:{control:nokia.mh5.ui.TextInput,clear:!1,placeholder:a("SMS.enterCode")+"...",valueDidChange:function(a){if(0===a.length)this.parent.actions.submitButton.disabled=!0;else if(this.parent.actions.submitButton.disabled)this.parent.actions.submitButton.disabled=
!1}},actions:{control:nokia.mh5.ui.Container,cssClass:"mh5_right",children:["cancelButton","submitButton"],cancelButton:{control:nokia.mh5.ui.Button,cssClass:"mh5_Button mh5_textButton",text:a("cancel"),build:function(){this.root.addEventListener("touchstart",function(a){a.stopPropagation();a.preventDefault()})},onClick:nokia.mh5.history.back},submitButton:{control:nokia.mh5.ui.Button,cssClass:"mh5_Button mh5_textButton",disabled:!0,text:a("submit")}},constructor:function(a,f){g.constructor.call(this,
a,f);this.header.placeSummary.update(this.story.data);this.actions.submitButton.update();this.callSequence=[{target:"adapter",asyncMethod:"getCaptcha",cb:this._getCaptchaCallback,arg:null},{target:"plugin",asyncMethod:"_displayForm",cb:this._displayFormCallback,arg:{}},{target:"adapter",asyncMethod:"share",cb:this._shareCallback,arg:{}}];this.metadata={}},performShare:function(a){this.callback=function(f){this.actions.submitButton.disabled=!1;f.success?(this.notification.text="The SMS was sent successfully!",
this.notification.timeout=nokia.mh5.ui.Notification.TIMEOUT_DEFAULT,this.notification.visible=!0,nokia.mh5.win.scrollTo(0,0),setTimeout(function(){this.notification.visible=!1;this.hideView(this.root);a(f)}.bind(this),nokia.mh5.ui.Notification.TIMEOUT_DEFAULT)):(this.hideView(this.root),a(f))}.bind(this);this.processSequence()},_getCaptchaCallback:function(c){if(c.success&&c.result)this.metadata.captcha=c.result.captcha,this.callSequence[1].arg.url=this.metadata.captcha.captchaUrl,this.callSequence[1].arg.captchaWidth=
this.metadata.captcha.captchaWidth,this.callSequence[1].arg.captchaHeight=this.metadata.captcha.captchaHeight,this._nextStep();else{var f=a("Notification.connectionError");this.root.parentNode?(this.notification.text=f,this.notification.timeout=nokia.mh5.ui.Notification.TIMEOUT_DEFAULT,this.notification.visible=!0,nokia.mh5.win.scrollTo(0,0)):(c.errorMessage=f,this.callback(c))}},_shareCallback:function(c){this.notification.visible=!1;c.success?this._nextStep():c.result&&409===c.result.targets[0].retCode?
(this.securityCodeLabel_error.visible=!0,this.text.value="",this.text.root.children[0].children[0].focus(),this._nextStep(-2)):c.result&&400===c.result.targets[0].retCode?(this.phoneNumberLabel_error.visible=!0,this._nextStep(-2)):(this.notification.text=a("SMS.unableToSend"),this.notification.timeout=nokia.mh5.ui.Notification.TIMEOUT_DEFAULT,this.notification.visible=!0,nokia.mh5.win.scrollTo(0,0),this._nextStep(-1))},_displayForm:function(a,f){this.image.src=f.url;this.image.root.width=f.captchaWidth||
200;this.image.root.height=f.captchaHeight||50;this.actions.submitButton.disabled=!this._formInitialized;if(!this._formInitialized)this._formInitialized=!0,this._initializeFormControls(a,f)},_initializeFormControls:function(c){var f=this;this.actions.submitButton.onClick=function(){var d={success:!0,placeTitle:this.story.data.name,phoneNumber:f.phoneNumberInput.value.replace(/[^+0-9]/gi,""),message:f.messageInput.value,captchaVerifyText:this.text.value};this.phoneNumberLabel_error.visible=!1;this.securityCodeLabel_error.visible=
!1;this.notification.text=a("sending")+"...";this.notification.timeout=nokia.mh5.ui.Notification.TIMEOUT_INFINITY;this.notification.visible=!0;this.actions.submitButton.disabled=!0;nokia.mh5.win.scrollTo(0,0);c(d)}.bind(this);this.showView(this.root)},_displayFormCallback:function(a){this.metadata.captcha.captchaVerifyText=a.captchaVerifyText;this.metadata.participantSMSPhone=a.phoneNumber;this.metadata.msg=a.message;this.metadata.title=a.placeTitle;this.metadata.place=this.story.data;this.metadata.targets=
"default@sm";this.metadata.type="place";this.callSequence[2].arg=this.metadata;a.success?this._nextStep():this.callback(a)},visibleDidChange:function(a){if(!a)this.notification.visible=!1}}});nokia.mh5.provide("nokia.mh5.connectors.story.EmailPlugin");
nokia.mh5.connectors.story.EmailPlugin=new nokia.mh5.Class(nokia.mh5.ui.Page,function(){var g=nokia.mh5.i18n;return{constructor:function(a,c){this.story=c},performShare:function(a){var c=this.story.data,f=(c.name+"").replace(/\s+/g," "),d=nokia.mh5.connectors.story.StoryAdapter.createShareLink(c),b;nokia.mh5.connectors.story.StoryAdapter.shortLink(d,function(e){if(e)b=g("EP.idLikeTo")+" "+(c.placeId?g("place"):g("location"))+(" "+g("EP.linkWithYou")+": "+e+"\n\n")+(c.placeId?c.name+"\n":"")+c.address,
b=b.replace(/\r/g,""),nokia.mh5.win.location.href="mailto:?subject="+encodeURIComponent(f)+"&body="+encodeURIComponent(b);setTimeout(function(){a({success:!!e})},500)})}}});nokia.mh5.provide("nokia.mh5.connectors.story.StoryCreator");
nokia.mh5.connectors.story.StoryCreator=new nokia.mh5.Class(nokia.mh5.ui.Container,function(){var g=nokia.mh5.i18n,a=g("Notification.connectionError"),c=[{name:"facebookCreator",text:"Facebook",cssClass:"mh5_ListItem mh5_share Facebook",symbol:"fb"},{name:"twitterCreator",text:"Twitter",cssClass:"mh5_ListItem mh5_share Twitter",symbol:"tw"},{name:"emailCreator",klass:nokia.mh5.connectors.story.EmailPlugin,text:g("email"),cssClass:"mh5_ListItem mh5_share Email"},{name:"smsCreator",klass:nokia.mh5.connectors.story.SmsPlugin,
text:g("sms"),cssClass:"mh5_ListItem mh5_share SMS"},{name:"gbookmarkCreator",text:"Google Bookmarks",cssClass:"mh5_ListItem mh5_share GBookmark",symbol:"gb"},{name:"meneameCreator",text:"Meneame",cssClass:"mh5_ListItem mh5_share Meneame",symbol:"me"},{name:"vKontakteCreator",text:"VKontakte",cssClass:"mh5_ListItem mh5_share VKontakte",symbol:"vk"}];return{cssClass:"mh5_StoryCreator",children:["header","notification","container"],layout:{type:nokia.mh5.ui.RowLayout},header:{control:nokia.mh5.ui.Container,
layout:{type:nokia.mh5.ui.ColumnLayout},rootHtmlElementName:"header",cssClass:"mh5_header mh5_standardBackgroundColorDark",children:["backButton","headerData"],backButton:{control:nokia.mh5.ui.Button,cssClass:"mh5_Button mh5_back",build:function(){this.root.addEventListener("touchstart",function(a){a.stopPropagation();a.preventDefault()})},onClick:nokia.mh5.history.back},headerData:{control:nokia.mh5.ui.Container,layout:{type:nokia.mh5.ui.RowLayout},children:["headline","placeSummary"],headline:{control:nokia.mh5.ui.Control,
rootHtmlElementName:"h1",cssClass:"mh5_headline",innerHTML:g("shareAPlace")},placeSummary:{control:nokia.mh5.components.PlaceSummary}}},notification:{control:nokia.mh5.ui.Notification,visible:!1},container:{control:nokia.mh5.ui.List,itemClass:nokia.mh5.connectors.story.StoryListItem,items:c,onClick:function(a){this.parent.launchShare(a,this.root.children[a])},noPreventDefault:!0},visibleDidChange:function(a){if(!a)this.notification.visible=!1},launchShare:function(f,d){function b(b){h._hideSpinner(d);
!b||b.success?nokia.mh5.app.controller.back():(h.notification.text=b.errorMessage||a,h.notification.visible=!0)}var e=c[f],h=this;this._showSpinner(d);"emailCreator"===e.name?(new e.klass(this.root,this.story)).performShare(b):"smsCreator"===e.name?nokia.mh5.platform.ios_webview&&nokia.mh5.platform.iphone?window.shareNative(this.story,b):nokia.mh5.connectors.story.StoryAdapter.init(function(a){h._hideSpinner(d);a.success?(new e.klass(h.root,h.story)).performShare(b):b(a)}):setTimeout(b,100)},_showSpinner:function(a){a&&
nokia.mh5.dom.addClass(a,"loading")},_hideSpinner:function(a){a&&nokia.mh5.dom.removeClass(a,"loading")},update:function(a){var d,b;this.story=a;d=a.data.name;a=a.data;b=nokia.mh5.connectors.story.StoryAdapter.createShareLink(a);this.header.headerData.placeSummary.update(a);for(var e=0;e<c.length;e++){var h=c[e];if(void 0!==h.symbol)h.href="http://m.maps.nokia.com/releases/1.7.22/server/ushare/ushare.php?sectoken=&version=1.1&targets=default@"+h.symbol+"&type="+encodeURIComponent("place")+"&title="+
encodeURIComponent(d)+"&url="+encodeURIComponent(b)+"&shareDataObj="+encodeURIComponent(JSON.stringify(a.placeId?{serviceName:"Nokia Maps",serviceURL:"http://maps.nokia.com",descriptions:{shareString1:a.name,shareString2:a.address,shareString3:a.categoryGroup+" / "+a.category,shareString4:"",shareString5:a.phone},location:{placesId:a.placeId||a.id,latitude:""+a.latitude,longitude:""+a.longitude,streetName:a.address,houseNumber:"",cityName:"",stateOrProvince:"",postalCode:"",districtName:"",countryCode:"",
countryName:""}}:{serviceName:"Nokia Maps",serviceURL:"http://maps.nokia.com",descriptions:{shareString1:a.name},location:{placesId:"",latitude:""+a.latitude,longitude:""+a.longitude,streetName:a.address,houseNumber:"",cityName:"",stateOrProvince:"",postalCode:"",districtName:"",countryCode:"",countryName:""}}))}this.container.items=c}}});nokia.mh5.provide("nokia.mh5.geolocation");
nokia.mh5.geolocation=function(g,a){function c(){w&&B.clearWatch(w);n=w=0}function f(b){a.fire(A,b,I)}function d(a){var b=!n;n=1;t=p;I=a;O=a.coords;f(b?e:h)}function b(){c();try{w=B.watchPosition(d,function(a){n?f(m,c(),t=q):2<a.code?setTimeout(b,250):f(j,c(),t=v)},{enableHighAccuracy:s,timeout:u,maximumAge:D})}catch(a){t=o,f(j,c())}}var e="positionactivate",h="positionchange",j="positionerror",m="positionlost",p="active",o="denied",q="lost",v="error",s=!0,u=6E4,D=1E4,C=Object.defineProperty,B=nokia.mh5.win.navigator.geolocation,
A={},n=0,t=B?"inactive":"disabled",w=0,z="complete"==document.readyState,y,O,I;C(A,"enableHighAccuracy",{get:function(){return s},set:function(a){s!==a&&(s=null==a?!0:!!a,n&&b())}});C(A,"timeout",{get:function(){return u},set:function(a){u!==a&&(u=null==a?6E4:a,n&&b())}});C(A,"maximumAge",{get:function(){return D},set:function(a){D!==a&&(D=null==a?1E4:a,n&&b())}});C(A,"latitude",{get:function(){return n&&O.latitude}});C(A,"longitude",{get:function(){return n&&O.longitude}});C(A,"available",{get:function(){return!!n}});
C(A,"status",{get:function(){return t}});C(A,"coords",{get:function(){return O}});C(A,"deactivate",{value:function(){n&&(c(),t="inactive",f("positiondeactivate"))}});C(A,"activate",{value:function(a){if(!(n||"disabled"===t)){t="waiting";a||(a={});if(!z)return y=a;var e=a.enableHighAccuracy;s=null==e?!0:!!e;e=a.timeout;u=null==e?6E4:e;a=a.maximumAge;D=null==a?1E4:a;b()}}});C(A,"disable",{value:function(){n&&c();t="disabled"}});z||a.add(g,"DOMContentLoaded",function F(){z=!0;a.remove(g,"DOMContentLoaded",
F);y&&A.activate(y)});a.add(g,"beforeunload",c);a.add(g,"unload",c);return A}(nokia.mh5.win,nokia.mh5.event);nokia.mh5.provide("nokia.mh5.math");
(function(){function g(a,e){var g=a.longitude*c,p=a.latitude*c,o=e.longitude*c,q=e.latitude*c,g=f(p)*f(q)+d(p)*d(q)*d(g-o);1<g&&(g=1);-1>g&&(g=-1);return b(g)}var a=Math.PI,c=a/180,f=Math.sin,d=Math.cos,b=Math.acos,e=nokia.mh5.math={bearing:function(e,j){var m=e.longitude*c,p=j.longitude*c,o=e.latitude*c,q=j.latitude*c,v=g(e,j),o=v?(f(q)-f(o)*d(v))/(f(v)*d(o)):1;1<o&&(o=1);-1>o&&(o=-1);return 0<=f(p-m)?b(o):2*a-b(o)},pointDistance:function(a,b){return 6371E3*g(a,b)},segmentDistance:function(a,b,c){var d=
e.bearing(b,a),o=e.bearing(b,c),q=g(b,c),c=g(c,a),a=g(b,a);return q<1/6371E3?6371E3*a:0===a||0===c?0:0>(a*a+q*q-c*c)/(2*a*q)||0>(q*q+c*c-a*a)/(2*q*c)?-1:6371E3*Math.abs(Math.asin(f(a)*f(d-o)))},speed:function(a,b){return 1E3*e.pointDistance(a.coords,b.coords)/(b.timestamp-a.timestamp)}}})(this);nokia.mh5.provide("nokia.mh5.components.favourites");
(function(){var g=JSON.parse,a=JSON.stringify,c=nokia.mh5.utils.getLocalStorageValue,f=nokia.mh5.utils.setLocalStorageValue,d=nokia.mh5.utils.formatString;nokia.mh5.components.favourites={changedFavourite:null,_generateID:function(){var a=g(c("favourites")||"{}"),e=1,d;do d="FAV_"+e++;while(a[d]);return d},_findFavourite:function(a,e,c){var d=a.placeId,f,g;for(g in e)if(e.hasOwnProperty(g)&&(f=e[g])&&!f.deleted&&(d?f.placeId===d:a.latitude===f.latitude&&a.longitude===f.longitude))return c?{id:g,fav:f}:
f},_queue:function(a,e,c,d){var f=this.__queue=this.__queue||[],g=this.__dangling=this.__dangling||[];this.__idc=this.__idc||0;var o=this,q=function(a){if(g[a])delete g[a];else if(f[0].tid&&clearTimeout(f[0].tid),f[0].c&&f[0].c.apply(this,Array.prototype.slice.call(arguments,1)),f.shift(),0<f.length){this.__idc++;f[0].tid=setTimeout(function(a){var b=f[0];q(a);g[a]=b},f[0].t,this.__idc);var b=function(a){return function(){q.apply(o,[a].concat(Array.prototype.slice.call(arguments,0)))}}(this.__idc);
f[0].f.apply(o,f[0].p?[f[0].p,b]:[b])}}.bind(this);f.push({f:a,p:e,c:c,t:d});1===f.length&&(f.unshift([]),q())},add:function(b,e){var d=g(c("favourites")||"{}"),j=this._generateID();b.favourite=!0;d[j]={address:b.address,categoryGroup:b.categoryGroup,latitude:b.latitude,longitude:b.longitude,name:b.name,placeId:b.placeId,ratingCount:b.ratingCount,ratingValue:b.ratingValue,date:+new Date};j=f("favourites",a(d));nokia.mh5.sso.isAuthenticated()?this.addServerFav(b,function(c){d[c.placesId]=d[placeId];
delete d[placeId];f("favourites",a(d));b.inSync=!0;e&&e()},function(){e&&e()}):e&&e();nokia.mh5.components.favourites.changedFavourite=b;return j},get:function(a){var e=g(c("favourites")||"{}"),d=[],f;for(f in e)if(e.hasOwnProperty(f)){var m=e[f];delete m.categoryIcon;m.favourite=!0;var p=m.categoryGroup;if(m.categories&&m.categories[0]&&m.categories[0].categoryId)p=m.categories[0].categoryId;m.icon=nokia.mh5.utils.place.getCategoryIconForFav(p)}if(a)return Array.isArray(a)?(a.forEach(function(a){(a=
this._findFavourite(a,e))&&d.push(a)},this),d):this._findFavourite(a,e);for(var o in e)e.hasOwnProperty(o)&&!e[o].deleted&&d.push(e[o]);return d},set:function(b){var e=g(c("favourites")||"{}"),d=this._findFavourite(b,e,!0);if(!d||!d.placeId)return!1;e[d.placeId]={address:b.address,categoryGroup:b.categoryGroup,latitude:b.latitude,longitude:b.longitude,name:b.name,placeId:b.placeId,ratingCount:b.ratingCount,ratingValue:b.ratingValue,date:+new Date};return result=f("favourites",a(e))},remove:function(b,
e){var d=g(c("favourites")||"{}"),j=this._findFavourite(b,d,!0);if(j&&j.fav)j.fav.inSync?(j.fav.deleted=!0,j.fav.inSync=!1):delete d[j.id];delete b.favourite;f("favourites",a(d));nokia.mh5.components.favourites.changedFavourite=b;nokia.mh5.sso.isAuthenticated()?this.removeServerFav(j.id,function(){delete d[j.id];f("favourites",a(d));e&&e()}):e&&e()},clear:function(b){var e=g(c("favourites")||"{}"),d={};if(b)for(var j in e)e.hasOwnProperty(j)&&!e[j].inSync&&(d[j]=e[j]);f("favourites",a(d))},synchronize:function(a){this._queue(this._synchronize,
null,a,3E4)},_synchronize:function(b){var e=this;e.listServerFavs(function(d){if(d.data){for(var j={},m,p={},d=d.data,o=0,q=d.length;o<q;o++)m=d[o],j[m.id]=m;var p=g(c("favourites")||"{}"),v=0,s=Object.keys(p),u=function(a){var b=s[v++];if(b)if(m=j[b],c=p[b],c.inSync)!m||m.deleted?delete p[b]:m&&m.updatedTime>c.updatedTime&&(p[b]=e.mapServerToClient(m)),u(a);else if(c.deleted)m?e.removeServerFav(m.id,function(){delete j[b];delete p[b];u(a)}):(delete p[b],u(a));else if(m)if(m.deleted)delete p[b],u(a);
else{if(!m.deleted&&!c.deleted){var c=e.mapServerToClient(j[b]);c.inSync=!0;p[b]=c;u(a)}}else e.addServerFav(c,function(d){c.inSync=!0;c.updatedTime=d.updatedTime;j[b]=e.mapClientToServer(c);p[d.id]=p[b];delete p[b];u(a)});else a&&a()};u(function(){for(var c in j)if(m=j[c],d=p[c],!m.deleted&&!d){var d=e.mapServerToClient(m);d.inSync=!0;p[c]=d}f("favourites",a(p));b&&b()})}})},mapServerToClient:function(a){var e=a.location||{},c=e.position||{},e=e.address?e.address.text?e.address.text:nokia.mh5.adapters.Search.formatAddress(e.address):
null,c={name:a.name,latitude:c.latitude||null,longitude:c.longitude||null,address:e,favourite:!0,updatedTime:a.updatedTime};if(a.placesId&&(c.placeId=a.placesId,a.categories))c.categoryGroup=a.categories[0].categoryId;return c},mapClientToServer:function(a){var e={type:"favoritePlace",name:a.name,location:{position:{latitude:parseFloat(a.latitude),longitude:parseFloat(a.longitude)},address:{text:a.address}}};if(a.categories&&a.categories[0]&&a.categories[0].categoryId)e.icon=nokia.mh5.utils.place.getCategoryIconForFav(a.categories[0].categoryId);
if(a.placeId)e.placesId=a.placeId,e.categories=[{categoryId:a.categoryGroup}];return e},addServerFav:function(a,e){var c=d("server/scbe/index.php?%action%&app_id=%appId%&app_code=%appCode%&jsonp",{action:"add="+encodeURIComponent(JSON.stringify(this.mapClientToServer(a))),appId:nokia.mh5.appId,appCode:nokia.mh5.appCode});nokia.mh5.jsonp(c,function(a){e&&e(a)})},removeServerFav:function(a,e){var c=d("server/scbe/index.php?%action%&app_id=%appId%&app_code=%appCode%&jsonp",{action:"delete="+encodeURIComponent(a),
appId:nokia.mh5.appId,appCode:nokia.mh5.appCode});nokia.mh5.jsonp(c,function(){e&&e()})},listServerFavs:function(a){var e=d("server/scbe/index.php?%action%&app_id=%appId%&app_code=%appCode%&jsonp",{action:"list",appId:nokia.mh5.appId,appCode:nokia.mh5.appCode});nokia.mh5.jsonp(e,function(e){a&&a(e)})},favouritize:function(a){this.get(a).forEach(function(e){a.filter(function(a){return a.placeId===e.placeId})[0].favourite=!0});return a}}})();nokia.mh5.provide("nokia.mh5.components.settings");
(function(){var g={mapSchema:"normal.day",cartoPois:!1,unitSystem:"km",analyticsEnabled:!0,trafficIncidentsEnabled:!1,trafficAccidentsEnabled:!0,trafficCongestionsEnabled:!0,trafficConstructionsEnabled:!0,trafficOthersEnabled:!0},a=JSON.parse(nokia.mh5.utils.getLocalStorageValue("settings")||"{}");nokia.mh5.components.settings={current:nokia.mh5.utils.getLocalStorageValue("settings")?function(){for(var c in a)a.hasOwnProperty(c)&&(g[c]=a[c]);return g}():g,get:function(a){return nokia.mh5.components.settings.current[a]},
set:function(c,f){a[c]=f;nokia.mh5.utils.setLocalStorageValue("settings",JSON.stringify(a));nokia.mh5.components.settings.current[c]=f}}})();nokia.mh5.provide("nokia.mh5.components.PlaceListItem");
nokia.mh5.components.PlaceListItem=new nokia.mh5.Class(nokia.mh5.ui.Control,function(g){return{rootHtmlElementName:"li",cssClass:"mh5_ListItem",constructor:function(a,c){g.constructor.call(this,a,c);this.update()},update:function(){var a,c=!(!this.address&&!this.ratingValue);a="<div>"+('<img src="'+nokia.mh5.utils.place.getCategoryIcon(this)+'"></img>');c&&(a+="<div>");this.distance&&(a+='<div class="mh5_ColumnLayout"><div>');a+='<div class="mh5_ListItem_name" onclick="javascript:void(0)">'+this.name+
"</div>";this.placeId&&this.address&&(a+='<div class="mh5_ListItem_address" onclick="javascript:void(0)">'+this.address.replace(/\n/g,", ")+"</div>");if(this.distance){var f=nokia.mh5.utils.formatDistance(this.distance,nokia.mh5.components.settings.current.unitSystem);a+='</div><div class="mh5_ListItem_distance">'+f+"</div></div>"}if(this.ratingValue){if(!this._rating)this._rating=new nokia.mh5.ui.Rating;this._rating.value=this.ratingValue;a+=this._rating.root.outerHTML}c&&(a+="</div>");this.root.innerHTML=
a+"</div>"}}});nokia.mh5.provide("nokia.mh5.maps.sso");
nokia.mh5.sso=function(){var g=nokia.mh5.event,a=nokia.mh5.win,c=nokia.mh5.utils,f,d,b=function(b){b?(f=b,c.setLocalStorageValue("sso_user",JSON.stringify(b))):f=a.localStorage.removeItem("sso_user")};return{init:function(){var e;g.add(a,"message",function(e){if(-1!=="http://demo.maps.public.devbln.europe.nokia.com,http://localhost:4224,http://localhost,http://192.168.56.112:4224,http://192.168.56.101:4224,http://stg.m.maps.nokia.com,http://qa.mh5.public.devbln.europe.nokia.com,http://m.maps.nokia.com,http://convos.americas.nokia.com:8080,http://bsmacvm03.americas.nokia.com:8080,http://conversations-dev.americas.nokia.com:9090/,http://api.qa.pulse.nokia.com,https://ci.ovi.com,https://account.nokia.com".split(",").indexOf(e.origin)){if(e=JSON.parse(e.data)){if(d)d.visible=
!1;e.error||(b(e),g.fire(a,"sso_signin",e))}nokia.mh5.app.controller.current.page.visible=!0}});(e=c.getLocalStorageValue("sso_user"))&&(f=JSON.parse(e));this.isAuthenticated()},login:function(){return nokia.mh5.platform.android_webview?(d=new nokia.mh5.internals.LoginDialog,!0):a.open("server/sso/login.php")},logout:function(e){nokia.mh5.jsonp("server/sso/logout.php?jsonp",function(){b();g.fire(a,"sso_signout");"function"===typeof e&&e()},1E4);d&&(d=null)},isAuthenticated:function(){if(f){var b=
Math.round(Date.now()/1E3);if(!f.validuntil||f.validuntil<b)f=a.localStorage.removeItem("sso_user"),g.fire(a,"sso_signout")}return!!f},getUserData:function(a){return!this.isAuthenticated()?void 0:a?f[a]:f}}}();nokia.mh5.provide("nokia.mh5.connectors.favourites.FavouritesViewer");
nokia.mh5.connectors.favourites.FavouritesViewer=new nokia.mh5.Class(nokia.mh5.ui.Container,function(g){var a,c=nokia.mh5.geolocation,f=nokia.mh5.i18n,d=nokia.mh5.win,b=nokia.mh5.ui.Button,e=nokia.mh5.ui.Control,h=nokia.mh5.ui.Container,j=nokia.mh5.ui.RowLayout,m=nokia.mh5.ui.Notification,p=nokia.mh5.ui.List,o=nokia.mh5.event,q=nokia.mh5.sso,v=nokia.mh5.components.favourites,s=function(){var b=q.isAuthenticated(),e=a.header;e.signin.visible=!b&&!nokia.mh5.platform.android_webview;e.refresh.visible=
b};return{cssClass:"mh5_FavouritesViewer",children:["header","noFavourites","favourites","notification"],layout:{type:j},header:{control:h,layout:{type:nokia.mh5.ui.ColumnLayout},cssClass:"mh5_ssoContainer",visible:!0,children:["title","signin","refresh"],title:{control:e,cssClass:"mh5_title",rootHtmlElementName:"h1",build:function(){var a=function(){var a=q.getUserData("greetingname");return(a?a+"'s ":" ")+f("favourites")};this.root.innerHTML=a();o.add(nokia.mh5.win,["sso_signin","sso_signout"],
function(){this.root.innerHTML=a()}.bind(this))}},signin:{control:b,cssClass:"mh5_action mh5_SignIn mh5_baseColor",build:function(){this.root.onclick=q.login},text:f("signin"),visible:!0},refresh:{control:b,cssClass:"mh5_action mh5_Refresh mh5_baseColor",onClick:function(){this.parent.parent.update()},text:f("refresh"),visible:!1}},noFavourites:{control:e,cssClass:"mh5_noFavourites mh5_RowLayout",visible:!1,innerHTML:'<div class="mh5_divider"></div><h3>'+f("FV.startSaving")+"</h3><div>"+f("FV.startSavingHint")+
'</div><ul> <li><div class="mh5_icon"></div><div class="itemtext"><h3>'+f("addingA")+" "+f("favourite")+"</h3><p>"+f("FV.simplyTap")+'</p></div></li><li><div class="mh5_icon mh5_active"></div><div class="itemtext"><h3>'+f("removingA")+" "+f("favourite")+"</h3><p>"+f("FV.tapTheHighlighted")+'</p></div></li></ul><div class="mh5_divider"></div>'},favourites:{control:h,layout:{type:j},children:["header","list"],cssClass:"mh5_favourites mh5_primaryColorBright",visible:!1,header:{control:e,id:"header",
rootHtmlElementName:"h1",visible:!1,innerHTML:f("FV.syncedFavourites")},list:{control:p,id:"list",itemClass:nokia.mh5.components.PlaceListItem,onClick:function(a){nokia.mh5.app.controller.details(this.items[a])}}},notification:{control:m,visible:!1},constructor:function(){g.constructor.call(this);a=this;o.add(nokia.mh5.win,["sso_signin","sso_signout"],function(b){s();"sso_signout"===b.type&&v.clear();a.update()});s()},update:function(){a=this;var b=a.notification,e=a.favourites,h=a.noFavourites,g=
function(a){if(a&&a.data){var a=a.data,b=e.list,c,d;for(c=0,d=b.items.length;c<d;c++)b.items[c].distance=b.renderedItems[c].distance=nokia.mh5.math.pointDistance(a,b.items[c]),b.renderedItems[c].update()}},j=function(){var a=v.get();h.visible=0===a.length;e.visible=!h.visible;e.list.items=a},n;q.isAuthenticated()?(n=d.setTimeout(function(){b.timeout=m.TIMEOUT_DEFAULT;b.text=f("FV.couldNotSync")},15E3),b.timeout=m.TIMEOUT_INFINITY,b.text=f("FV.syncing"),b.visible=!0,v.synchronize(function(){j();d.clearTimeout(n);
b.timeout=m.TIMEOUT_DEFAULT;b.text=f("FV.syncedFavourites")})):j();c.available?g({data:c.coords}):"disabled"!==c.status&&(o.one(c,"positionactivate",g),c.activate())},visibleDidChange:function(a){a&&this.update();g.visibleDidChange.call(this,a)}}});nokia.mh5.provide("nokia.mh5.app.phoneController");
(function(){var g=nokia.mh5.history,a={},c={},f=function(a,e){return{page:a,params:e,onPopState:function(a,b){nokia.mh5.app.phoneController.currentViewState=a;nokia.mh5.app.phoneController.switchTo(a.page,a.params,{dontPushToHistory:!0,isHistory:!b})}}},d=nokia.mh5.app.phoneController={queue:[],setConfiguration:function(a){c=a},getPage:function(b){return c[b]?a[b]||(a[b]=new nokia.mh5.ui.Page(c[b])):new (nokia.mh5.require(b))},resetViewCache:function(){a={}},getMap:function(){var a=this.current.page;
return a.map?a.map:a.children.map(function(e){return nokia.mh5.resolve(e+".map",a)}).filter(function(a){return!!a&&a instanceof nokia.mh5.components.Map}).pop()},switchTo:function(a,e,c){var f=this.domNode||nokia.mh5.doc.body,g=this.current,p=d.getPage(a);this.current={name:a,page:p};e&&p.setModel(e);if(this.inTransition)this.queue.unshift(arguments);else if(c&&c.replaceLastHistoryEntry?this.updateHistoryEntry():(!c||!c.dontPushToHistory)&&this.pushHistoryEntry(this.current.name,p.getNavigationState(),
p.getHash()),!(g&&g.name===a))if(g)this.inTransition=!0,f={type:"slide",parentNode:f,node:p.root,previousNode:g.page.root,isHistory:c&&c.isHistory,onNodeAttached:function(){if(!p.visible)p.visible=!0,c&&c.intoView&&p.intoView&&p.intoView(c.intoView)},callback:function(){this.inTransition=!1;g.page.visible=!1;if(0<this.queue.length){var a=this.queue.shift();setTimeout(function(){this.switchTo.apply(this,a)}.bind(this),0)}else{var b=document.createEvent("Event");b.initEvent("hideAddressBar",!0,!0);
nokia.mh5.win.dispatchEvent(b)}}.bind(this)},nokia.mh5.dom.doTransition(f);else if(f.appendChild(p.root),!p.visible)p.visible=!0,c&&c.intoView&&p.intoView&&p.intoView(c.intoView)},updateHistoryEntry:function(){if(this.browserHistory){var a=this.current.name,e=this.current.page,c=this.currentViewState=f(a,e.getNavigationState()),d=this.manipulateUrl?"#action="+mappings[a]+"&params="+encodeURIComponent(e.getHash())+"&bmk=1":"";e.model.traffic&&(d+="&traffic=true");g.replaceState(c,a,d)}},pushHistoryEntry:function(a,
e,c){if(this.browserHistory)e=this.currentViewState=f(a,e),c=mappings[a]&&this.manipulateUrl?"#action="+mappings[a]+"&params="+encodeURIComponent(c)+"&bmk=1":"",g.pushState(e,a,c)},back:function(){this.browserHistory&&g.back()},showOnMap:function(a){this.switchTo("search",a)},route:function(a){this.switchTo("route",a)},share:function(a){this.switchTo("share",{data:a});var a=a.data,e=nokia.mh5.maps.analytics;e.log({gn:"place:share",pl:e.getPlaceId(a),c19:e.getContext(a),v19:"~c19",c32:"place:share",
ev:"event22"})},details:function(a){this.switchTo("search",{selection:a,mapMode:!0,showDetails:!0})}}})();nokia.mh5.provide("nokia.mh5.adapters.Search");
(function(){var g=nokia.mh5.i18n,a=nokia.mh5.utils,c=nokia.mh5.geolocation,f=Object.prototype.hasOwnProperty;nokia.mh5.adapters.Search={merge:function(a,b){for(var e in b)f.call(b,e)&&("object"===nokia.mh5.type(a[e])&&"object"===nokia.mh5.type(b[e])?b[e]!==a[e]&&b[e]!==a&&(a[e]=nokia.mh5.adapters.Search.merge(a[e],b[e])):void 0===a[e]&&(a[e]=b[e]));return a},formatAddress:function(a){if(!a)return"";var b=a.addrCountryCode||a.countryCode,e=a.addrCountryName||a.country||b,c=a.addrCityName||a.city,f=
c,g=a.addrStateCode||a.state,p=a.addrPostalCode||a.postCode,o=a.addrStreetName||a.thoroughfare&&a.thoroughfare.name,a=a.addrHouseNumber||a.thoroughfare&&a.thoroughfare.number,b=b&&-1<"USA CAN NZL IND GBR AUS IRL FRA LKA".indexOf(b),q=[];o&&(a?q.push(b?a+" "+o:o+" "+a):q.push(o));c&&(b?(g&&(f+=", "+g),p&&(f+=" "+p),q.push(f)):q.push(p?p+" "+c:c));e&&q.push(e);return q.join(", ")},map:function(a,b){var e=nokia.mh5.math.pointDistance,e={address:b.vicinity,placeId:b.id,icon:b.icon,href:b.href,categoryName:b.category.id,
latitude:b.position[0],longitude:b.position[1],distance:a&&e(a,{latitude:b.position[0],longitude:b.position[1]}),name:b.title,ratingValue:b.averageRating};if(b.bbox)e.boundingBox=[{latitude:b.bbox[3],longitude:b.bbox[0]},{latitude:b.bbox[1],longitude:b.bbox[2]}];if(nokia.mh5.components.favourites.get(e))e.favourite=!0;return e},fetch:function(d,b,e,f){var j=nokia.mh5,m=j.adapters.Search,p=m.merge,o,q,v=b&&b.appId||j.appId,s=b&&b.appCode||j.appCode;if(a.isPlace(d))if(o="placeId="+d.placeId,q=a.cacheObject(o))p(d,
q),e(d);else{if(!v||!s)throw Error(g("Error.applicationCredential"));b={app_id:v,app_code:s,ScreenSize:j.win.innerWidth+"x"+j.win.innerHeight};d.href?b.placeUrl=d.href:b.place=d.placeId;c.available&&(b.geolocation="geo:".concat(c.latitude,",",c.longitude,";u=",c.coords.accuracy));j.jsonp("http://m.maps.nokia.com/releases/1.7.22/server/index.php?"+a.formatURLParams(b)+"&jsonp",function(b){if(b&&b.name&&b.latitude&&b.longitude){p(d,b);var c=nokia.mh5.components.favourites.get(d);if(c)d.favourite=!0,
c.categoryGroup!==b.categoryGroup&&nokia.mh5.components.favourites.set(b);a.cacheObject(o,a.purify(d));e(d)}else f&&f(b.error),a.cacheObject(o,null)},2E4)}else if(!d.longitude||!d.latitude)f&&f();else if(o="lat="+d.latitude+"&lon="+d.longitude,q=a.cacheObject(o))p(d,q),e(d);else{d.name=d.name||d.address;if(j=nokia.mh5.components.favourites.get(d))d.favourite=!0,j.categoryGroup!==d.categoryGroup&&nokia.mh5.components.favourites.set(d);d.name?(a.cacheObject(o,a.purify(d)),e(d,!0)):m.reverseGeoCode(d,
b,function(b){d.name=d.address=b.name;a.cacheObject(o,a.purify(d));e(d)})}},getRecommendations:function(d,b,e,f){var j=nokia.mh5,m=j.adapters.Search.merge,p,o;o=b&&b.appId||j.appId;var q=b&&b.appCode||j.appCode;if(!d.longitude||!d.latitude)f&&f();else if(p=d.placeId?"placeId="+d.placeId:"lat="+d.latitude+"&lon="+d.longitude,(f=a.cacheObject(p))&&f.recommendations)m(d,f),e(f);else{if(!o||!q)throw Error(g("Error.applicationCredential"));o={app_id:o,app_code:q,lat:d.latitude,lon:d.longitude};if(d.placeId)o.place=
d.placeId;b&&b.init&&(o.init="true");c.available&&(o.geolocation="geo:".concat(c.latitude,",",c.longitude,";u=",c.coords.accuracy));return j.jsonp("http://m.maps.nokia.com/releases/1.7.22/server/index.php?"+a.formatURLParams(o)+"&jsonp",function(b){m(d,b);a.cacheObject(p,a.purify(d));e(d)},5E3)}},search:function(d,b,e,f){nokia.mh5.each(b,function(a,e){"function"===typeof a&&(b[e]=a())});var j=b.center||b.map.center,m=b.box||b.map.box,p=m[0],m=m[1],o=b.position||b.map&&b.map.position,q=b.suggestions,
v="http://places.nlp.nokia.com/places/v1/"+(q?"suggest/":"discover/search/"),s=b.appId||nokia.mh5.appId,u=b.appCode||nokia.mh5.appCode;if(!s||!u)throw Error(g("Error.applicationCredential"));d={app_code:u,app_id:s,q:d,at:j.latitude+","+j.longitude,size:b.limit||(q?4:25),tf:"plain"};p.longitude&&m.latitude&&m.longitude&&p.latitude&&(d["X-Map-Viewport"]="".concat(p.longitude,",",m.latitude,",",m.longitude,",",p.latitude));c.available&&(d.geolocation="geo:".concat(c.latitude,",",c.longitude,";u=",c.coords.accuracy));
nokia.mh5.jsonp(v+"?"+a.formatURLParams(d)+"&callback",function(a){if(a.error){if(f){var c;"timeout"===a.error&&(c=g("Notification.searchProblem"));f(c)}}else if(q)e(a.suggestions);else{var a=a.results.items||[],d,a=a.map(this.map.bind(this,o));b.map&&0<a.length&&(d=this._getBoundingBox(a,b.map));e({results:a,box:d})}}.bind(this),1E4)},getSuggestions:function(a,b,e,c){var f=b.suggestions;b.suggestions=!0;this.search(a,b,e,c);b.suggestions=f},reverseGeoCode:function(a,b,e,c){var f=b&&b.appId||nokia.mh5.appId,
b=b&&b.appCode||nokia.mh5.appCode;if(!f||!b)throw Error(g("Error.applicationCredential"));nokia.mh5.jsonp("http://geo.nlp.nokia.com/search/6.2/reversegeocode.json".concat("?token="+b+"&app_id="+f,"&prox=",a.latitude,",",a.longitude,"&mode=retrieveAddresses&jsoncallback"),function(a){var b,d;!a.error&&a.Response&&a.Response.View&&a.Response.View[0]&&a.Response.View[0].Result&&a.Response.View[0].Result[0]?(a=a.Response.View[0].Result[0],b=a.Location.DisplayPosition,d=a.Location.Address.Label,e({name:d,
address:d,latitude:b.Latitude,longitude:b.Longitude,properties:a.Location.Address})):c&&("timeout"===a.error&&(b=g("Notification.searchProblem")),c(b))},1E4)},_getBoundingBox:function(a,b){var e=a[0].boundingBox,c=[];if(!e){for(var f=0,g=a.length;f<g;f++)e=a[f],e.hasOwnerContent||c.push(e);c.push(b.center);e=b._map.getZoomLevelFor(c);b.covers(c)?17>e&&17>b.zoom?e=c:(b.zoom=16,e=b.box):12<=e?e=c:(b.zoom=12,b.center=c[0],e=b.box)}return e}}})();nokia.mh5.provide("nokia.mh5.l10n");
nokia.mh5.l10n={imperial:{us:1,gb:1,lr:1,mm:1},tileLanguageMap:{ar:"ARA",zh:"CHI",es:"SPA",fr:"FRE",it:"ITA",de:"GER",ru:"RUS"}};nokia.mh5.provide("nokia.mh5.components.Traffic");
(function(){var g={Accidents:"Accident",Constructions:"Construction",Congestions:"Congestion",Others:"DisabledVehicle,RoadHazard,MassTransit,OtherNews,Weather,Misc,PlannedEvent"},a=function(a){return this=="routeInfo"in a.data},c=function(a){return a.data.incident},f="http://traffic.nlp.nokia.com/traffic/6.0/",d=nokia.mh5.event,b=nokia.mh5.i18n,e=nokia.mh5.components.settings,h=nokia.mh5.utils;nokia.mh5.components.Traffic=new nokia.mh5.Class(nokia.mh5.ui.Container,function(j){function m(a,b){return a.location.latitude-
b.location.latitude||a.location.longitude-b.location.longitude}function p(a,b){return a.incident.criticality-b.incident.criticality||b.incident.id-a.incident.id}function o(a,b){return nokia.mh5.assetsPath+"img/mapsymbols/tmc_"+a+"_"+b+"_pole.png"}function q(a){var b=[];if(0<a.length){b.push(a[0]);for(var e=1;e<a.length;++e){var c=b[b.length-1],d=a[e];0===m(c,d)?b[b.length-1]=0<p(c,d)?d:c:b.push(d)}}return b}function v(a){var b=60*(60*(24*a.getDay()+a.getHours())+a.getMinutes())+a.getSeconds();return function(a,
e,c,n){a=f+"tiles/"+n+"/"+a+"/"+e+"/256/png32";e={appId:nokia.mh5.app.APP_ID,token:nokia.mh5.app.APP_CODE};e.pattern_time=b;return a+"?"+h.formatURLParams(e)}}function s(a){var b=null;if(a.LOCATION&&a.LOCATION.GEOLOC&&a.LOCATION.GEOLOC.ORIGIN){var e={};e.id=""+a.TRAFFICITEMID;e.startTime=new Date(Date.parse(a.STARTTIME));e.endTime=new Date(Date.parse(a.ENDTIME));b={};b.location={latitude:a.LOCATION.GEOLOC.ORIGIN.LATITUDE,longitude:a.LOCATION.GEOLOC.ORIGIN.LONGITUDE};var c="high";if(a.CRITICALITY&&
a.CRITICALITY.ID)e.criticality=a.CRITICALITY.ID|0,"0"===a.CRITICALITY.ID?c="blocking":"1"===a.CRITICALITY.ID&&(c="veryhigh");switch(a.TRAFFICITEMTYPEDESC){case "CONSTRUCTION":b.icon=o(c,"roadworks");break;case "ACCIDENT":b.icon=o(c,"accident");break;case "CONGESTION":b.icon=o(c,"congestion");break;default:b.icon=o(c,"other")}if(a.TRAFFICITEMDETAIL&&a.TRAFFICITEMDETAIL.ROADCLOSED)e.criticality=0,b.icon=o("blocking","closure");e.type=a.TRAFFICITEMTYPEDESC[0]+a.TRAFFICITEMTYPEDESC.slice(1).toLowerCase();
if(a.LOCATION.DEFINED&&a.LOCATION.DEFINED.ORIGIN){var d=a.LOCATION.DEFINED.ORIGIN,c=d.POINT.DESCRIPTION,d=d.DIRECTION.DESCRIPTION;if(c)for(var n in c)if(c[n].TYPE&&c[n].content&&"LOCAL"===c[n].TYPE)e.origin=c[n].content;if(d)for(var f in d)if(d[f].TYPE&&d[f].content&&"LOCAL"===d[f].TYPE)e.direction=d[f].content}if(a.RDSTMCLOCATIONS&&a.RDSTMCLOCATIONS.RDSTMC&&0<a.RDSTMCLOCATIONS.RDSTMC.length){a=a.RDSTMCLOCATIONS.RDSTMC;n=a[0];for(f=1;f<a.length;){if(a[f].DIRECTION&&a[f].DIRECTION!==n.DIRECTION){e.bidirectional=
!0;break}f+=1}e.start=n.ORIGIN&&n.ORIGIN.LOCATIONDESC;e.end=n.TO&&n.TO.LOCATIONDESC;e.description=n.ALERTC&&n.ALERTC.DESCRIPTION&&n.ALERTC.DESCRIPTION.replace(/\s*\(Q\)\s*/g," ").replace(/\s*\(([^\/]*)\/\/[^\)]*\)\s*/g," $1 ").replace(/\s*--\s*/," ").replace(/^\s*/,"").replace(/\s*$/,"")}b.incident=e}return b}return{_map:null,_mapReady:!1,_currentRequest:null,displayIncidents:!1,statics:{getTrafficTypes:function(){return Object.keys(g)},removeNonTrafficPois:function(a){var b=a.getPois();a.removePoi(b.filter(function(a){return!a.data.incident}))}},
_clearIncidentsFromMap:function(){this._map.removePoi(this._map.getPois().filter(function(a){return a.data.incident&&!a.data.originalImage}))},_resetPois:function(a){this._clearIncidentsFromMap();for(var e=this._map.infoBubbles.filter(c)[0],d=0,f=a.length;d<f;d++)if(!e||!(a[d].location.latitude==e.data.latitude&&a[d].location.longitude==e.data.longitude)){var g=this._map.createPoi(a[d].icon,a[d].location),n=a[d].incident,h=n.origin,w=n.direction;g.data.name=n.type;if(h)g.data.description=b("maps.Traffic.incidentDescription"+
(w?"":"NoDirection"),{origin:h,direction:w});g.data.icon=a[d].icon;g.data.incident=n}},_processIncidentsResponse:function(a){var b=[],e=this._timeTravelDate||new Date;a.TRAFFICITEMS&&a.TRAFFICITEMS.TRAFFICITEM&&(b=a.TRAFFICITEMS.TRAFFICITEM.map(s).filter(function(a){return a&&a.incident.startTime<=e&&a.incident.endTime>=e}));b.sort(m);b=q(b);b.sort(p);40<b.length&&b.splice(39,b.length-40);this._currentRequest=null;this._incidentPois=b;this._resetPois(b)},_types:function(a){return g[a]},_getType:function(){var a=
[],b=this;nokia.mh5.each(nokia.mh5.components.Traffic.getTrafficTypes(),function(c){e.get("traffic"+c+"Enabled")&&a.push(b._types(c))});return a.join(",")},_reloadIncidents:function(a,b){if("undefined"!==typeof a&&"undefined"!==typeof b&&"undefined"!==typeof b[0]&&!isNaN(b[0].latitude)){var c=this._map.geoToPoint(this._map.center),d=this._getType(),g=e.get("trafficIncidentsEnabled"),n=this;c.x=c.x/256|0;c.y=c.y/256|0;if(this.displayIncidents&&d&&g&&8<a){var t=f+"incidents.json?"+h.formatURLParams({appId:nokia.mh5.appId,
token:nokia.mh5.appCode,bbox:b[0].latitude+","+b[0].longitude+";"+b[1].latitude+","+b[1].longitude,status:"active",type:d,criticality:"critical,major,minor"})+"&jsoncallback";if(t+n._timeTravelDate!==n._incidentsUri){if(n._currentRequest)n._currentRequest.cancel(),n._currentRequest=null;n._timeoutId&&nokia.mh5.win.clearTimeout(n._timeoutId);n._timeoutId=nokia.mh5.win.setTimeout(function(){delete n._timeoutId;d=n._getType();if(n.displayIncidents&&d)n._currentRequest=nokia.mh5.jsonp(t,n._processIncidentsResponse)},
1E3);n._incidentsUri=t+n._timeTravelDate}else n._resetPois(n._incidentPois)}else n._clearIncidentsFromMap()}},_showInfoBubble:function(b){var e={content:["title","description"],left:b.data.icon,listeners:this._map.infoBubbleParams&&this._map.infoBubbleParams.listeners};this._map.hideInfoBubble(this._map.infoBubbles.filter(a,!1));this._map.showInfoBubble(b,e)},constructor:function(a,b){this._onReady=this._onReady.bind(this);this._onZoom=this._onZoom.bind(this);this._onMove=this._onMove.bind(this);
this._onPoiClick=this._onPoiClick.bind(this);this._processIncidentsResponse=this._processIncidentsResponse.bind(this);this._incidentPois=[];Object.defineProperty(this,"map",{get:function(){return this._map},set:function(a){this._map&&(d.remove(this._map,"ready",this._onReady),d.remove(this._map._map,"mapzoomchange",this._onZoom),d.remove(this._map._map,"mapmoveend",this._onMove),d.remove(this._map._map,"poiclick",this._onPoiClick));if(this._map=a)d.add(this._map,"ready",this._onReady),d.add(this._map._map,
"mapzoomchange",this._onZoom),d.add(this._map._map,"mapmoveend",this._onMove),d.add(this._map._map,"poiclick",this._onPoiClick)}});j.constructor.call(this,a,b)},mapSchemaBinding:"nokia.mh5.components.settings#current.mapSchema",mapSchemaDidChange:function(a){if(a&&"normal.day.traffic"==a){var a=nokia.mh5.app.controller.current,b=this._map,e;if(a&&a.page.timeTraveling)e=a.page.header.route.mode.timetravel,e.day.backToDefault(),e.time.backToDefault(),a.page.resetNotification();b&&b.hasLayer("timeTravelTraffic")&&
b.removeLayer("timeTravelTraffic")}},_onReady:function(){this._mapReady=!0;if(e.get("trafficIncidentsEnabled"))this.displayIncidents=!0,this._reloadIncidents(this._map.zoom,this._map.box)},_onZoom:function(a){if(8>=a.data.newValue){var b=this._map.infoBubbles.filter(c)[0];b&&this._map.hideInfoBubble(b)}a.data.oldValue!==a.data.newValue&&this._reloadIncidents(a.data.newValue,this._map.box)},_onMove:function(){this._reloadIncidents(this._map.zoom,this._map.box)},_onPoiClick:function(a){var b=a.data[0];
b.data&&b.data.incident&&!b.infoBubble&&(this._showInfoBubble(b),a.preventDefault())},enableTraffic:function(){this.displayIncidents=!0;e.set("mapSchema","normal.day.traffic");e.set("trafficIncidentsEnabled",!0);nokia.mh5.components.Traffic.getTrafficTypes().forEach(function(a){e.set("traffic"+a+"Enabled",!0)})},enableTimeTravelTraffic:function(a){var b=this._map;this._timeTravelDate=a=a||new Date;var d=this._map.infoBubbles.filter(c)[0];d&&d.data.incident.endTime<this._timeTravelDate&&b.hideInfoBubble(d);
this._reloadIncidents(b.zoom,b.box);"normal.day.traffic"==e.get("mapSchema")&&!b.hasLayer("timeTravelTraffic")&&(e.set("mapSchema","normal.day"),b.addLayer(v(a),"timeTravelTraffic"))},disableTimeTravelTraffic:function(){this._timeTravelDate=null;this._map.hasLayer("timeTravelTraffic")&&this._map.removeLayer("timeTravelTraffic");this._reloadIncidents(this._map.zoom,this._map.box)},reloadIncidents:function(){this._reloadIncidents(this._map.zoom,this._map.box)},showIncidents:function(){if(!this.displayIncidents)this.displayIncidents=
!0,this._reloadIncidents(this._map.zoom,this._map.box)},hideIncidents:function(){if(this.displayIncidents){this.displayIncidents=!1;if(this._currentRequest)this._currentRequest.cancel(),this._currentRequest=null;this._clearIncidentsFromMap()}},checkInfoBubbleOnIncidentsChange:function(){var a=this._map.infoBubbles.filter(c)[0];a&&(!e.get("trafficIncidentsEnabled")||!e.get("traffic"+a.data.incident.type+"sEnabled"))&&this._map.hideInfoBubble(a)}}})})();nokia.mh5.provide("nokia.mh5.ui.Dialog");
nokia.mh5.ui.Dialog=new nokia.mh5.Class(nokia.mh5.ui.Container,function(g){var a=function(a){a.preventDefault&&a.stopPropagation&&(a.preventDefault(),a.stopPropagation())},c=nokia.mh5.dom.addEvent,f=nokia.mh5.dom.removeEvent;return{cssClass:"mh5_modal",animationName:"fading",children:["content"],content:{control:nokia.mh5.ui.Container,cssClass:"mh5_Dialog"},allowScrolling:!1,closeOnTap:!1,disableUpdatePosition:!1,constructor:function(a,b){g.constructor.call(this,a,b);this.update&&this.update();this._updatePosition()},
build:function(){["_closeDialog","_updatePosition","_delayedUpdatePosition","_onPointerDetect"].forEach(function(a){this[a]=this[a].bind(this)},this);g.build.call(this);this._scroll&&nokia.mh5.win.setTimeout(this._scroll.refresh,0)},_closeDialog:function(c){c&&a(c);if(this.visible)this.visible=!1},_onPointerDetect:function(d){this.closeOnTap&&c(this.root,d.touch?"down":"tap",this._closeDialog);this.allowScrolling||(d.touch?c(this.root,"move",a):c(nokia.mh5.win,"scroll",this._closeDialog))},_addHandlers:function(){c(nokia.mh5.win,
"pointerdetect",this._onPointerDetect,!1);c(nokia.mh5.win,"viewportchange",this._delayedUpdatePosition,!1)},_removeHandlers:function(){f(nokia.mh5.win,"pointerdetect",this._onPointerDetect,!1);f(nokia.mh5.win,"viewportchange",this._delayedUpdatePosition,!1)},visibleDidChange:function(a){var b={type:"fade",mode:"in",node:this.root};if(a)this._addHandlers(),nokia.mh5.history.catchNextOnPopState=this._closeDialog;else if(this.root.parentNode){this._removeHandlers();delete nokia.mh5.history.catchNextOnPopState;
if(this.withoutAnimation){var e=this.root,c=e.parentNode;if(this.onClose)this.onClose();setTimeout(function(){c&&c.removeChild(e)},0);return}b.mode="out";if(this.onClose)b.callback=this.onClose.bind(this)}if(nokia.mh5.platform.android&&4>nokia.mh5.platform.android.version)b.fadeNode=this.root.firstChild;nokia.mh5.dom.doTransition(b)},_delayedUpdatePosition:function(){nokia.mh5.win.setTimeout(this._updatePosition,400)},_updatePosition:function(){if(!this.disableUpdatePosition)if(this.allowScrolling){if(this.content&&
this.content.root)this.root.style.cssText="min-height: 100%;height: "+Math.max(nokia.mh5.win.innerHeight,this.content.root.offsetHeight)+"px;overflow-x: hidden"}else this.root.style.cssText="height: "+(nokia.mh5.win.innerHeight+1)+"px;overflow: hidden;margin-top: "+nokia.mh5.win.pageYOffset+"px;"}}});nokia.mh5.provide("nokia.mh5.ui.SegmentedButton");
nokia.mh5.ui.SegmentedButton=new nokia.mh5.Class(nokia.mh5.ui.Control,function(g){return{cssClass:"mh5_SegmentedButton mh5_ColumnLayout",_selectedIndex:void 0,constructor:function(a,c){a.items=a.items||[];g.constructor.call(this,a,c);this.update()},_clickHandler:function(a){if(!(this._selectedIndex===a||this.items[a].disabled))if(void 0!==this._selectedIndex&&nokia.mh5.dom.removeClass(this.root.children[this._selectedIndex],"mh5_selected"),nokia.mh5.dom.addClass(this.root.children[a],"mh5_selected"),
this._selectedIndex=a,this.onValueChange)this.onValueChange(this.items[a].value||a)},select:function(a){if(null==a)this._selectedIndex=void 0;else{for(var c=0,f=this.items.length;c<f;c++)if(this.items[c].value===a){this._clickHandler(c);return}this.items[a]&&this._clickHandler(a)}},update:function(){var a=nokia.mh5.doc.createDocumentFragment(),c,f;for(f in this.items)this.items.hasOwnProperty(f)&&(c=this._createItem(this,parseInt(f,10)),a.appendChild(c.root));this.root.innerHTML="";this.root.appendChild(a)},
_createItem:function(a,c){var f=this,d=a.items[c],b=c===a._selectedIndex?["mh5_selected"]:[],e=!d.name&&d.iconClass?"":d.name||"Item "+(c+1);d.cssClass&&b.push(d.cssClass);d.disabled&&b.push("mh5_disabled");return new nokia.mh5.ui.Control({cssClass:b.join(" "),onClick:function(a){f._clickHandler(c);a.stopPropagation()},innerHTML:d.iconClass?"<div class='"+d.iconClass+"'/>":"<div>"+e+"</div>"})},add:function(a){this.items.push(a);this.update()},remove:function(a){for(var c=null,f=[],d=0,b=this.items.length;d<
b;d++)f.push(this.items[d]),this.items[d].value===a&&(c=d);!c&&this.items[a]&&(c=a);if(c){this.items=[];this.items=f.slice(0,c).concat(f.slice(c+1));if(c<=this._selectedIndex)this._selectedIndex=c===this._selectedIndex?void 0:this._selectedIndex-1;this.update()}}}});nokia.mh5.provide("nokia.mh5.ui.RadioItem");
nokia.mh5.ui.RadioItem=new nokia.mh5.Class(nokia.mh5.ui.Control,function(g){return{rootHtmlElementName:"li",cssClass:"mh5_ListItem",constructor:function(a,c){g.constructor.call(this,a,c);this.update()},update:function(){this.disabled?nokia.mh5.dom.addClass(this.root,"mh5_disabled"):nokia.mh5.dom.removeClass(this.root,"mh5_disabled");var a=document.createDocumentFragment(),c=document.createElement("div");c.className="mh5_name";c.innerHTML=this.title;a.appendChild(c);c=document.createElement("div");
c.className="mh5_status";a.appendChild(c);this.root.appendChild(a)}}});nokia.mh5.provide("nokia.mh5.ui.SettingsDialog");
(function(){var g=nokia.mh5.components.settings,a=nokia.mh5.dom,c=nokia.mh5.event;nokia.mh5.ui.SettingsDialog=new nokia.mh5.Class(nokia.mh5.ui.Dialog,function(f){var d=nokia.mh5.i18n,b;return{cssClass:"mh5_SettingsDialog",allowScrolling:!0,constructor:function(a,b){var c=this.content.children.indexOf("settingsToggleIndicator"),g,p;if(!a.traffic&&~c)g=this.content.settingsToggle,p=g.items,this.content.children.splice(c,1),delete g.onValueChange,p.pop(),p[0].name=d("mapControl"),p[0].cssClass+=" mh5_box-flex1";
f.constructor.call(this,a,b)},content:{control:nokia.mh5.ui.Container,cssClass:"mh5_SettingsDialogContainer",vScroll:!0,bounce:!1,layout:{type:nokia.mh5.ui.RowLayout,align:"strech"},children:"mapOffset,settingsToggle,settingsToggleBorder,settingsToggleIndicator,settingsList,fillup".split(","),mapOffset:{control:nokia.mh5.ui.Container,cssClass:"mh5_mapOffset"},settingsToggle:{control:nokia.mh5.ui.SegmentedButton,cssClass:"mh5_SettingsToggle mh5_ColumnLayout mh5_standardBackgroundColorDark",items:[{name:d("maps"),
value:"maps",cssClass:"settings_maps"},{name:d("layers"),value:"layers",cssClass:"settings_layers"}],onValueChange:function(a){var b=this.parent.settingsList,c=this.root.querySelector(".mh5_selected"),c=Math.round(c.offsetLeft+c.offsetWidth/2);this.parent.settingsToggleIndicator.root.style[(nokia.mh5.platform.ie?"ms":"webkit")+"Transform"]="translateX("+c+"px)";"maps"==a?(b.maps.visible=!0,b.layers.visible=!1):(b.maps.visible=!1,b.layers.visible=!0);this.parent.parent.resize()}},settingsToggleBorder:{control:nokia.mh5.ui.Control,
cssClass:"mh5_SettingsIndicatorBorder"},settingsToggleIndicator:{control:nokia.mh5.ui.Control,cssClass:"mh5_SettingsIndicator",innerHTML:"<div></div>"},settingsList:{control:nokia.mh5.ui.Container,cssClass:"mh5_SettingsList mh5_standardBackgroundColorDark",children:["maps","layers"],maps:{control:nokia.mh5.ui.Container,children:["mapModeRadioGroup","unitSystemToggle"],mapModeRadioGroup:{control:nokia.mh5.ui.List,cssClass:"mh5_mapTypes mh5_List",itemClass:nokia.mh5.ui.RadioItem,items:[{title:d("UI.SettingsDialog.mapView"),
schema:"normal.day"},{title:d("UI.SettingsDialog.satView"),schema:"hybrid.day"},{title:d("UI.SettingsDialog.PTView"),schema:"normal.day.transit"},{title:d("UI.SettingsDialog.trafficView"),schema:"normal.day.traffic"}],listeners:{tap:function(e){var c=e.data.index,e=e.data.item;if(!e.disabled){var d=this.getContentRoot();a.removeClass(d.children[b],"mh5_selected");a.addClass(d.children[c],"mh5_selected");e=e.schema;e!==g.get("mapSchema")&&g.set("mapSchema",e);b=c}}}},unitSystemToggle:{control:nokia.mh5.ui.SegmentedButton,
cssClass:"mh5_SegmentedButton mh5_UnitSystemToggle mh5_ColumnLayout",items:[{name:d("UI.SettingsDialog.Km"),value:"km"},{name:d("UI.SettingsDialog.Miles"),value:"mi"}],onValueChange:function(a){g.set("unitSystem",a)}}},layers:{control:nokia.mh5.ui.Container,children:["trafficOnOffSwitch","trafficSettingsContainer","criticalitySigns"],visible:!1,trafficOnOffSwitch:{control:nokia.mh5.ui.List,itemClass:nokia.mh5.ui.RadioItem,cssClass:"mh5_List mh5_RowLayout mh5_TrafficOnOff",items:{title:"Traffic Incidents",
value:!0},onClick:function(){var a=this.root.children[0];this.getRootOwnerByClass(nokia.mh5.ui.SettingsDialog)._changeIncidents(a,"Incidents")}},trafficSettingsContainer:{control:nokia.mh5.ui.List,itemClass:new nokia.mh5.Class(nokia.mh5.ui.Control,function(b){return{rootHtmlElementName:"li",cssClass:"mh5_ListItem",constructor:function(a,c){b.constructor.call(this,a,c);this.update()},update:function(){a[this.disabled?"addClass":"removeClass"](this.root,"mh5_disabled");var b=document.createDocumentFragment(),
c=document.createElement("div");c.className="mh5_image mh5_image"+this.title;b.appendChild(c);c=document.createElement("div");c.className="mh5_name";c.innerHTML=this.title;b.appendChild(c);c=document.createElement("div");c.className="mh5_status";b.appendChild(c);this.root.appendChild(b)}}}),cssClass:"mh5_List mh5_RowLayout mh5_TrafficSettings",items:nokia.mh5.components.Traffic.getTrafficTypes().map(function(a){return{title:d("UI.SettingsDialog."+a),value:a}}),onClick:function(a){if(!this.items[a].disabled){var b=
this.root.children[a],a=this.items[a].value;this.getRootOwnerByClass(nokia.mh5.ui.SettingsDialog)._changeIncidents(b,a)}}},criticalitySigns:{control:nokia.mh5.ui.List,cssClass:"mh5_criticalitySigns",itemClass:new nokia.mh5.Class(nokia.mh5.ui.Control,function(a){return{rootHtmlElementName:"li",cssClass:"mh5_CriticalitySign",constructor:function(b,c){a.constructor.call(this,b,c);this.update()},update:function(){this.root.innerHTML='<div class="text">'+d("maps.Traffic."+this.type)+'</div> <div class="img img_'+
this.type+'"></div>'}}}),items:[{type:"minor"},{type:"major"},{type:"critical"}]}}},fillup:{control:nokia.mh5.ui.Control,cssClass:"mh5_fillup mh5_standardBackgroundColorDark"}},build:function(){this.resize=this.resize.bind(this);this.onGlobalTap=this.onGlobalTap.bind(this);f.build.call(this)},resize:function(){var b=this.content,c=b.getContentRoot();a[c.offsetHeight>this.root.offsetHeight?"addClass":"removeClass"](b.root,"mh5_autoHeight");nokia.mh5.win.setTimeout(b._scroll.refresh,1)},update:function(){this.visible&&
(this._updateMapModeSelection(),this._updateUnitSystem(),this._updateTrafficIncidentSelection(),this._updateTrafficOnOffButton(),this.resize())},onGlobalTap:function(b){(!a.contains(this.root,b.target)||this.content.mapOffset.root===b.target)&&this._closeDialog(b)},visibleDidChange:function(b){var d=this;b?(c.add(nokia.mh5.win,"viewportchange",d.resize,!1),c.add(nokia.mh5.doc.body,a.touchStart,d.onGlobalTap,!0),c.add(nokia.mh5.doc.body,"focus",d.onGlobalTap,!0),setTimeout(function(){d.content.settingsToggle.select("maps")},
1),this.update()):(c.remove(nokia.mh5.win,"viewportchange",d.resize,!1),c.remove(nokia.mh5.doc.body,a.touchStart,d.onGlobalTap,!0),c.remove(nokia.mh5.doc.body,"focus",d.onGlobalTap,!0));f.visibleDidChange.apply(d,arguments)},_updateUnitSystem:function(){this.content.settingsList.maps.unitSystemToggle.select(g.get("unitSystem"))},_updateTrafficIncidentSelection:function(){var b=this.content.settingsList.layers.trafficSettingsContainer;nokia.mh5.each(nokia.mh5.components.Traffic.getTrafficTypes(),function(c){var d=
g.get("traffic"+c+"Enabled"),f=b.renderedItems.filter(function(a){return a.value===c})[0].root;a[d?"addClass":"removeClass"](f,"mh5_selected")})},_updateTrafficOnOffButton:function(){var b=g.get("trafficIncidentsEnabled");a[b?"addClass":"removeClass"](this.content.settingsList.layers.trafficOnOffSwitch.renderedItems[0].root,"mh5_selected")},_updateMapModeSelection:function(){var a=this.content.settingsList.maps.mapModeRadioGroup,d=g.get("mapSchema"),f=a.items;"normal.day.grey"==d&&(d="normal.day.transit");
if(d)for(var m in f){if(f[m].schema===d){b=m;break}}else b=0;c.fire(a,"tap",{index:b,item:f[b]})},_changeIncidents:function(b,c){var d=a.hasClass(b,"mh5_selected");g.set("traffic"+c+"Enabled",!d);a[d?"removeClass":"addClass"](b,"mh5_selected");d=nokia.mh5.app.controller.current.page.traffic;d.checkInfoBubbleOnIncidentsChange();if(g.get("trafficIncidentsEnabled"))d["Incidents"==c?"showIncidents":"reloadIncidents"]();else d.hideIncidents()}}})})();nokia.mh5.provide("nokia.mh5.components.InfoBubble");
nokia.mh5.components.InfoBubble=function(){function g(a,b){y.font=b;y.textBaseline="bottom";y.fillStyle="rgb(255,255,255)";return y.measureText(a||" ").width}function a(a,b,c){for(var e=g(a,b);c<e;)a=a.substr(0,a.length-2)+"\u2026",e=g(a,b);return{text:a,textWidth:e}}function c(a){return Math.round(16*a/12)}function f(a,b){setTimeout(a.next=function(){return(b=a.shift())?!!b(a)||!0:!1},0);return a}function d(a,b,c){var e=(c||a.params)[b];"string"==typeof e?(c=new Image,c.src=e,c.onload=a.next,a[b]=
c):e.width||e.height?(a[b]=(c||a.params)[b],a.next()):e instanceof Image&&(e.addEventListener("load",function ba(){e.removeEventListener("load",ba,!1);a.next()},!1),a[b]=e)}function b(a){d(a,"left")}function e(a){d(a,"right")}function h(a){d(a,"image")}function j(a){A.star.src=nokia.mh5.assetsPath+"img/fullstar_icon.png";d(a,"star",A)}function m(a){A.hstar.src=nokia.mh5.assetsPath+"img/halfstar_icon.png";d(a,"hstar",A)}function p(a){A.estar.src=nokia.mh5.assetsPath+"img/emptystar_icon.png";d(a,"estar",
A)}function o(a,b,c){y.save();y.beginPath();y.strokeStyle="#FFFFFF";y.moveTo(a,b);y.lineTo(a,c-b);y.stroke();y.closePath();y.restore()}function q(b){var e=document.createElement("CANVAS"),d=b.params,n=nokia.mh5.extend({},b.data),f=b.left||B,g=b.right||B,h=b.image||B,t=0,w=Number.MAX_VALUE,j=0,m=0,p=0,q=0,z="background"in d?d.background:"rgba(0,15,26,0.85)",T=c(d.borderRadius||2),H=c(1),G=c(14),ua=c(12),ia=d.maxWidth||Number.MAX_VALUE,$,M=0,da=300,W=d.content,za,va,J;C.forEach(function(a){a in d&&
d[a]&&(n["title"==a?"name":a]=d[a])});Array.isArray(W)&&3<W.length&&(W=W.slice(0,3));y=e.getContext("2d");if(h!=B)p+=h.width+(z?26:0);else{if(f!=B&&(p+=26+f.width,$||g!=B))p+=1;if(g!=B&&(p+=26+g.width,$||f!=B))p+=1}if(W&&h==B){-1!=W.indexOf("rating")&&n.ratingValue&&(q+=16,M=70,$=!0);da=Math.max(ia-p-26,M);if(-1!=W.indexOf("title")&&n.name)q+=G+6,ia=a(n.name,"bold 14pt Arial",da),za=ia.text,M=Math.max(M,ia.textWidth),$=!0;if(-1!=W.indexOf("description")&&n.description)q+=ua+6,ia=a(n.description,"12pt Arial",
da),va=ia.text,M=Math.max(M,ia.textWidth),$=!0;if(-1!=W.indexOf("more")&&n.more)q+=ua+6,ia=a(n.more,"12pt Arial",da),J=ia.text,M=Math.max(M,ia.textWidth),$=!0}$&&(p+=M+26);q&&(q-=6);q=Math.max(q,f.height,g.height,h.height)+(z?16:0);e.width=p;e.height=q+(z?16:0);z&&D(e.width,q,H,T,z);if(h!=B)y.drawImage(h,z?j+13:0,z?~~((q-h.height)/2):0);else{f!=B&&(j+=13,y.drawImage(f,j,~~((q-f.height)/2)),j+=f.width+13,($||g!=B)&&d.leftDelimiter&&o(j,8,q),t=j);if($){j+=13;y.textBaseline="top";y.fillStyle="#FFFFFF";
m=v(za,"bold 14pt Arial",j,m,6,G);m=v(va,"12pt Arial",j,m,6,ua);m=v(J,"12pt Arial",j,m,6,ua);if(-1!=W.indexOf("rating")){r=0;for(m+=6;r<~~n.ratingValue;)s(A.star,r++,j,m);for(r<n.ratingValue&&s(A.hstar,r++,j,m);5>r;)s(A.estar,r++,j,m)}j=j+M+13}g!=B&&(w=j,$&&d.rightDelimiter&&o(j,8,q),y.drawImage(g,j+13,~~((q-g.height)/2)))}z&&(y.translate(p/2,q-1),u(z));y=null;nokia.mh5.event.add(e,"down",function(a){var b=d.listeners,c,e=a.offsetX||a.data.offsetX,a=a.offsetY||a.data.offsetY;if(b){if(b.leftclick&&
e<t)c=b.leftclick;else if(b.rightclick&&e>w)c=b.rightclick;else if(b.click)c=b.click;c&&c.call(this,{clickedPoint:{x:e,y:a}})}}.bind(this),!1);e.leftDelimiter=t;e.rightDelimiter=w;b.callback(e)}function v(a,b,c,e,d,n){if(a)d=e+=d,y.font=b,y.fillText(a,c,d),e+=n;return e}function s(a,b,c,e){y.drawImage(a,c+14*b,e)}function u(a){y.beginPath();y.moveTo(6,0);y.lineTo(0,14);y.lineTo(-6,0);y.closePath();y.fillStyle="rgb(255,255,255)";y.fill();y.fillStyle=a;y.fill();y.translate(0,14);y.save();y.scale(1.9,
1);y.beginPath();y.arc(0,0,2.6,0,2*Math.PI,!1);y.fillStyle="rgba(0,0,0,0.35)";y.fill();y.closePath();y.restore()}function D(a,b,c,e,d){var f=c/2,g=e+f,h=a-g,j=b-g;y.fillStyle=d;y.lineWidth=c;y.lineCap="round";y.moveTo(g,f);a=[h,f,h,g,e,w,z,a-f,j,h,j,e,z,t,g,b-f,g,j,e,t,n,f,g,g,g,e,n,w];b=0;for(c=a.length;b<c;)y.lineTo(a[b++],a[b++]),y.arc(a[b++],a[b++],a[b++],a[b++],a[b++]);y.fill()}document.createElement("CANVAS");var C=["title","description","more"],B={height:0,width:0},A={star:new Image,hstar:new Image,
estar:new Image},n=Math.PI,t=n/2,w=3*t,z=0;c(16);var y;return function(a,c,d){this.data=a;this.params=c;this.parent=c.parent;f([function(n){n.params=c;n.data=a;n.callback=d;c.hasOwnProperty("left")&&c.left&&n.unshift(b);c.hasOwnProperty("right")&&c.right&&n.unshift(e);c.hasOwnProperty("image")&&c.image&&n.unshift(h);c.hasOwnProperty("content")&&~c.content.indexOf("rating")&&(n.unshift(j),n.unshift(m),n.unshift(p));n.next()},q.bind(this)])}}();nokia.mh5.provide("nokia.mh5.internals.Map");
nokia.mh5.internals.Map=function(g){function a(a){var b=0,c=0;do b+=a.offsetLeft,c+=a.offsetTop;while(a=a.offsetParent);return{x:b,y:c}}function c(a,b){var c=nokia.mh5.event,e=c.add,d,n,f;e(a,"down",function oc(h){c.remove(a,"down",oc);d=c.isTouch||g.navigator.msPointerEnabled;b.init(d?"touch":"mouse");d?(n=b.touch,f=b.gesture,g.navigator.msPointerEnabled?(e(a,"touchstart",n.start),e(a,"touchmove",n.move),e(a,"touchend",n.end)):(e(a,"down",n.start),e(a,"move",n.move),e(a,"up",n.end)),e(a,Pb,f.start),
e(a,ab,f.change),e(a,Ca,f.end),g.navigator.msPointerEnabled||n.start(h)):(n=b.mouse,e(a,"down",n.down),e(a,"move",n.move),e(a,"up",n.up),e(a,pc,n.wheel),e(a,qc,n.wheel),n.down(h));c=e=d=n=f=null})}function f(a,b,c){function e(a,b,c,g,h,t,w,j,m,A,q,p){var w=w+(j-w)*q,o=R(a+w*m),z=R(b+w*A);o!=h||z!=t?(f.move(o-c,z-g),n=s(e,p,a,b,o,z,h,t,w,j,m,A,q,p)):d(f.end())}function d(){u(n);n=0}var n=0,f={kick:function(a,b,c,g){var c=9*c,h=9*g,g=ca(c*c+h*h),c=c/g,h=h/g,t=!0;n&&d();!D(c)&&!D(h)?(f.start(),e(a,b,
a,b,R(a+g*c),R(b+g*h),0,g,c,h,0.2,17)):t=!t;return t},stop:d,start:a||I,move:b||I,end:c||I};return f}function d(b,d,w){var A,q,o,z,D,P;function O(a){Va&&Ob(a||x[aa])}function J(){1===wa&&Ia(na,qa)}function Ia(a,b){var c=na=a,e=qa=b,c=c+A,e=e+q,n=!!bb,f=n&&bb.length,g=ra.add,h=~~(c/N),t=~~(e/N),j=c%N,s=e%N,e=oa-j,c=pa-s,m,o,h=h-(j=Z(e/N)),t=t-(s=Z(c/N)),e=e-N*j,c=c-N*s;E.clear();for(ra.clear();e<d;){s=c;for(j=t;s<w;){g("".concat(h,"-",j,"-",U,"-",Wa),h,j,e,s);if(n)for(m=0;m<f;)(o=bb[m](h,j,Da,U,X,
Wa))&&g(o,h,j,e,s,o),++m;s+=N;++j}e+=N;++h}Ka&&Ea.call(ab(),rc);Fa&&Ea.call(Ya(),sc);wb&&drawBuildings();Qb()}function ea(a,b,c,e){E.strokeStyle=a||zb;E.lineWidth=b||Ab;E.lineCap=c||Rb;E.lineJoin=e||Rb}function $a(a,b){for(var c=a.length,e=2*c,d=new Sb(e),n;c--;)n=ha(a[c],b),d[--e]=n.y,d[--e]=n.x;return d}function $(a,b){for(var c=a.length,e=new Sb(c),d;c--;)d={},d[fa]=a[c],d[ga]=a[c-1],d=ha(d,b),e[c--]=d.y,e[c]=d.x;return e}function ca(){return null!=na&&(ka=cb({x:na,y:qa},X))}function Ob(a){if(a){var b=
ha(a,X);Va=!Ia(b.x-o,b.y-z);ka={};ka[ga]=a[ga];ka[fa]=a[fa];j(x,"centerset",ka)}}function ja(a,b){"shape"in a&&(a=a.shape);for(var c=x.size,e=sa,d=N<<sa,n=[],f=[],g=0,h=0,t=a.length,w,j;g<t;++g)M(j=a[g])&&(j={latitude:j,longitude:a[++g]}),w=ha(j,d),n[h]=w.x,f[h++]=w.y;g=Q.apply(F,n);h=Q.apply(F,f);t=ba.apply(F,n);w=ba.apply(F,f);t=n=t-g;for(w=f=w-h;c.height<w||c.width<t;)w/=2,t/=2,--e;if(b)x[aa]=cb({x:n/2+g,y:f/2+h},d),x.zoom=e;return e<=sa&&La<=e?e:0}function xb(a){this.width=a;this._int32Vector=
[]}function kb(a){for(var b=N<<U,c=ha(a[0],b),b=ha(a[1],b),c=((b.x/N|0)+1-(c.x/N|0))*((b.y/N|0)+1-(c.y/N|0)),a=U,b=c;a++<sa&&(b+=c<<=2)<kb.max;);return--a}function yb(a){var b=!Ga;Ga="online"==a.type;W=da.src=Ga?db.settings.defaultImage||Bb.settings.defaultImage:nokia.mh5.assetsPath+"img/empty_tile_offline.png";b&&(ra.clear(),ra.gc(),O())}function lb(a,b,c,e,d,n,f,g){return(g-b)*(d-a)>(n-b)*(f-a)!=(g-e)*(d-c)>(n-e)*(f-c)&&(n-b)*(c-a)>(e-b)*(d-a)!=(g-b)*(c-a)>(e-b)*(f-a)}function sc(a){var b=a.shape,
c=a.style,a=na-oa,e=qa-pa,n=d+a,f=w+e,g=0,h=0,t=b.length,j,s,m;ea(c.color,c.width,c.cap,c.join);for(E.beginPath();g<t;){c=b[g];j=b[g+1];switch(!0){case a<=c&&e<=j&&c<=n&&j<=f:h&&(E.moveTo(b[g-2]-a,b[g-1]-e),h=0);case !h++:g?E.lineTo(c-a,j-e):E.moveTo(c-a,j-e);break;case lb(s=b[g-2],m=b[g-1],c,j,a,e,n,f):case lb(s,m,c,j,n,e,a,f):E.moveTo(s-a,m-e),E.lineTo(c-a,j-e),h=0}g+=2}E.stroke()}function Ya(){eb[U]||Ea.call(Fa,tc,eb[U]=[]);return eb[U]}function mb(a){return a&&ga in a&&fa in a&&!a.shape}function tc(a,
b){var c=M(a[0])||mb(a[0])?a:a.shape;eb[U][b]={style:a==c?0:a,shape:M(c[0])?$(c,X):$a(c,X)}}function Ca(a){var a=a.shape||a,b=this.x,c=this.y,e=a.length,d=0,n=!1,f,g,h,t,w,j,s;h=a[e-2];for(t=a[e-1];d<e;)f=a[d++],g=a[d++],f>h?(w=h,s=f,j=t,t=g):(w=f,s=h,j=g),f<b==b<=h&&(c-j)*(s-w)<(t-j)*(b-w)&&(n=!n),h=f,t=g;return n}function rc(a){for(var b=a.shape,a=a.style,c=na-oa,e=qa-pa,n=d+c,f=w+e,g=0,h=b.length,t,j,s,m;g<h;){t=b[g];j=b[g+1];if(c<=t&&e<=j&&t<=n&&j<=f||lb(s=b[g-2],m=b[g-1],t,j,c,e,n,f)||lb(s,m,
t,j,n,e,c,f)){E.beginPath();E.fillStyle=a.color||"rgba(100,100,100,.1)";E.moveTo(b[0]-c,b[1]-e);for(g=2;g<h;)E.lineTo(b[g]-c,b[g+1]-e),g+=2;E.fill();E.fillStyle=Cb;break}g+=2}}function Za(a,b){return Ma[U][b].shape.length!=(a.shape||a).length}function ab(){if(!Ma[U]||Db.call(Ka,Za).length)Ea.call(Ka,vb,Ma[U]=[]);return Ma[U]}function vb(a,b){var c=M(a[0])||mb(a[0])?a:a.shape;Ma[U][b]={origin:Ka[b],style:a==c?0:a,shape:M(c[0])?$(c,X):$a(c,X)}}function ha(a,b){var c=a[fa]/360+0.5,e=Q(1,ba(0,0.5-Ja(S(ua+
G*a[ga]/180))/H/2));return{x:R(c*b),y:R(e*b)}}function cb(a,b){var c=a.x/b,e=a.y/b,d={};d[ga]=0>=e?90:1<=e?-90:ia*(2*ya(K(H*(1-2*e)))-G);d[fa]=360*(1===c?1:(c%1+1)%1)-180;return d}var Na=uc(),fb=b.appendChild(va()),E=fb.getContext("2d"),xa=a(fb);D=0;P=0;o=0;z=0;A=0;q=0;var x={},Eb=0,Va=0,wa=1,wb=0,Ga=C.onLine,Ha=!0,Oa=!0,gb=0,Fa=null,bb=null,eb=[],zb=Tb,Cb="rgba(0,0,0,1)",Ab=9,Rb="round",Ub=0,Fb="%[1-4]%.maps.nlp.nokia.com",nb="maptile",Vb="newest",Ka=null,Wb,Ma,na,qa,ka,X,U,Wa,Da,oa,pa,Pa,Qa,ra,
db,Bb,ob,Qb,ta,Xb,Xa,Y,V,Gb,Ra,la,Yb,Hb="?",pb;try{E.mozImageSmoothingEnabled=!1}catch(Pb){}t(x,"box",ka={get:function(){var a=ha(x[aa],X),b;a.x-=oa;a.y-=pa;b=cb(a,X);a.x+=d;a.y+=w;a=cb(a,X);return[b,a]},set:function(a){ja(a,!0)}});t(x,"bbox",ka);t(x,"apiKey",{set:function(a){Hb="?app_id="+a.appId+"&token="+a.appCode},get:function(){return Hb}});t(x,aa,ka={get:function(){return ka||ca()},set:Ob});t(x,"centre",ka);ka=0;la={resetDefault:function(){la.defaultPrevented=!1},preventDefault:function(){la.defaultPrevented=
!0}};t(x,"geoToPoint",{value:function(a){return ha(a,X)}});t(x,"getZoomLevelFor",{value:ja});t(x,"layer",{get:function(){return bb},set:function(a){bb=a&&[].concat(a)}});t(x,"move",{value:function(a,b){Ia(na+a,qa+b);(a||b)&&(ka=0)}});xb.prototype.set=function(a,b,c){var e,d,n,f;for(e=0;e<c;e++)for(d=0;d<c;d++)n=a+e,f=b+d,n=f*this.width+n,f=n>>5,this._int32Vector[f]|=1<<n-(f<<5)};xb.prototype.get=function(a,b){a=b*this.width+a;b=a>>5;return this._int32Vector[b]&1<<a-(b<<5)};kb.max=2200;t(x,"maxStorableZoom",
{value:function(a){a||(a=x.box);return kb(a)}});t(x,"areaToTiles",{value:function(a){a||(a=x.box);var b=a,c=U,a=kb(a),c=ba(c,La),a=Q(a,sa),e=[],d=[4,3,2,1],n=N<<c,f=ha(b[0],n),g=ha(b[1],n),b=f.x/N|0,f=f.y/N|0,n=(g.x/N|0)+1,g=(g.y/N|0)+1,h=n-b,t=g-f,w,j,s,m,A;for(m=c;m<=a;m++){A=new xb(h,t);for(j=b;j<n;j++)for(s=f;s<g;)if(A.get(j-b,s-f))s++;else{for(c=0;w=d[c];c++)if(0===j%w&&0===s%w&&j-b+w<=h&&s-f+w<=t){e.push({x:j,y:s,z:m,size:w});A.set(j-b,s-f,w);break}s+=w||1}h<<=1;t<<=1;b<<=1;n<<=1;f<<=1;g<<=
1}return e}});t(x,"offset",{get:function(){return{left:xa.x,top:xa.y}},set:function(a){xa={x:~~(ma.call(a,"x")?a.x:a.left)||0,y:~~(ma.call(a,"y")?a.y:a.top)||0}}});t(x,"geometry",{get:function(){return{left:D,top:P}},set:function(a){D=~~(ma.call(a,"x")?a.x:a.left)||0;P=~~(ma.call(a,"y")?a.y:a.top)||0;o=void 0;z=void 0;o=R(D/2);z=R(P/2)}});g.addEventListener("online",yb,!1);g.addEventListener("offline",yb,!1);(function(a){function b(a,c){var e=a.zIndex_,d=c.zIndex_;return e===d?0:e<d?-1:1}function c(){y.sort(b)}
function e(a){return"string"!=typeof a&&a.constructor!=n&&!(a instanceof Image)}function f(a,b){var c=a.info_;if("string"==typeof c.text){var e=m.createElement("canvas"),d=e.getContext("2d"),n=b.width,g=b.height,h=c.text,t;c||(c={});e.width=n;e.height=g;d.drawImage(b,0,0,n,g);d.textBaseline=c.textBaseline||"top";d.fillStyle=c.fillStyle||c.color||"rgb(255,255,255)";d.font=c.font||"bold "+(c.fontHeight||~~(g/3)+"px")+" sans-serif";t=d.measureText(h||"").width;d.fillText(h,c.x||(n-t)/2,c.y||~~(g/3-3));
c=e}else c=b;a.img_=c}function g(){var a=this._,b,c;for(this.onload=null;a.length;)b=a.shift(),b.loaded=1,this===b.img_&&f(b,this),(c=b.onload)&&c.call(b)}function h(){var a=qb.call(C,this);~a&&(C.splice(a,1),ta(this,X),y.push(this),J())}function j(a){var b=a.height/2;if(b=T(a.x-this.x)<a.width/2&&T(a.y-b-this.y)<b)a.clickedPoint.x=this.x-a.x,a.clickedPoint.y=this.y-a.y;return b}function o(a){a.loaded?(ta(a,X),y.push(a),J()):(C.push(a),a.onload=h)}function p(a){var b=qb.call(C,a);~b?C.splice(b,1):
~(b=qb.call(y,a))&&y.splice(b,1)}var z={writable:!0,value:null},D={},y=[],C=[],v=0,B,x,M;Gb=function(b,c){var e=ha(a[aa],X);e.x+=b-oa+A;e.y+=c-pa+q;return Db.call(y,j,e).concat(V&&T(V.x-e.x)<V.width/2&&T(V.y-e.y)<V.height/2&&V||[]).reverse()};ob=function(a,b,c){var e,d,n=a.scale_,c=a.y-c,f=null!=a.locationX?a.locationX:0.5,g=null!=a.locationY?a.locationY:1;E.drawImage(a.image,a.x-b-(e=a.width/wa*n)*f,c-(d=a.height/wa*n)*g,e,d)};Qb=function(){for(var a=na-oa+A,b=qa-pa+q,c=d+a,e=w+b,n=0,f=0,g=y.length,
h,t,j,s,m,o=[[],[],[]];n<g;)j=y[n++],f=j.x,s=j.y,a<f&&b<s&&f<c&&s<e&&(j.privileged_?m=j:null!=j.privilegeLevel?o[j.privilegeLevel].push(j):ob(j,a,b));for(n=0;s=o[n];n++)for(f=0;f<s.length;f++)ob(s[f],a,b);if((j=V)&&j.loaded)if(f=j.x,s=j.y,a<f&&b<s&&f<c&&s<e){s-=b;f-=a;if(!Oa&&!Ha&&(g=~~(Y[Ib]*X/4.007501668E7)))E.fillStyle="rgba(61,137,12,0.2)",E.drawCircle(f,s,g),E.fillStyle=Cb;E.drawImage(j.image,f-(h=j.width/wa)/2,s-(t=j.height/wa)/2,h,t)}(j=m)&&ob(j,a,b)};ta=function(a){var b=ha(a,X),c=a.img_;
a.x=b.x;a.y=b.y;a.width=c.width;a.height=c.height};Xb=function(){Ea.call(y,ta);V&&ta(V)};Xa=function(a,b){var c=typeof a==Zb||a instanceof Image||e(a)?{image:a}:a,d=c.image;this.zIndex_=0;this.lt_=b[ga];this.ln_=b[fa];this.scale_||(this.scale_=1);this.data=b;this.clickedPoint={x:0,y:0};this.info_=c;"string"==typeof d?ma.call(D,d)?((c=this.img_=D[d])._.push(this),c.onload||g.call(c)):(c=this.img_=D[d]=new Image,c.onload=g,c._=[this],c.src=d,this.width=this.height=0):(f(this,d),this.loaded=1)};B={zIndex_:z,
lt_:z,ln_:z,img_:z,info_:z,scale_:z,privileged_:z,clickedPoint:z,x:z,y:z,width:z,height:z,data:z,onload:z,loaded:z,constructor:{value:x=Xa},zIndex:{enumerable:!0,get:function(){return this.zIndex_},set:function(a){this.zIndex_=a;u(v);v=s(c,60)}},toJSON:{value:function(a){var b={};for(a in this)!ma.call(B,a)&&!/_$/.test(a)&&(b[a]=this[a]);b.icon=this.img_.src;b[ga]=this.lt_;b[fa]=this.ln_;return b}},image:{enumerable:!0,get:function(){return this.img_},set:function(a){a instanceof Image||e(a)?(f(this,
a),ta(this)):(p(this),typeof a==Zb?this.info_.image=a:this.info_=a,this.loaded=0,x.call(this,this.info_,this),o(this));J()}},isPosition:{enumerable:!0,get:function(){return this==V}},privileged:{enumerable:!0,get:function(){return!!this.privileged_},set:function(a){var b;if(a){for(b=y.length;b--;)y[b].privileged_=!1;b=qb.call(y,this);~b&&(y.push(this),y.splice(b,1))}this.privileged_=!!a;J()}},coordinate:M={get:function(){return this},set:function(a){this.lt_=a[ga];this.ln_=a[fa];ta(this);J()}},coords:M,
latitude:{enumerable:!0,get:function(){return this.lt_},set:function(a){this.lt_=a;ta(this);J()}},scale:{get:function(){return this.scale_},set:function(a){this.scale_=a;J()}},longitude:{enumerable:!0,get:function(){return this.ln_},set:function(a){this.ln_=a;ta(this);J()}}};jb?Xa=za($b+"Poi"+ac,B):Jb(Xa.prototype,B);t(a,"addPoi",{value:function(a){Ea.call([].concat(a),o);u(v);v=s(c,60)}});t(a,"createPoi",{value:function(a,b){o(a=new Xa(a,b));return a}});t(a,"removePoi",{value:function(a){null==a?
(C=[],y=[]):Ea.call([].concat(a),p);J()}})})(x);t(x,"pointToGeo",{value:function(a){return cb(a,X)}});t(x,"position",{get:function(){function a(b){b=b.coords||b.data.coords;Y[ga]=b[ga];Y[fa]=b[fa];Y[Ib]=b[Ib];Y.heading=b.heading;Y.speed=b.speed;Y.available=!0;if(V)Oa=Ha=!1,V.coords=b,j(x,hb,Y);else if(Y.marker)V=new Xa(nokia.mh5.assetsPath+"img/position.png",b),V.onload=function(){if(V)ta(V),V.loaded=1,J()},V.image.width&&ta(V),f(Y)}function b(a){c();g(a)}function c(a){Y.available=!1;V=null;J();a&&
j(x,rb,Y)}var d=nokia.mh5.geolocation,n=function(){h(d,type,data)},f,g;Y={marker:!0,deactivate:function(){n(Kb,c);n(rb,c);n(Lb,a);n(hb,a);n(sb,b);d.deactivate();c()},activate:function(n,h){if("disabled"==d.status)return h({type:sb});f=n;g=h;if(V)return f(Y);e(d,Kb,c);e(d,rb,c);e(d,Lb,a);e(d,hb,a);e(d,sb,b);d.available?a({data:d}):d.activate()},toJSON:function(){var a={};a[ga]=Y[ga];a[fa]=Y[fa];return a},available:!1};return function(){return Y}}()});t(x,"route",{get:function(){return Fa&&1==Fa.length?
Fa[0]:Fa},set:function(a){a?(eb=[],Fa=!bc(a)||M(a[0])||mb(a[0])?[a]:a):Fa=null;J()}});t(x,"shape",{get:function(){return Wb},set:function(a){a?(Ma=[],Wb=a,Ka=!bc(a)||M(a[0])||mb(a[0])?[a]:a):Ka=null;J()}});t(x,"scale",{get:function(){return wa},set:function(a){1===wa&&1!==a&&(j(x,cc,{}),Ha=!0);E.clearRect(0,0,d,w);wa=a;E.save();E.setTransform(a,0,0,a,-a*(Pa-A)+(Pa-A),-a*(Qa-q)+(Qa-q));Ia(na,qa);E.restore()}});t(x,Sa,{get:function(){return Ub?dc+".traffic":Wa},set:function(a){(Ub=/\btraffic\b/.test(a))?
(Wa=dc+".grey",nb="traffictile",Fb="maps.nlp.nokia.com"):(Wa=a,nb="maptile",Fb="%[1-4]%.maps.nlp.nokia.com");Vb="newest";ra.clear();ra.gc();O()}});t(x,"size",{get:function(){return{width:d,height:w}},set:function(a){var b=Va&&x[aa];ma.call(a,"width")?(d=a.width,w=a.height):(d=a[0],w=a[1]);oa=Pa=~~(d/2);pa=Qa=~~(w/2);fb.width=d;fb.height=w;E.font="7pt sans-serif";E.textBaseline="top";E.fillStyle=Cb;ea();O(b)}});Jb(x,{restore:{value:function(){var a=Na.get(aa),b=Na.get(Ta),c=Na.get(Sa);Na.get(vc);null!=
b&&(x[Ta]=b);null!=c&&(x[Sa]=c);a&&(x[aa]=a);return!!a}},save:{value:function(){var a=x[Sa],b=x[Ta],c=Va&&x[aa];a&&Na.set(Sa,a);b&&Na.set(Ta,b);c&&(c={},c[ga]=x[aa][ga],c[fa]=x[aa][fa],Na.set(aa,c))}}});t(x,"tileServer",{get:function(){return db},set:function(a){var b;db=a||Bb;Ga?(b=db.settings.defaultImage)&&(W=da.src=b):yb({});ra.clear();ra.gc();O()}});t(x,"tileLang",{get:function(){return pb},set:function(a){pb=a}});Bb={settings:{defaultImage:nokia.mh5.assetsPath+"img/empty_tile.png"},create:function(a,
b,c){var e=new Image;e.src="http://".concat(Fb.replace(/\%\[1\-4\]\%/,1+c%4),"traffictile"===nb?"/maptile/2.0/":"/maptiler/v2/",nb,"/",Vb,"/",Wa,"/",a,"/",b,"/",c,"/",N,"/png8",Hb,"&",pb?"lg="+pb:"");return e}};(function(){function a(){1===x.scale&&(f=!0,x.moveTo(c))}function b(){f||(x.tracking=!1);f=!1}var c=x.position,d=!1,n,f;t(x,"tracking",{get:function(){return d},set:function(g){g=!!g;g!=d&&(n=(d=g)?e:h,la.resetDefault(),d?(j(x,ec,la),la.defaultPrevented||(c.available&&a(),f=!1)):j(x,fc,la),
n(x,hb,a),n(x,Mb,b),n(x,Nb,b))}})})();(function(){function a(){Ga&&(this._layer&&(e[this._id]=1),delete d[this._id])}function b(){this.loaded=1;if((Ha||Oa)&&!--g)Ha=Oa=!1;f||(f=v(J,500))}function c(a){if(!(a in this))d[a].onload=null,d[a].src=W,delete d[a]}var e={},d={},n={},f=0,g=0;v(function(){Ga&&(Ra||ra.gc())},/iP(?:ad|od|hone)/.test(B)?1E4:wc);ra={gc:function(){Ea.call(gc(d),c,n)},add:function(c,f,h,t,j,w){var s=d[c];n[c]=1;if(!s&&(x.tracking||!Ra)){if(w){if(!(c in e))s=d[c]=new Image,s.src=
w,s._layer=!0}else s=d[c]=db.create(U,(f%Da+Da)%Da,(h%Da+Da)%Da);if(s)s.onload=b,s.onerror=a,s._id=c}else s&&s.loaded?s.complete&&E.drawImage(s,t,j):((!Ga||!Ha&&!Oa)&&w!=c&&da.complete&&E.drawImage(da,t,j),++g)},clear:function(){g=0;n={}}}})();t(x,"toJSON",{value:function(a){a={_:a};a[aa]=x[aa];a[Ta]=x[Ta];a[Sa]=x[Sa];return a}});Yb=function(a){a=ba(Q(a,sa),La);if(U!=a){var b=Va&&x[aa];Va&&(x.scale=L(2,a-U));Ha=!1;Oa=!0;16<a?(zb=xc,Ab=8):(zb=Tb,Ab=5);X=N<<a;Da=1<<a;j(x,hc,{oldValue:U,newValue:a});
U=a;ea();Ga&&ra.gc();Xb();x.route=x.route;wa=1;O(b)}else wa=1};t(x,Ta,{get:function(){return U},set:function(a){Yb(a)}});Jb(x,{MAX_ZOOM_LEVEL:{get:function(){return sa},set:function(a){sa=null==a?yc:a}},MIN_ZOOM_LEVEL:{get:function(){return La},set:function(a){La=null==a?ib:a}}});var N=256;(function(){function a(b){e(x,b,this)}function b(a){h(x,a,this)}function c(a,b){[ic,jc,Mb,kc,lc,hc,cc,Nb,mc,ec,fc,hb,rb,sb,Lb,Kb].forEach(a,b)}var d=[],n=[],f;t(x,"addNotifications",{value:function(b){f=d.indexOf(b);
0>f&&(f=d.push(b)-1,c(a,n[f]={handleEvent:function(a){j(b,a.type,a.data)}}))}});t(x,"dropNotifications",{value:function(a){f=d.indexOf(a);-1<f&&(c(b,n[f]),d.splice(f,1),n.splice(f,1))}})})();c(fb,function(){function a(b,c){var e=x.geoToPoint(x.center),d=x.size;return x.pointToGeo({x:e.x-d.width/2+b,y:e.y-d.height/2+c})}function b(c,e){d();j(x,lc,a(c,e))}function c(){gb&&(u(gb),Pa=oa,Qa=pa,gb=0,++x.zoom)}function e(a,b){if(2===ba(x.scale+0.1,2))x.scale+=0.1,gb=s(e,30,a,b);else{x.scale=2;var d=E.drawImage,
n=E.clearRect,f=E.drawCircle,g=E.lineTo;E.drawImage=E.clearRect=E.drawCircle=E.lineTo=I;c();x.move(a,b);E.drawImage=d;E.clearRect=n;E.drawCircle=f;E.lineTo=g}}function d(){u(W);W=0}function n(a,b){d();b.length&&j(x,zc,b);if(a.length){if(!a[0].privileged_)a:{for(var c=0,e=a.length,f;e--;){f=a[e];if(f.privileged_){a.splice(e,1);a.unshift(f);f.privileged=1;break a}if("privilegeLevel"in f&&(!("privilegeLevel"in a[c])||f.privilegeLevel>a[c].privilegeLevel))c=e}0<c&&a.unshift(a.splice(c,1)[0])}j(x,ic,a)}}
function g(a){if(!va&&(da(a),!Ra&&!(tb<T(Ua-R)||tb<T(H-G)))){ub(a);var c=(Z||a.pageX)-xa.x,a=(ea||a.pageY)-xa.y,f=Gb(c,a),h;h=c;var t=a;if(Ka){var w=ha(x[aa],X);w.x+=h-oa+A;w.y+=t-pa+q;h=Db.call(Ma[U],Ca,w).reverse()}else h=[];f.length||h.length?(d(),W=s(n,Q,f,h)):W?(d(),la.resetDefault(),j(x,Nb,la),!la.defaultPrevented&&x.zoom<sa&&(c-=oa-A,a-=pa-q,Pa+=c,Qa+=a,gb=s(e,Q,c,a))):(Pa=oa,Qa=pa,W=s(b,Q,c,a))}}function h(a){L?(K=new y,ub(a),a=(a.touches||[a])[0],R=a.screenX,G=a.screenY,S?x.move(N=Ba-R,ib=
Aa-G):S=(tb<T(Ua-R)||tb<T(H-G))&&m(),Ba=R,Aa=G):(a=(a.touches||[a])[0],Ba=a.screenX,Aa=a.screenY)}function w(){D(ka=0);j(x,kc,{})}function m(){M();Oa=Ha=!1;la.resetDefault();j(x,Mb,la);return!la.defaultPrevented}function D(a){Ua=R=Ba=N=H=G=Aa=ib=0;return a}function C(){return 100>new y-K&&D(F.kick(Ba,Aa,N,ib))}function v(){Ra=0}function B(){Eb=0;L=1}function M(){u(J);J=0}function P(){M();va=1;j(x,mc,a(Z-xa.x,ea-xa.y))}function O(){1!==ja&&(x.scale=ja);za=s(O,20)}var Q=250,da=jb?function(a){a.pageX=
a.clientX+p.scrollLeft;a.pageY=a.clientY+p.scrollTop}:I,F=f(function(){Ra=1},function(a,b){x.move(a,b)},function(){Ra=0;Ia(na,qa);w()}),W=0,J=0,L=1,S=1,va=0,za=0,Ua,H,Ba,Aa,R,G,Z,ea,N,ib,K,ja;t(x,"moveTo",{value:function(a){var a=ha(a,X),b=a.x-na-o,a=a.y-qa-z;m()&&F.kick(b+oa,a+pa,b/9,a/9)}});return{init:function(a){"mouse"==a&&(L=0)},mouse:{down:function(a){da(a);J=s(P,800);c();F.stop();ub(a);K=va=0;Ua=Ba=R=a.screenX;H=Aa=G=a.screenY;Z=a.pageX;ea=a.pageY;L=1;S=0},move:function(a){da(a);L&&(S||(S=
m()));h(a);L||(a=Gb(a.pageX-xa.x,a.pageY-xa.y),a.length&&j(x,jc,a))},up:function(a){M();Ba!=Ua||Aa!=H?C()||w():L&&s(v,50)&&g(a);L=0},wheel:function(a){var b=0>(a.detail||a.wheelDelta)?1:-1;ma.call(a,"wheelDelta")||nc&&(b*=-1);x.zoom-=b}},touch:{start:function(a){var b=a.touches,e=b.length;ub(a);if(!(1<e)&&(J=s(P,800),c(),K=va=0,L))F.stop(),S=0,L=2>e,a=b[0],Ua=Ba=R=a.screenX,H=Aa=G=a.screenY,Z=a.pageX,ea=a.pageY},move:function(a){h(a)},end:function(a){var b=a.touches;J&&M();L?S?C()||w():(Ra=0,g(a)):
(L=!Eb&&2>b.length)&&Ia(na,qa)}},gesture:{start:function(){M();F.stop(v());Eb=1;ca(L=S=0);O(ja=1)},change:function(a){ja=a.scale},end:function(){clearInterval(za);x.zoom+=0.9>ja?-(0.1>ja?3:0.5>ja?2:1):1.1<ja?3<ja?3:2<ja?2:1:0;s(B,33)}},click:g}}(x));jb&&(x=za($b+ac++,x)());x.tileServer=null;x.size=[d||b.offsetWidth,w||b.offsetHeight];x.zoom=12;x.schema="normal.day";return x}var b=nokia.mh5.event,e=b.add,h=b.remove,j=b.fire,m=g.document,p=m.documentElement,o=g.escape,q=g.unescape,v=g.setInterval,s=
g.setTimeout,u=g.clearTimeout,D=g.isNaN,C=g.navigator,B=C.userAgent,A=g.Array,n=g.Object,t=n.defineProperty,w={}.__defineGetter__,z={}.__defineSetter__,y=g.Date,O=g.Function,I=O(),P=g.JSON,F=g.Math,Q=F.min,ba=F.max,Ja=F.log,ya=F.atan,K=F.exp,ca=F.sqrt,L=F.pow,S=F.tan,R=F.round,Z=F.ceil,T=F.abs,H=F.PI,G=H/2,ua=H/4,ia=180/H,$=2*H,M=function(a){return typeof a==Ia},da=new Image,W,za,va,J=!!m.createElement("canvas").getContext,ea=!!t,$a=!!w&&!!z,nc=!+"\u000b1",jb;if(ea)try{if(!t({},"_",{value:1})._)throw ea;
}catch(Ob){ea=!ea}jb=!(ea||$a);var $b="Gaia_",Ia="number",Zb="string";(new y).getFullYear();var Ya=J?"addEventListener":"attachEvent",ga="latitude",fa="longitude",sa=20,La=3,yc=sa,ib=La,ic="poiclick",jc="poiover",zc="shapeclick",vc="position-available",Mb="mapmovestart",kc="mapmoveend",lc="mapclick",hc="mapzoomchange",cc="mapscalechange",Nb="mapdblclick",mc="maplongpress",ec="maptrackingstart",fc="maptrackingend",aa="center",Ta="zoom",Sa="schema",Ib="accuracy",hb="positionchange",rb="positionlost",
sb="positionerror",Lb="positionactivate",Kb="positiondeactivate",xc="rgba(102,17,68,0.55)",Tb="rgba(102,17,68,0.69)",pc=(J?"":"on")+"mousewheel",qc="DOMMouseScroll",Pb="gesturestart",ab="gesturechange",Ca="gestureend",wc=6E4,tb=9,dc="normal.day";ea||(t=$a?function(a,b,c){ma.call(c,"value")?a[b]=c.value:(ma.call(c,"get")&&w.call(a,b,c.get),ma.call(c,"set")&&z.call(a,b,c.set));return a}:function(a,b,c){a[b]=c;return a});var Jb=n.defineProperties||function(a,b){for(var c=gc(b),e=c.length,d;e--;)ma.call(b,
d=c[e])&&t(a,d,b[d])},gc=n.keys||function(a){var b=[],c=0,e;for(e in a)ma.call(a,e)&&(b[c++]=e);return b},vb=n.prototype,ma=vb.hasOwnProperty,wb=vb.toString,Ac=wb.call([]),bc=A.isArray||function(a){return wb.call(a)==Ac},Za=A.prototype,Db=Za.filter||function(a,b){for(var c=[],e=0;e<this.length;++e)a.call(b,this[e],e,this)&&c.push(this[e]);return c},Ea=Za.forEach||function(a,b){for(var c=0;c<this.length;++c)a.call(b,this[c],c,this)},qb=Za.indexOf||function(a){for(var b=this.length;b--&&this[b]!==a;);
return b},Bc=Za.slice,Sb=g.Int32Array||A;s(function(a){if(!a){var b=s,c=v,e=function(a,b,c,e){e=Bc.call(e,2);return a(function(){b.apply(this,e)},c)};s=function(a,c){return e(b,a,c,arguments)};v=function(a,b){return e(c,a,b,arguments)}}},0,1);var ub=J?function(a){a.preventDefault()}:function(a){(a||g.event).returnValue=!1};"on"+Ca in m||Ya in m&&function(){function a(c,e,n){A=m.createEvent("Event");A.initEvent(n,d,d);A.scale=n==ab?s=b(e)/j:n==Ca?s:1;(c.target||m).dispatchEvent(A)}function b(a){w=
a[0];o=w[c];q=w[e];w=a[a.length-1];z=w[c];p=w[e];return ca(L(p-q,2)+L(z-o,2))}if(!m["_on"+Ca]){var c="screenX",e="screenY",d=!0,n=!1,f=!1,h,t,w,j,s,A,o,z,q,p;g.navigator.msPointerEnabled&&function(a){function b(a,c,e){h=m.createEvent("Event");h.initEvent(e,d,d);h.touches=c;h.isTouch=!0;(a.target||m).dispatchEvent(h)}function c(a,d){f=a.pointerId;g=e[f];if(void 0!==g){n.splice(g,1);delete e[f];for(var h in e)e.hasOwnProperty(h)&&e[h]>g&&e[h]--;d&&b(a,n,"touchend")}}var e={},n=[],f,g,h;nokia.mh5.event.add(a,
"MSPointerDown",function(a){f=a.pointerId;if(void 0===e[f])e[f]=n.length,n[n.length]=a,b(a,n,"touchstart")});nokia.mh5.event.add(a,"MSPointerMove",function(a){f=a.pointerId;void 0!==e[f]&&(n[e[f]]=a,b(a,n,"touchmove"))});nokia.mh5.event.add(a,"MSPointerUp",function(a){c(a,!0)});nokia.mh5.event.add(a,"MSPointerCancel",function(a){c(a,!1)})}(m);m[Ya]("touchstart",function(c){h=n;t=c.touches||[];n=1<t.length;n!=h&&(f=d,j=b(t),a(c,t,"gesturestart"))},d);m[Ya]("touchmove",function(b){n&&!f&&a(b,b.touches||
[],ab);f=!1},d);m[Ya]("touchend",function(b){t=b.touches||[];n&&2>t.length&&(n=!1,a(b,t,Ca))},d);m["_on"+Ca]=d}}();var uc=function(){var a=P.stringify,b=P.parse,c=g.localStorage,e=0;return function(){var d={get:function(a){var c=""+m.cookie,e=c.indexOf((a=o(n+a))+"=");return~e?b(q(c.slice(e+a.length+1).split(";")[0])):null},set:function(b,c){var e=new y;e.setFullYear(e.getFullYear()+1);m.cookie="".concat(o(n+b),"=",o(a(c)),";","expires=",e.toGMTString())}},n=++e+"html5-map-";return{get:c?function(a){var e=
c.getItem(n+a);try{return null===e?d.get(a):b(e)}catch(f){return null}}:d.get,set:c?function(b,e){try{c.setItem(n+b,a(e))}catch(f){d.set(b,e)}}:d.set}}}();J&&(va=function(){function a(b,c,e){this.beginPath();this.arc(b,c,e,0,$);this.fill()}return function(){var b=m.createElement("canvas"),c=b.getContext("2d");c.clear=I;c.drawCircle=a;return b}}());var ac=0;d.MAX_ZOOM_LEVEL=sa;d.MIN_ZOOM_LEVEL=La;return d}(this);nokia.mh5.provide("nokia.mh5.internals.CartoPOI");
nokia.mh5.internals.CartoPOI=nokia.mh5.Class(function(){function g(){if(this._timeout)clearTimeout(this._timeout),this._timeout=0}function a(a){var b;a.placeId=a.id;delete a.id;if(a.placeId&&!(a.placeId in this._cache)&&(a={categoryGroup:o(a.category),placeId:a.placeId,cartopoi:!0,latitude:a.lat,longitude:a.lon,name:a.location_name,categories:[{id:a.category,cartopoi:!0}],properties:{cartopoi:!0,placeId:a.placeId,priority:a.priority,title:a.location_name,geoLatitude:a.lat,geoLongitude:a.lon}},this._cache[a.placeId]=
1,b=o(a.categories[0].id)))a=this._map.createPoi(nokia.mh5.assetsPath+"img/mapsymbols/carto_POI_"+b+".png",a),a.zIndex=-1,this._draw.push(a)}function c(){this.parentNode&&this.parentNode.removeChild(this)}function f(){this._map.removePoi(this._drawn);this._poi={};this._cache={};this._drawn=[]}function d(a,b){a._zoomtimeout=0;if(b!==a._zoom)a._clearTimeout(),a._zoom=b,f.call(a),14<b&&(a._timeout=setTimeout(a._boundmove,1E3))}function b(){for(var a=this._wrapper,b=this._wrapper.infoBubbles,c,e=0,d=
b.length;e<d;e++)c=b[e],c.poi.data.cartopoi&&a.hideInfoBubble(c)}function e(a,b,c,e){14<e&&(this._poi[(e-3>>0)+"/"+(a/8>>0)+"/"+(b/8>>0)]=1)}function h(a){clearTimeout(this._zoomtimeout);this._zoomtimeout=setTimeout(d,1,this,a.data.newValue)}function j(){var b=nokia.mh5.doc,e=this,d=e._poi,f=[],g=[],h=0,j,m,n;if(p.onLine)for(m in d)++h,j=b.body.appendChild(b.createElement("script")),j.src="http://b.heatmaps.maps.svc.ovi.com/heatmaps/v2/mapsymbols.default/"+m+"/1024/jsonp",j.onload=j.onerror=c;if(h)n=
function(){if(!--h){for(m in d)f=f.concat(d[m]);f.forEach(a,{_cache:e._cache,_map:e._map,_draw:g});e._drawn=e._drawn.concat(g)}},mapsymbols.callback=function(a,b){d[a]=b;n()};this._poi={};this._clearTimeout()}if(!("mapsymbols"in window))window.mapsymbols={};var m=nokia.mh5.event,p=nokia.mh5.win.navigator,o=nokia.mh5.utils.place.categoryIdentifier;return{constructor:function(a,c){this._active=!1;this._bound=e.bind(this);this._boundmove=j.bind(this);this._boundzoom=h.bind(this);this._boundHideInfoBubble=
b.bind(this);this._boundCleanPois=f.bind(this);this._clearTimeout=g.bind(this);this._poi={};this._cache={};this._drawn=[];this._map=c;this._wrapper=a;this._zoomtimeout=this._timeout=this._zoom=0},activate:function(){if(!this._active){var a=this._map,b=[].concat(a.layer||[]);b.push(this._bound);a.layer=b;m.add(a,"mapscalechange",this._boundHideInfoBubble);m.add(a,"mapscalechange",this._boundCleanPois);m.add(a,"mapzoomchange",this._boundzoom);m.add(a,"mapmoveend",this._boundmove);m.add(a,"mapmovestart",
this._clearTimeout);this._boundzoom({data:{newValue:a.zoom}});this._active=!0}},deactivate:function(){if(this._active){var a=this._map,b=[].concat(a.layer);b.splice(b.indexOf(this._bound),1);a.removePoi(this._drawn);a.layer=b;m.remove(a,"mapscalechange",this._boundHideInfoBubble);m.remove(a,"mapscalechange",this._boundCleanPois);m.remove(a,"mapzoomchange",this._boundzoom);m.remove(a,"mapmoveend",this._boundmove);m.remove(a,"mapmovestart",this._clearTimeout);d(this,0);this._active=!1}}}});nokia.mh5.provide("nokia.mh5.maps.analytics");
(function(){var g=Math.round(1E4*Math.random()),a=!1,c=nokia.mh5.components.settings,f=function(b){var c=["http://metrics.nokia.com/b/ss/nokiaglobalmwg0prod".concat("/5/",g,"?D=~&ch=ovi:maps:mw&c6=ovimapsmwg0")],d;c.push("&c12=fw&v12=~c12&c13="+nokia.mh5.appId+"&v13=~c13");for(d in b)b.hasOwnProperty(d)&&c.push("&"+d+"="+b[d]);!a&&document.referrer&&(c.push("&r="+document.referrer+"&c30=~r&v30=~r"),a=!0);if(nokia.mh5.platform.android_webview||nokia.mh5.platform.ios_webview)c.push("&c50="+(nokia.mh5.platform.android_webview?
"android native":"ios native")+"&v50=~c50");(new Image).src=encodeURI(c.join(""))},d=function(){};nokia.mh5.ui.Control.watch(c.current,"analyticsEnabled",c.current,function(){nokia.mh5.maps.analytics.log=this.analyticsEnabled?f:d});nokia.mh5.maps.analytics.log=c.get("analyticsEnabled")?f:d;nokia.mh5.maps.analytics.getPlaceId=function(a){return a.placeId||a.latitude+","+a.longitude};nokia.mh5.maps.analytics.getContext=function(a){var c="";a&&a.href&&(a=a.href.match(/context=([^?]+)/))&&a[1]&&(c=a[1]);
return c};nokia.mh5.maps.analytics.logIfVisible=function(a,c){if(a.visible){if(!a._wasVisible)nokia.mh5.maps.analytics.log(c),a._wasVisible=!0}else a._wasVisible=!1}})();nokia.mh5.provide("nokia.mh5.internals.SQLTileServer");
nokia.mh5.internals.SQLTileServer=nokia.mh5.Class(function(){function g(b,c,e,n){function f(){B=z.started=!1}function g(a){D.type=a;(z[u]||d).call(z,D)}function t(a,b){if(B)f(),D.message=(b||a).message,g("error"),w(),nokia.mh5.maps.analytics.log({gn:"map download failed",c32:"map download failed",ev:"event33"})}function w(){B=null;z.started=!1;g("loadend")}function j(){z.started=!0;if(!B&&z.dbCreated){B=!B;for(var a=0;a<p&&b.length;a++)o(b.pop())}}function s(b){v=0;a(function(){z.dbCreated=!0;B&&
(f(),g("abort"),w(),nokia.mh5.maps.analytics.log({gn:"map download canceled by user",c32:"map download canceled by user",ev:"event34"}));b&&b()})}function A(){g("load");w();nokia.mh5.maps.analytics.log({gn:"map download completed",c32:"map download completed",ev:"event35"})}function o(a){function d(n){m(s,I,function(d){function w(){u-=1;if(!u){z.downloaded+=p;if(B)z.current+=f*f,z.estimated=z.downloaded/z.current*z.total,g("progress"),v+=1,v==C&&h(Z,P,{p1x:c[0].latitude,p1y:c[0].longitude,p2x:c[1].latitude,
p2y:c[1].longitude,minZoom:q,maxZoom:y,schema:e},A,t);B&&b.length&&o(b.pop())}}j=a.z;n.forEach(function(b,c){y=Math.max(j,y);q=Math.min(j,q||y);var e={z:j,x:a.x+c%f,y:a.y+Math.floor(c/f),base64:b};if("idb"===G)e.id=[e.x,e.y,e.z].join(";");h(s,I,e,w,t,d);u+=1})})}var f=a.size,w,j,s=R?H:T,p=0,u=0;nokia.mh5.jsonp("http://maps.nlp.nokia.com/maptiler/v2/maptile/newest/normal.day/"+a.z+"/"+a.x+"/"+a.y+"/256/png8"+n+"&output=base64&range="+f+"x"+f+"&callback_func",function(c){if(c.error)return b.push(a),
t(null,{message:c.error});if(B){for(w=c.length;w--;p+=c[w].length);d(c)}else b.push(a)})}var z=this,p=3,q=0,y=0,D={data:z},C=b.length,v=0,B;z.total=b.reduce(function(a,b){return a+b.size*b.size},0);z.current=0;z.downloaded=0;z.dbCreated=z.started=!1;z.stop=s;z.start=function(){null==B?s(j):j();nokia.mh5.maps.analytics.log({gn:"map download started",c32:"map download started",ev:"event32",c33:"lat0:"+c[0].latitude+",lon0:"+c[0].longitude+",lat1:"+c[1].latitude+",lon1:"+c[1].longitude,v33:"~c33"})};
z.pause=f;z.resume=j;z[u]=null}function a(a){a=a||d;c(function(){f(a)})}function c(a){a=a||d;m(Z,P,function(c){if("sql"===G)s(c,C+P,[],function(){b(a)},d);else{var e=c.objectStore(P);e.openCursor().onsuccess=function(b){(b=b.target.result)?(e["delete"](b.key),b["continue"]()):a()}}})}function f(a){a=a||d;m(T,I,function(b){if("sql"===G)s(b,C+I,[],function(){o(a)},d);else{var c=b.objectStore(I);c.openCursor().onsuccess=function(b){(b=b.target.result)?(c["delete"](b.key),b["continue"]()):a()}}})}function d(){}
function b(a){a=a||d;"sql"===G?m(Z,P,function(b){s(b,D+P+" ("+B+" "+O+", "+A+" "+O+", "+n+" "+O+", "+t+" "+O+", "+w+" "+O+", "+z+" "+O+", schema TEXT NOT NULL)",[],a,d)}):(H.createObjectStore(P,{autoIncrement:!0}),a())}function e(a){!T&&!R&&p(Ja,ya,K,ca,function(b){T=b;o(a)})}function h(a,b,c,e,d,n){if("sql"===G){var f=function(a){for(var n=Object.keys(c),f=[],g=[],h=0,t=n.length;h<t;h++)f.push("?"),g.push(c[n[h]]);s(a,"INSERT INTO "+b+" VALUES ("+f.join(",")+")",g,e,d)};n?f(n):m(a,b,f)}else a=(n||
a.transaction([b],"readwrite",0)).objectStore(b).put(c),a.onsuccess=e,a.onerror=d}function j(a,b,c,e){if("sql"===G)a[Q](function(a){s(a,"SELECT * FROM "+b,[],function(a,b){e(b)})});else{var b=a.transaction([b]).objectStore(b),d=[];if(!c)b.openCursor().onsuccess=function(a){(a=a.target.result)?(d.push(a.value),a["continue"]()):e(d)}}}function m(a,b,c){if("sql"===G)a[F](c);else c(a[F]([b],"readwrite",0))}function p(a,b,c,e,d,n){"sql"===G?(n=window.openDatabase(a,b,c,e),d(n)):(a=ua.open(a),a.onsuccess=
function(a){d(a.target.result)},a.onerror=n)}function o(a){a=a||d;"sql"===G?m(T,I,function(b){s(b,D+I+" (z "+y+", x "+y+", y "+y+", base64 TEXT)",[],a,d)}):(H.createObjectStore(I,{keyPath:"id"}),a())}function q(a){if(!S)throw"Web SQL not available";this.settings=a||{}}var v=function(a,b){v=a.item?function(a,b){return a.item(b)}:function(a,b){return a[b]};return v(a,b)},s=function(a,b,c,e,d){a.executeSql(b,c,e,d)},u="onprogress",D="CREATE TABLE IF NOT EXISTS ",C="DROP TABLE ",B="tl_latitude",A="tl_longitude",
n="br_latitude",t="br_longitude",w="MIN_ZOOM_LEVEL",z="MAX_ZOOM_LEVEL",y="INTEGER NOT NULL",O="TEXT NOT NULL",I="offline_tiles",P=I+"_bbox",F="transaction",Q="readTransaction",ba=window.openDatabase,Ja="m_nokia_maps",ya="1.0",K="",ca=47185920,L=52428800,S=!0,R=!nokia.mh5.platform.ios,Z,T,H,G,ua=window.indexedDB||window.mozIndexedDB;ba?G="sql":ua?G="idb":(G="none",S=!1);if("2.2"!=nokia.mh5.platform.android.version)if("undefined"!=typeof PGSQLitePlugin)s=function(a,b,c,e,d){a.executeSql(c&&c.length?
[b].concat(c):b,e,d)},R=!0,Q=F,document.addEventListener("deviceready",function(){H=new PGSQLitePlugin(Ja+".sqlite3",function(){m(H,P,b);m(H,I,o)})},!1);else if(R)if(H=null,"sql"===G)for(;!H&&5242880<L;){try{H=Z=T=ba(Ja,ya,K,L),H[F](b),H[F](o)}catch(ia){}L-=5242880}else{if("idb"===G)ba=ua.open(Ja,1),ba.onsuccess=function(a){H=Z=T=a.target.result;S=!0},ba.onerror=function(){S=!1},ba.onupgradeneeded=function(a){H=Z=T=a.target.result;S=!0;b();o()}}else try{p(Ja+"_flag",ya,K,1024,function(a){Z=a;m(a,
P,b)})}catch($){S=!1}else S=!1;q.AVAILABLE=nokia.mh5.platform.offlineStorageSupported=S;g.prototype.onprogress=null;return{constructor:q,create:function(a,b,c){var e=this.settings,d=e.apiKey||"",n=new Image;if("sql"===G)T[Q](function(f){s(f,"SELECT base64 FROM "+I+" WHERE z = ? AND x = ? AND y = ?",[a,b,c],function(f,g){var h=(g||f).rows;if(h.length)n.src="data:image/png;base64,"+v(h,0).base64;else if(!e.offlineOnly)n.src="http://".concat(1+c%4,".maps.nlp.nokia.com","/maptiler/v2/","maptile","/newest/",
"normal.day","/",a,"/",b,"/",c,"/",256,"/png8",d)})});else{var f=T.transaction([I]).objectStore(I).get([b,c,a].join(";"));f.onsuccess=function(){var g=f.result;if(g)n.src="data:image/png;base64,"+g.base64;else if(!e.offlineOnly)n.src="http://".concat(1+c%4,".maps.nlp.nokia.com","/maptiler/v2/","maptile","/newest/","normal.day","/",a,"/",b,"/",c,"/",256,"/png8",d)}}return n},getBoundingBox:function da(a){var b=R?H:Z;b?j(b,P,null,function(b){"sql"===G?(b=b.rows,b.length?(e(),b=v(b,0),a([{latitude:1*
b[B],longitude:1*b[A]},{latitude:1*b[n],longitude:1*b[t]}],1*b.MIN_ZOOM_LEVEL,1*b.MAX_ZOOM_LEVEL,b.schema)):a(null)):b[0]&&(b=b[0],a([{latitude:b.p1x,longitude:b.p1y},{latitude:b.p2x,longitude:b.p2y}],b.maxZoom,b.minZoom,b.schema))}):setTimeout(da,100,a)},storeBoundingBox:function(a,b){if(!b)b=a.bbox;var c=new g(a.areaToTiles(b),b,a.schema,this.settings.apiKey||"");e(c);return c},removeBoundingBox:function(){a()}}});nokia.mh5.provide("nokia.mh5.components.Map");
nokia.mh5.components.Map=new nokia.mh5.Class(nokia.mh5.ui.Container,function(g){var a=nokia.mh5.i18n,c=nokia.mh5.event,f=nokia.mh5.platform,d=nokia.mh5.ui.Button,b=nokia.mh5.ui.Control,e=nokia.mh5.ui.Container,h=nokia.mh5.internals,j=3,m=function(){return"ongestureend"in nokia.mh5.doc||f.android_webview||f.symbian_qt||f.n9},p=nokia.mh5.win.setTimeout,o=nokia.mh5.win.clearTimeout,q=nokia.mh5.win.clearInterval,v=nokia.mh5.win.setInterval;return{children:["zoomButtons","positionButton","settingsButton",
"mapLogo"],cssClass:"mh5_Map mh5_hwacc_viewer",statics:{MAX_ZOOM_LEVEL:h.Map.MAX_ZOOM_LEVEL,MIN_ZOOM_LEVEL:h.Map.MIN_ZOOM_LEVEL},passive:!1,zoomButtons:{control:e,children:["zoomin","zoomout"],visible:!m(),cssClass:"mh5_zoom",layout:new nokia.mh5.ui.RowLayout,zoomin:{control:d,cssClass:"mh5_Button mh5_zoomIn",onClick:function(){var a=this.parent.intervalId,b=this.parent.parent._map;"number"===typeof a&&q(a);if(b.zoom<b.MAX_ZOOM_LEVEL)a=this.parent.intervalId=v(function(){1.9>b.scale?b.scale+=0.09:
(q(a),a=void 0,b.zoom++)}.bind(this),33)}},zoomout:{control:d,cssClass:"mh5_Button mh5_zoomOut",onClick:function(){var a=this.parent.intervalId,b=this.parent.parent._map;"number"===typeof a&&q(a);if(b.zoom>b.MIN_ZOOM_LEVEL)a=this.parent.intervalId=v(function(){0.5<b.scale?b.scale-=0.05:(q(a),a=void 0,b.zoom--)}.bind(this),33)}}},positionButton:{control:d,cssClass:"mh5_Button position missing",onClick:function(){var a=this.parent._map;"available"===this.parent.positionStatus?a.tracking=!a.tracking:
this.parent.initPositioning("buttonClicked")}},settingsButton:{control:d,cssClass:"mh5_Button settings",onClick:function(){var a=this.parent;new nokia.mh5.ui.SettingsDialog({traffic:a.traffic,visibleDidChange:function(b){a.passive=b;this.constructor.prototype.visibleDidChange.apply(this,arguments)}})}},mapLogo:{control:e,cssClass:"mh5_mapLogo",children:["clickContainer"],clickContainer:{control:b,cssClass:"mh5_mapLogoContainer",rootHtmlElementName:"span",innerHTML:'<div class="logo"></div>',onClick:function(){nokia.mh5.maps.Application&&
nokia.mh5.app.controller.switchTo("nokia.mh5.maps.AboutPage"+(f.android_webview||f.ios_webview?"Native":""),null,{intoView:".terms"})}}},infoBubbleParams:void 0,positionStatus:"uninitialized",addressLookup:!0,dontBind:!0,initPositioning:function(a){var b=this,c=b._map,e=nokia.mh5.utils.getLocalStorageValue("mh5-isFirstTime");if(!this.passive&&"buttonClicked"!==a&&("uninitialized"===this.positionStatus||"unavailable"===this.positionStatus))e&&JSON.parse(e)&&nokia.mh5.jsonp("http://maps.nokia.com/services/iplookup/get?NORD&callback",
function(a){if("available"!==b.positionStatus&&!a.error&&!a.errors)c.zoom=6,c.moveTo(a.location)}),this.positionStatus="requesting",c.position.activate(function(a){this.positionStatus="available";if(this.moveToUserPosition)c.zoom=c.MAX_ZOOM_LEVEL-4,c.moveTo(a)}.bind(this),function(a){this.positionStatus=1==a.code?"denied":"unavailable";if(!c.center||!c.center.longitude||!c.center.latitude)c.zoom=j}.bind(this))},positionStatusDidChange:function(a){var b=this.positionButton&&this.positionButton.root;
if(b)if("available"===a)nokia.mh5.dom.removeClass(b,"missing"),nokia.mh5.dom.addClass(b,"available");else if("unavailable"===a)nokia.mh5.dom.addClass(b,"missing"),nokia.mh5.dom.removeClass(b,"available"),this._map.tracking=!1;if(this.onPositionStatusChange)this.onPositionStatusChange(a)},_onPositionLost:function(){this.positionStatus="unavailable"},_setupMap:function(){var a=this.root,e=this._map;e.tileLang=nokia.mh5.l10n.tileLanguageMap[f.language.substr(0,2)];e.offset=function(a){var b=0,c=0;do b+=
a.offsetLeft,c+=a.offsetTop;while(a=a.offsetParent);return{top:c,left:b}}(a);e.size={width:a.offsetWidth,height:a.offsetHeight};Object.defineProperty(this,"pois",{set:function(a){var b=this.getPois();0<b.length&&this.removePoi(b);if(a&&0<a.length)for(var b=0,c=a.length;b<c;b++)this.createPoi(a[b].mapIcon||nokia.mh5.utils.place.getCategoryIcon(a[b]),a[b])},get:function(){return this.getPois()}});b.watch(nokia.mh5.components.settings.current,"mapSchema",this,function(a){if(this.schema!==a)this.schema=
a});this._onMapLongPress=this._onMapLongPress.bind(this);this._onPoiClick=this._onPoiClick.bind(this);this._onPositionLost=this._onPositionLost.bind(this);(a=this.listeners)&&nokia.mh5.each(a,function(a,b){c.add("ready"==b?this:e,b,a.bind(this))},this);c.add(e,"mapmoveend",e.save);c.add(e,"mapclick",function(a){a.defaultPrevented||this.hideInfoBubble()}.bind(this));c.add(e,"maplongpress",this._onMapLongPress);c.add(e,"poiclick",this._onPoiClick);c.add(e,"positionlost",this._onPositionLost)},passiveDidChange:function(a){this.zoomButtons.visible=
!m()&&!a;this.positionButton&&(this.positionButton.visible=!a);this.settingsButton&&(this.settingsButton.visible=!a);nokia.mh5.dom[a?"addClass":"removeClass"](this.root,"mh5_passive")},_onSchemaChange:function(a){var b=this._map,c=this._server;if(c&&"normal.day"===a)try{c.getBoundingBox(function(a){if(null!==a)b.tileServer=c})}catch(e){}else b.tileServer=null;if(nokia.mh5.components.settings.current.mapSchema!==a)nokia.mh5.components.settings.current.mapSchema=a},_prepareAPI:function(){function a(c,
e,d){var f={get:function(){return b[e]}};if(d)f.set=function(a){b[e]=a;"schema"===e&&c._onSchemaChange(a)};d=c[e];Object.defineProperty(c,e,f);d&&(c[e]=d)}var b=this._map;a(this,"position");a(this,"route",!0);a(this,"center",!0);a(this,"box",!0);a(this,"offset",!0);a(this,"geometry",!0);a(this,"schema",!0);a(this,"size",!0);a(this,"zoom",!0);a(this,"tracking",!0);a(this,"apiKey",!0);a(this,"tileServer",!0);a(this,"shape",!0);this.moveTo=b.moveTo;this.geoToPoint=b.geoToPoint;this.pointToGeo=b.pointToGeo;
this.save=b.save;this.restore=b.restore;this.move=b.move},createPoi:function(a,b){var c=this._map.createPoi(a,b);if(b.placeId)c.placeId=b.placeId;if(b.href)c.href=b.href;this._pois.push(c);return c},removePoi:function(a){this._map.removePoi(a);if(a)for(var a=[].concat(a),b=0,c;b<a.length;b++)c=this._pois.indexOf(a[b]),~c&&this._pois.splice(c,1);else this._pois=[]},addPoi:function(a){this._map.addPoi(a);this._pois=this._pois.concat(a)},getPois:function(a,b){if(a){var c=this.comparePOIs,e=this._pois.filter(function(b){return c(b,
a)});return a.placeId||b?e[0]:e}return this._pois},_onPoiClick:function(a){var b=a.data[0];b.infoBubble?(a=b.image,nokia.mh5.event.fire(a,"down",{offsetX:b.clickedPoint.x+a.width/2,offsetY:b.clickedPoint.y+a.height/2})):a.defaultPrevented||(b.isPosition?this.addressLookup&&(this.hideInfoBubble(),this._triggerReverseGeoCoding(b)):b.data.name?(this.hideInfoBubble(),this.showInfoBubble(b)):this._triggerReverseGeoCoding(b))},_onMapLongPress:function(a){if(this.addressLookup&&!a.defaultPrevented)this.hideInfoBubble(),
a.data.renderOnly=!0,this._triggerReverseGeoCoding(a.data)},_triggerReverseGeoCoding:function(a){var b=this,c=nokia.mh5.adapters.Search,e=a.data||a,d;c.reverseGeoCode(e,{appId:this.appId,appCode:this.appCode},function(f){e.renderOnly&&(d=b.infoBubbleParams?nokia.mh5.extend({renderOnly:!0},b.infoBubbleParams):{content:["title"],maxWidth:245,renderOnly:!0},delete e.renderOnly);c.merge(e,f);b.hideInfoBubble();b.showInfoBubble(a,d)})},constructor:function(b,e){var n;this.getPoi=this.getPois;this.infoBubbles=
[];this._pois=[];this._layer={};this.resize=this.resize.bind(this);this._orientationOrResizeHappened=0;var d,m;if(b){if(b.listeners)d=b.listeners,delete b.listeners;if(b.infobubble||b.infoBubble){if(b.infobubble)b.infoBubble=b.infobubble;this.infoBubbleParams=b.infoBubble;delete b.infoBubble}}g.constructor.call(this,b,e);this.appId=this.appId||nokia.mh5.appId;this.appCode=this.appCode||nokia.mh5.appCode;if(!this.appId||!this.appCode)throw Error(a("Error.applicationCredential"));if(d)this.listeners=
b.listeners=d;d=this.root;f.android&&nokia.mh5.dom.addEvent(d,"mousemove",function(a){a.stopPropagation();a.preventDefault()},!0);n=this._map=new h.Map(d,d.offsetWidth||10,d.offsetHeight||10),d=n;d.apiKey={appId:this.appId,appCode:this.appCode};this._cartoPOI=new h.CartoPOI(this,d);f.offlineStorageSupported&&(this._server=new h.SQLTileServer({apiKey:d.apiKey}));j=this._map.MIN_ZOOM_LEVEL;(!b||null==b.suggestions||b.suggestions)&&!this.passive&&this._cartoPOI.activate();this.prepareBindings();this.prepareDidChangeNotifications();
if(!d.restore())d.center={latitude:52.52081,longitude:13.38855},d.zoom=j,this.moveToUserPosition=b&&b.hasOwnProperty("moveToUserPosition")?!!b.moveToUserPosition:!0;if(m=this.positionButton)c.add(d,"maptrackingstart",function(){nokia.mh5.dom.addClass(m.root,"tracking")}),c.add(d,"maptrackingend",function(){nokia.mh5.dom.removeClass(m.root,"tracking")});this.mapLogo&&nokia.mh5.maps.Application&&(this.mapLogo.clickContainer.root.innerHTML+="<a>"+a("mapTermsOfUse")+"</a>");this._prepareAPI();p(function(){this._setupMap();
this.initPositioning();c.fire(this,"ready")}.bind(this),0)},resize:function(){o(this._orientationOrResizeHappened);this._orientationOrResizeHappened=p(function(){var a=this.root,b=a.offsetWidth,a=a.offsetHeight;this._orientationOrResizeHappened=0;if(b&&a&&(b!==this._map.size.width||a!==this._map.size.height))this._map.size={width:b,height:a}}.bind(this),f.hideAddressBar.DELAY+50)},visibleDidChange:function(a){g.visibleDidChange.call(this,a);if(a){if(nokia.mh5.dom.addEvent(nokia.mh5.win,"viewportchange",
this.resize,!1),this.resize(),f.android_webview&&!this.passive)nokia.mh5.components.Map.active=this}else nokia.mh5.dom.removeEvent(nokia.mh5.win,"viewportchange",this.resize,!1),f.android_webview&&nokia.mh5.components.Map.active===this&&delete nokia.mh5.components.Map.active},showInfoBubble:function(a,b){b=b||this.infoBubbleParams||{content:["title"],maxWidth:245};if(!a.infoBubble){if(!b.listeners&&this.infoBubbleParams.listeners)b.listeners=this.infoBubbleParams.listeners;a.infoBubble=!0;var c=this._map,
e=this,d;if(20>this._map.size.width)p(function(){e.showInfoBubble(a,b)},5);else{e._infoBubbleAnimationTimerId&&(q(e._infoBubbleAnimationTimerId),delete e._infoBubbleAnimationTimerId);d=nokia.mh5.maps.analytics;d.log({gn:"map:infobubble",pl:d.getPlaceId(a),c19:d.getContext(a),v19:"~c19",c32:"infobubble",ev:"event47"});b.maxWidth=Math.max(e._map.size.width-50,245);if(!b.parent)b.parent=e;a.image?a.data.originalImage=a.image:(d=c.createPoi(nokia.mh5.doc.createElement("CANVAS"),a),d.locationX=a.locationX,
d.locationY=a.locationY,d.infoBubble=!0,delete d.data.infoBubble,a=d);d=new nokia.mh5.components.InfoBubble(a.data,b,function(d){if(a.infoBubble)a.image=d,"privilegeLevel"in b?a.privilegeLevel=b.privilegeLevel:a.privileged=!0,a.scale=0.7,e._infoBubbleAnimationTimerId=v(function(a){a.scale+=0.2;if(0.9<a.scale&&(q(e._infoBubbleAnimationTimerId),delete e._infoBubbleAnimationTimerId,a.scale=1,!b.renderOnly)){var f=c.geoToPoint(c.center),g=c.geoToPoint(a),h=f.x,a=f.y,j=g.x,g=g.y,m=c.size,o=m.width/2,p=
d.width/2,s=h+o,h=h-o,o=j-p,j=j+p;o<h?f.x-=h+16-o:s<j&&(f.x+=j+16-s);o=m.height/2;p=d.height;s=a+o;h=a-o;o=g-p;j=g+p;o<h?f.y-=h+16-o:s<j&&(f.y+=j+16-s);c.moveTo(c.pointToGeo(f))}},40,a)});d.poi=a;e.infoBubbles.push(d)}}},hideInfoBubble:function(a){var b;if(a)Array.isArray(a)||(a=[a]);else{if(0===this.infoBubbles.length)return;a=this.infoBubbles;this.infoBubbles=[]}for(var c=0,e=a.length;c<e;c++)b=a[c],this.infoBubbles.splice(this.infoBubbles.indexOf(b),1),poi=b.poi,delete poi.infoBubble,poi.data&&
poi.data.originalImage?(poi.image=poi.data.originalImage,delete poi.data.originalImage,poi.privileged=!1):this._map.removePoi(poi)},addLayer:function(a,b){var c=this._map,e=[].concat(c.layer||[]);if(0>e.indexOf(a))c.layer=e.concat(a),"string"==typeof b&&(this._layer[b]=c.layer[c.layer.length-1])},removeLayer:function(a){var b,c,e=[].concat(this._map.layer||[]);switch(typeof a){case "string":if("function"==typeof(b=this._layer[a]))if(~(b=e.indexOf(b)))e.splice(b,1),e.length?(this._map.layer=e,delete this._layer[a]):
(this._map.layer=null,this._layer={});break;case "function":if(~(b=e.indexOf(a)))if(e.splice(b,1),e.length)for(c in this._map.layer=e,this._layer){if(this._layer[c]==a){delete this._layer[c];break}}else this._map.layer=null,this._layer={}}},hasLayer:function(a){return"string"==typeof a&&"function"==typeof this._layer[a]||"function"==typeof a&&~[].concat(this._map.layer||[]).indexOf(a)?!0:!1},comparePOIs:function(a,b){return a.placeId?a.placeId===b.placeId:a.latitude===b.latitude&&a.longitude===b.longitude},
covers:function(a){var b=this.box,c=this.geoToPoint,e=c(b[0]),d=c(b[1]);return!a.some(function(a){a=c(a);return a.x<e.x||a.x>d.x||a.y<e.y||a.y>d.y})},storeTiles:function(a){var b=this._server;if(b)return b=b.storeBoundingBox(this._map,a&&a.box),a&&a.callback&&(b.onprogress=a.callback),a&&!a.hold&&b.start(),b},showStoredTiles:function(a,b){var c=this._map,e=this._server;e?e.getBoundingBox(function(d,f,n){d?(c.tileServer=e,c.box=d,c.zoom=f,c.schema=n,a&&a(d,f,n)):b&&b()}):b&&b()},removeStoredTiles:function(){this._server&&
this._server.removeBoundingBox()}}});nokia.mh5.provide("nokia.mh5.components.RouteListItem");
nokia.mh5.components.RouteListItem=new nokia.mh5.Class(nokia.mh5.ui.Control,function(g){var a=nokia.mh5.i18n;return{rootHtmlElementName:"li",cssClass:"mh5_ListItem",constructor:function(a,f){g.constructor.call(this,a,f);this.update()},update:function(){var c;c=this.first&&" mh5_maneuver_start"||this.last&&" mh5_maneuver_end"||"";var f="";this.waypoint?(nokia.mh5.dom.addClass(this.root," mh5_pt"),f=0<=this.action.indexOf("Walk")?" mh5_pt_walk":" mh5_pt_tube",c='<div class="mh5_pt_waypoint'+c+'"><div><\!--waypoint icon--\></div>'+
("<div>"+this.waypoint+"</div>"),c+="</div>",this.last||(c+='<div class="mh5_pt_line" style="background-color:'+this.color+'"></div>',nokia.mh5.dom.addClass(this.root,f),c=c+'<div class="mh5_pt_action"><div><\!--action icon--\></div>'+("<div>"+this.action+"</div>"),c+="</div>"),this.root.innerHTML=c):((this.first||this.last)&&(this.iconIndex=0),c="<div>"+('<div class="mh5_ListItem_icon'+c+'"></div>'),this.distance&&(c+="<div>"),c+='<div class="mh5_ListItem_name">'+this.instruction+"</div>",this.distance&&
(c+='<div class="mh5_ListItem_address">'+a("followFor")+" <span>"+nokia.mh5.utils.formatDistance(this.distance,nokia.mh5.components.settings.current.unitSystem)+"</span></div>"),this.root.innerHTML=c+"</div></div>",this.root.firstChild.firstChild.style.backgroundPositionX=-3.6*this.iconIndex+"rem")}}});nokia.mh5.provide("nokia.mh5.adapters.Route");
(function(){function g(a){return!a.length||2>a.length?[]:a.map(function(b,c){var e=!c,f=c===a.length-1,g=f?/\.?\s*The trip takes.*<\/span>/:/\s*<span class="distance-description">.*<\/span>/,h=f&&a[c-1].shape?a[c-1].shape.slice(-2):b.shape,j=b.instruction.match(/<span class="direction">(\w+)<\/span>/),m=c&&!("action"in a[c-1])&&"forward"==b.direction,A=b.instruction.slice(0,4).toLowerCase();if("bear"==A&&j&&j[1])b.direction=A+(j[1].charAt(0).toUpperCase()+j[1].slice(1));return{action:e&&"depart"||
f&&"arrive"||!m&&b.direction,direction:f&&j&&j[1],instruction:b.instruction.replace(g,""),first:e,last:f,iconIndex:"action"in b?d[b.action]:d[b.direction],distance:b.length,latitude:b.position.latitude,longitude:b.position.longitude,shape:h&&h.reduce(function(a,b,c,e){return c%2?a:a.concat([{latitude:b,longitude:e[c+1]}])},f?[{latitude:h[h.length-2],longitude:h[h.length-1]}]:[])}})}function a(a){if(!a.length||2>a.length)return[];a[0].name=h;a[a.length-1].name=j;return a.map(function(c,d){var f,g=
"",h,j=0===d,m=d===a.length-1;f=j||m?b[j?0:2]+'<span class="mh5_pt_highlight">'+c.name+"</span>":"<span>"+b[1]+c.name+"</span>";if(!m)if(g=e[c.action],0===c.action){if((h=a[d+1])&&(h.name||h.line))g+='<span class="mh5_pt_highlight">'+(h.name!=c.name||!h.line?h.name:h.line)+"</span>"}else 1===c.action&&(g=0<=g.indexOf("{0}")?g.replace("{0}",'<span class="mh5_pt_highlight">'+(c.line||"")+"</span>"):g,g+='<span class="mh5_pt_highlight">'+c.direction+"</span><br>",g+='<span class="mh5_pt_light">For '+
c.stops+" stops</span>");return{waypoint:f,wIconIndex:0,action:g,aIconIndex:0,first:j,last:m,duration:c.duration,color:c.color,latitude:c.position.latitude,longitude:c.position.longitude}})}function c(a,b,c,e){var d,f,g=b.mode,h=a[0],j=a[a.length-1];"pt"===g?(d="http://m.maps.nokia.com/releases/1.7.22/server/PublicTransport.php",f={slat:h.latitude,slon:h.longitude,dlat:j.latitude,dlon:j.longitude,date:(b.departure||new Date(Date.now()-6E4*(new Date).getTimezoneOffset()+9E5)).toISOString().substr(0,
19)},a="jsonp"):(d="http://route.nlp.nokia.com/routing/6.2/calculateroute.json",f={token:b.appId,mode:[b.type||"fastest","drive"==g?"car":"pedestrian","traffic:"+("walk"==g||!1===b.traffic?"disabled":"enabled")].join(";"),routeattributes:"sh,bb,sm",maneuverattributes:"po,le,ac,di"+("walk"==g?",sh":""),instructionformat:"html",jsonAttributes:"33",departure:b.departure&&b.departure.toISOString()||"now"},a.forEach(function(a,b){f["waypoint"+b]=a.latitude+","+a.longitude}),b.features&&(f.mode+=";"+Object.keys(b.features).map(function(a){return a+
":"+b.features[a]}).join(",")),a="jsoncallback");d+="?"+nokia.mh5.utils.formatURLParams(f)+"&"+a;m&&m.cancel();m=nokia.mh5.jsonp(d,function(a){a.error?e&&e(a.error):c(a.response)},15E3)}var f=nokia.mh5.i18n,d={depart:0,departAirport:0,arrive:0,arriveAirport:0,arriveLeft:0,arriveRight:0,leftLoop:5,leftUTurn:3,sharpLeftTurn:11,leftTurn:9,slightLeftTurn:7,"continue":0,slightRightTurn:6,rightTurn:8,sharpRightTurn:10,rightUTurn:2,rightLoop:4,leftExit:17,rightExit:16,leftRamp:19,rightRamp:18,leftFork:21,
middleFork:1,rightFork:20,leftMerge:15,rightMerge:14,nameChange:1,trafficCircle:48,ferry:47,leftRoundaboutExit1:34,leftRoundaboutExit2:35,leftRoundaboutExit3:36,leftRoundaboutExit4:37,leftRoundaboutExit5:38,leftRoundaboutExit6:39,leftRoundaboutExit7:40,leftRoundaboutExit8:41,leftRoundaboutExit9:42,leftRoundaboutExit10:43,leftRoundaboutExit11:44,leftRoundaboutExit12:45,rightRoundaboutExit1:22,rightRoundaboutExit2:23,rightRoundaboutExit3:24,rightRoundaboutExit4:25,rightRoundaboutExit5:26,rightRoundaboutExit6:27,
rightRoundaboutExit7:28,rightRoundaboutExit8:29,rightRoundaboutExit9:30,rightRoundaboutExit10:31,rightRoundaboutExit11:32,rightRoundaboutExit12:33,forward:0,uTurnRight:2,bearRight:4,lightRight:6,right:8,hardRight:10,uTurnLeft:3,bearLeft:5,lightLeft:7,left:9,hardLeft:11},b=["<span>"+f("RA.departFrom")+"</span> ","Station ","<span>"+f("RA.arriveAt")+"</span> "],e=["<span>"+f("RA.walkTo")+"</span> ","<span>"+f("take")+"</span> {0} <span>"+f("towards")+"</span> "],h="Start",j="",m;nokia.mh5.adapters.Route=
{fetch:function(b,e,d,m,s){var u,D,C=function(b){var c=b&&b.route&&(b.route[0]?b.route[0]:b.route),f="pt"==e.mode?a:g;c&&c.shape&&c.shape.length?(b=c.summary,c={box:b.bbox||c.boundingBox&&[c.boundingBox.topLeft,c.boundingBox.bottomRight]||c.shape,shape:c.shape,summary:{distance:b.distance||0,time:b.baseTime},maneuvers:f(c.maneuvers||c.leg[0].maneuver,this.ename)},d(c)):B.call(b&&b.error)},B=function(a){var b=e.mode;"timeout"===a?a=f("Notification.noRoutingService"):"pt"==b?"too near"===a?a=f("Notification.destInWalkingDistance"):
"unavailable"===a&&(a=f("Notification.noPublicTransportService")):a||(b=f("Notification.noModeAvailable",{mode:f("RA."+b)}),a=b.charAt(0).toUpperCase()+b.slice(1));m(a||f("Notification.noRoutingService"))},A,n;if(Array.isArray(b)&&2<=b.length)u=b[0],D=b[b.length-1];else if(b&&b.hasOwnProperty("latitude")&&b.hasOwnProperty("longitude")&&e&&e.hasOwnProperty("latitude")&&e.hasOwnProperty("longitude"))u=b,D=e,b=[u,D],e=d,d=m,m=s;else{m(f("Notification.error"));return}A=e.appId=e.appId||nokia.mh5.appId;
n=e.appCode=e.appCode||nokia.mh5.appCode;m=m||function(){};if(!A||!n)throw Error(f("Error.applicationCredential"));if("pt"===e.mode)if(j=D.name,u.name)h=u.name;else var t=C,C=function(a){nokia.mh5.adapters.Search.reverseGeoCode(u,{appId:A,appCode:n},function(b){h=b.name;t.call(this,a)},B)};c(b,e,C,B)}}})();nokia.mh5.provide("nokia.mh5.components.Navigation");nokia.mh5.provide("nokia.mh5.ui.ImageDialog");
nokia.mh5.ui.ImageDialog=new nokia.mh5.Class(nokia.mh5.ui.Dialog,function(g){var a=nokia.mh5.i18n;return{cssClass:"mh5_ImageDialog mh5_modal mh5_modalBg",children:["content","spinner","errorMessage","imageProviderText"],content:{control:nokia.mh5.ui.Control,rootHtmlElementName:"img",cssClass:"mh5_CarouselImage",visible:!1},spinner:{control:nokia.mh5.ui.Control,cssClass:"mh5_spinner_big_bright",visible:!0},errorMessage:{control:nokia.mh5.ui.Control,cssClass:"mh5_errorMessage",innerHTML:a("Notification.unableToLoadImage"),
visible:!1},imageProviderText:{control:nokia.mh5.ui.Control,cssClass:"mh5_imageProvider",visible:!1},constructor:function(a,f){a.closeOnTap=!0;g.constructor.call(this,a,f);var d=this,b=this.content.root,e=nokia.mh5.win.setTimeout(function(){nokia.mh5.dom.addClass(d.root,"mh5_loading")},50);b.onload=function(){nokia.mh5.win.clearTimeout(e);nokia.mh5.dom.removeClass(d.root,"mh5_loading");d.content.visible=!0;d.provider&&d._showimageProviderText(d.provider)};b.onerror=function(){nokia.mh5.win.clearTimeout(e);
nokia.mh5.dom.removeClass(d.root,"mh5_loading");d.errorMessage.visible=!0};b.src=a.src},_updatePosition:function(){g._updatePosition.call(this);this._updateTextPosition()},_updateTextPosition:function(){this.imageProviderText.root.style.top=this.content.root.offsetTop+this.content.root.offsetHeight+5+"px";this.imageProviderText.root.style.left=this.content.root.offsetLeft+"px"},_showimageProviderText:function(c){this.imageProviderText.root.innerHTML=a("source")+": "+c;this.imageProviderText.visible=
!0;this._updateTextPosition()}}});nokia.mh5.provide("nokia.mh5.ui.Carousel");
nokia.mh5.ui.Carousel=new nokia.mh5.Class(nokia.mh5.ui.Container,function(){return{cssClass:"mh5_Carousel",hScroll:!0,hScrollbar:!1,visible:!0,imagePool:[],onClick:function(g){g=(g.hasOwnProperty("data")?g.data.target:null)||g.target;"IMG"===g.tagName&&new nokia.mh5.ui.ImageDialog({src:g.getAttribute("data-image-src"),provider:g.getAttribute("data-image-provider")||"Business Owner"})},imagePoolDidChange:function(g){if(!g||0===g.length)this.getContentRoot().innerHTML="",this.visible=!1;else{var a=
"",c=0;g.forEach(function(b){a+='<img src="'+b.thumbnailSrc+'" data-image-src="'+b.imageSrc+'" data-image-provider="'+(b.providerName?b.providerName:"")+'" draggable = "false" />'});g=this.getContentRoot();g.innerHTML=a;for(var f=g.children,d=this,g=f.length-1;0<=g;--g){var b=f[g];b.onerror=function(){this.parentNode&&this.parentNode.removeChild(this)};b.onload=function(){c=c++;++c===f.length-1&&d._scroll&&d._scroll.refresh()}}this.visible=!!a}}}});nokia.mh5.provide("nokia.mh5.components.PlaceDetails");
nokia.mh5.components.PlaceDetails=new nokia.mh5.Class(nokia.mh5.ui.Container,function(g){var a=nokia.mh5.i18n,c=[{name:a("eating"),value:"eating",cssClass:"eating"},{name:a("shopping"),value:"shopping",cssClass:"shopping"},{name:a("going-out"),value:"going-out",cssClass:"goingOut"},{name:a("sights"),value:"sights",cssClass:"sights"},{name:a("PT"),value:"public-transport",cssClass:"publicTransport"}],f=nokia.mh5.maps.analytics,d=["summary","recommendations","legalNote"];return{control:nokia.mh5.ui.Container,
children:"summary,actions,images,ad,ownerContent,guides,reviews,spinner,recommendations,fillup,legalNote".split(","),layout:{type:nokia.mh5.ui.RowLayout},summary:{control:nokia.mh5.components.PlaceSummary},actions:{control:nokia.mh5.ui.Container,cssClass:"mh5_placeActions actions stretch mh5_standardBackgroundColorDark",layout:{type:nokia.mh5.ui.ColumnLayout},children:["dial","share","route","website","addFavourite"],dial:{control:nokia.mh5.ui.Button,cssClass:"button contact mh5_primaryColorDark",
disabled:!0,text:a("call"),onClick:function(){var a=this.parent.parent,c=a.place;nokia.mh5.event.fire(a,"dial",c);f.log({gn:"place:contact",pl:f.getPlaceId(c),c19:f.getContext(c),v19:"~c19",c32:"place:contact",ev:"event21"})}},share:{control:nokia.mh5.ui.Button,cssClass:"button share mh5_primaryColorDark",disabled:!0,onClick:function(){var a=this.parent.parent;nokia.mh5.event.fire(a,"share",a.place)},text:a("share")},route:{control:nokia.mh5.ui.Button,cssClass:"button route mh5_primaryColorDark",
disabled:!0,onClick:function(){var a=this.parent.parent,c=a.place;f.log({gn:"place:route",pl:f.getPlaceId(c),c19:f.getContext(c),v19:"~c19",c32:"place:directions",ev:"event24"});nokia.mh5.event.fire(a,"route",c)},text:a("route")},website:{control:nokia.mh5.ui.Button,cssClass:"button web mh5_primaryColorDark",disabled:!0,text:a("web"),target:"blank",onClick:function(){var a=this.parent.parent,c=a.place;nokia.mh5.event.fire(a,"website",c);f.log({gn:"place:website",pl:f.getPlaceId(c),c19:f.getContext(c),
v19:"~c19",c32:"place:website",ev:"event25"})}},addFavourite:{control:nokia.mh5.ui.Button,cssClass:"button favourite mh5_primaryColorDark",disabled:!0,text:a("favourite"),onClick:function(){var b=this.parent.parent,c=b.place,d=this.root,f=nokia.mh5.components.favourites.get(c),g=this.parent.parent.parent.notification;that=this;f?(nokia.mh5.components.favourites.remove(c),nokia.mh5.dom.removeClass(d,"saved"),d="removed",nokia.mh5.sso.isAuthenticated()?(g.text=a("FV.removedSignedIn"),g.visible=!0,setTimeout(function(){that.parent.parent.parent.notification.text=
a("FV.syncedFavourites");that.parent.parent.parent.notification.visible=!0},3E3)):(g.text=a("FV.removedNotSignedIn"),g.visible=!0)):nokia.mh5.components.favourites.add(c)?(nokia.mh5.dom.addClass(d,"saved"),d="added",nokia.mh5.sso.isAuthenticated()?(g.text=a("FV.addedSignedIn"),g.visible=!0,setTimeout(function(){that.parent.parent.parent.notification.text=a("FV.syncedFavourites");that.parent.parent.parent.notification.visible=!0},3E3)):(g.text=nokia.mh5.platform.android_webview?a("FV.addedNotSignedIn"):
a("FV.addedNotSignedIn")+" "+a("FV.signInToSyncronize"),g.visible=!0)):d="failed2add";nokia.mh5.event.fire(b,"favourite",{place:c,status:d})}}},images:{control:nokia.mh5.ui.Carousel,clear:function(){this.imagePool=[]}},ad:{control:nokia.mh5.ui.Control,visible:!1},ownerContent:{control:nokia.mh5.ui.Control,cssClass:"mh5_PlaceDetailsData mh5_primaryColorBright",visible:!1,clear:function(){this.root.innerHTML=""}},guides:{control:nokia.mh5.ui.Control,cssClass:"mh5_PlaceDetailsData mh5_primaryColorBright",
visible:!1,update:function(b){this.clear();if(b){for(var c="",d,f=0,g=b.length;f<g;f++)d="",b[f].providerUrl&&(d=' <a class="mh5_link" href="'+b[f].providerUrl+'" target="_blank">'+a("more")+"</a>"),c+='<div class="mh5_guide">',c+=b[f].providerIcon?'<img class="mh5_icon" src="'+b[f].providerIcon+'">':"",c+="<div>",c+='<h2 class="title">'+b[f].providerName+"</h2>",c+=this.parent._formatDescription(b[f].description,d),c+="</div>",c+="</div>";this.root.innerHTML='<div class="mh5_guides"><h1 class="mh5_title">'+
a("guides")+"</h1>"+c+"</div>";this.visible=!0}},clear:function(){this.root.innerHTML="";this.visible=!1}},reviews:{control:nokia.mh5.ui.Control,cssClass:"mh5_PlaceDetailsData mh5_primaryColorBright",visible:!1,update:function(b){this.clear();if(b){for(var c="",d,f=0,g=b.length;f<g;f++){d="";c+='<div class="mh5_review">';c+='<img class="mh5_icon" src="'+b[f].providerIcon+'">';c+="<div>";c+="<h2>"+(b[f].title||this.parent.place.name)+"</h2>";if(b[f].ratingValue){var p=new nokia.mh5.ui.Rating;p.value=
b[f].ratingValue;c+=p.root.outerHTML}b[f].url&&(d=' <a href="'+b[f].url+'" class="mh5_link" target="_blank">'+a("more")+"</a>");c+=this.parent._formatDescription(b[f].description,d);c+='<p class="mh5_reviewFooter">Posted'+(b[f].userName?" by "+b[f].userName:"")+" on "+b[f].date+"</p>";c+="</div>";c+="</div>"}this.root.innerHTML='<div class="mh5_reviews"><h1 class="mh5_title">'+a("reviews")+"</h1>"+c+"</div>";this.visible=!0}},clear:function(){this.root.innerHTML="";this.visible=!1}},spinner:{control:nokia.mh5.ui.Control,
visible:!1,innerHTML:"<div class='mh5_spinner_big_dark'></div>",cssClass:"mh5_spinnerContainer"},recommendations:{control:nokia.mh5.ui.Container,cssClass:"mh5_nearby_places",layout:{type:nokia.mh5.ui.RowLayout},children:["title","categoryToggle","categoryToggleBorder","indicator","list"],visible:!1,indicator:{control:nokia.mh5.ui.Control,cssClass:"mh5_recommendationIndicator",innerHTML:"<div class='mh5_primaryBorderColorBright'></div>"},title:{control:nokia.mh5.ui.Control,rootHtmlElementName:"h1",
cssClass:"mh5_title",innerHTML:a("nearbyPlaces"),visible:!1},categoryToggle:{control:nokia.mh5.ui.SegmentedButton,cssClass:"mh5_nearbyCategoryToggle mh5_ColumnLayout mh5_primaryColorBright",items:c,onValueChange:function(a){var c=this.parent,d=c.parent,f=this.root.querySelector(".mh5_selected"),f=Math.round(f.offsetLeft+f.offsetWidth/2);d._selectedNearbyCategory=a;c.list.items=d.place&&d.place.recommendations?nokia.mh5.components.favourites.favouritize(d.place.recommendations[a]):[];c.indicator.root.style[(nokia.mh5.platform.ie?
"ms":"webkit")+"Transform"]="translateX("+f+"px)";nokia.mh5.win.setTimeout(function(){d.resize(!0)},1)}},categoryToggleBorder:{control:nokia.mh5.ui.Control,cssClass:"mh5_primaryBackgroundColorBright"},list:{control:nokia.mh5.ui.List,visible:!1,itemClass:nokia.mh5.components.PlaceListItem,listeners:{tap:function(a){var c=a.data.item,d=this.getRootOwnerByClass(nokia.mh5.components.PlaceDetails),f={placeId:c.placeId,href:c.href,latitude:c.latitude,longitude:c.longitude,address:c.address,category:c.category,
icon:c.icon,name:c.name};c.placeId&&"pt"===c.placeId.substring(0,2)&&delete f.placeId;a=nokia.mh5.event.fire(d,"nearby",{place:f,index:a.data.index});if(!a.defaultPrevented)d.place=f}}}},fillup:{control:nokia.mh5.ui.Control,cssClass:"mh5_fillup"},legalNote:{control:nokia.mh5.ui.Container,rootHtmlElementName:"footer",cssClass:"mh5_RowLayout mh5_secondaryColorBright",innerHTML:"&copy; "+(new Date).getFullYear()+" Nokia",children:["ownerContentProvider","imageProviders"],clear:function(){this.ownerContentProvider.clear();
this.imageProviders.clear()},ownerContentProvider:{control:nokia.mh5.ui.Control,cssClass:"mh5_provider",innerHTML:"",clear:function(){this.innerHTML="";this.visible=!1}},imageProviders:{control:nokia.mh5.ui.Control,cssClass:"mh5_provider",innerHTML:"",clear:function(){this.innerHTML="";this.visible=!1}}},adapter:nokia.mh5.adapters.Search,cssClass:"mh5_PlaceDetails",constructor:function(b,c){var f,j,m,p,o,q,v;b||(b={});for(m=0;o=d[m];m++)if(o in b)throw Error(a("Error.propertyCannotBeOverwritten",
{name:o}));if(!b.hasOwnProperty("actions")||!0===b.actions)b.actions={};if(b.actions&&!b.actions.addFavourite)b.actions.addFavourite=null;g.constructor.call(this,b,c);if(this.customContent){f=[].concat(this.customContent);j=this.children;for(m=0;p=f[m];m++){o=p.control||nokia.mh5.ui.Control;ctrl=new o(p,this);if(this[p.name])throw Error(a("Error.customContentNotAllowed",{name:p.name}));o=!this[p.name]&&p.name||"customContent"+(m+1);q=p.after&&j.indexOf(p.after);v=q>=j.length-1;this[p.after&&v?"add":
"insertBefore"](ctrl,o,p.before||j[q+1])}}},build:function(){var a=this.parameters;Object.defineProperty(this,"parameters",{get:function(){return this._parameters},set:function(a){this._parameters={};nokia.mh5.each(a,function(a,b){this._parameters[b]="function"===typeof a?a.bind(this):a},this)}});if(a)this.parameters=a;nokia.mh5.platform.ios&&nokia.mh5.dom.addClass(this.root.firstChild.firstChild,"mh5_noFlicker");this.resize=this.resize.bind(this);g.build.call(this)},resize:function(a){var c=this.getContentRoot(),
d=c.parentNode,f=this._selectedNearbyCategory,g=this.recommendations.categoryToggle;c.offsetHeight>this.root.offsetHeight?nokia.mh5.dom.addClass(d,"mh5_fillupDisable"):nokia.mh5.dom.removeClass(d,"mh5_fillupDisable");this._scroll&&nokia.mh5.win.setTimeout(this._scroll.refresh,1);this.images&&this.images._scroll&&nokia.mh5.win.setTimeout(this.images._scroll.refresh,1);!a&&this.visible&&f&&g.select(f)},remove:function(b){if(~d.indexOf(b))throw Error(a("Error.unableToRemove",{name:b}));g.remove.call(this,
b)},_setContentData:function(b){var c="",d=this.legalNote,f,g;if(b.imageProviders){f=[];g=0;for(var p=b.imageProviders.length;g<p;g++)f.push(b.imageProviders[g].url?'<a href="'+b.imageProviders[g].url+'">'+b.imageProviders[g].name+"</a>":b.imageProviders[g].name);if(d)d.imageProviders.root.innerHTML=a("imagesProvidedBy")+f.join(", "),d.imageProviders.visible=!0}b.extended&&nokia.mh5.each(b.extended,function(a){c+=this._renderSimpleContent(a.label,a.text)},this);c+=this._renderSimpleContent(a("PT"),
b.publicTransport);if(this.ownerContent){if(b.ownerContent&&(g=b.ownerContent,c+=this._renderOwnerContent(g),g.providerName&&d))f=g.providerName,g.providerUrl?(g=g.providerUrl,d.ownerContentProvider.root.innerHTML=a("contentProvidedBy")+'<a href="'+g+'">'+f+"</a>"):d.ownerContentProvider.root.innerHTML=a("contentProvidedBy")+f,d.ownerContentProvider.visible=!0;this.ownerContent.visible=!!c;this.ownerContent.root.innerHTML=c}this.guides&&this.guides.update(b.premiumContent);this.reviews&&this.reviews.update(b.reviews)},
_setRecommendations:function(a){var c=!1,d=a.recommendations,f=this.recommendations,g=f.categoryToggle,p,o;if(d){g.select(null);nokia.mh5.each(g.items,function(a){if(d&&d[a.value]&&d[a.value].length){if(c=!0,delete a.disabled,void 0===p)p=a.value}else if(a.disabled=!0,this._selectedNearbyCategory===a.value)this._selectedNearbyCategory=void 0}.bind(this));g.update();if(void 0===this._selectedNearbyCategory&&p)this._selectedNearbyCategory=p;if("public-transport"===this._selectedNearbyCategory){g=d[this._selectedNearbyCategory];
for(o=0;o<g.length;o++)if(g[o].name===a.name){d[this._selectedNearbyCategory].splice(o,1);break}}f.visible=c;f.title.visible=c;f.list.visible=c;f.categoryToggle.visible=c;this.resize()}else f.visible=!1},showError:function(b){var c=this.fillup,d=this.actions,b="not found"===b?a("Notification.placeRemovedByOwner"):a("Notification.placeError");d&&["dial","share","route","website","favourite"].forEach(function(a){if(d[a])d[a].disabled=!0});if(c){if(c)c.root.innerHTML='<div class="mh5_error">'+b+"</div>"}else this._errorMessage=
b},_formatDescription:function(a,c){return!a?"":'<p class="mh5_description">'+a.replace(/\n{2,}/g,'</p><p class="mh5_description">').replace(/\n/g,"<br>")+(c||"")},_renderSimpleContent:function(a,c){return!a||!c?"":'<div class="mh5_placeData"><h2 class="title">'+a+"</h2>"+this._formatDescription(c)+"</div>"},_renderOwnerContent:function(b){return!b?"":'<div class="mh5_ownerContent"><h1 class="mh5_title">'+a("placeDescription")+"</h1>"+this._formatDescription(b)+"</div>"},vScroll:!0,bounce:!1,place:null,
parameters:{},placeDidChange:function(a){delete this._errorMessage;var c=nokia.mh5.adapters.Search,d=this.adapter||c;this.update();a&&d.fetch(a,this.parameters,function(a){c.merge(this.place,a);this.update();nokia.mh5.event.fire(this,"done");if(!a.recommendations)this.spinner.visible=!0,c.getRecommendations(a,this.parameters,function(a){this.spinner.visible=!1;this._setRecommendations(a);this.resize()}.bind(this))}.bind(this),function(){this.showError.apply(this,arguments);nokia.mh5.event.fire(this,
"done")}.bind(this))},unitSystemBinding:"nokia.mh5.components.settings#current.unitSystem",update:function(){var a=this.place,c,d,f,g,p,o,q;if(a){this.summary.update(a);c=this.actions;d=a.phone;if(f=!!nokia.mh5.components.favourites.get(a))a.favourite=!0;if(this.images)this.images.imagePool=a.gallery;this.legalNote.clear();this._setContentData(a);this._setRecommendations(a);if(this.fillup)this.fillup.root.innerHTML="";if(c){g=c.dial;p=c.share;o=c.route;q=c.website;c=c.addFavourite;if(g)g.link="tel:"+
d,g.disabled=!d,g.update();if(p&&a.name&&(a.placeId||a.longitude&&a.latitude))p.disabled=!1,p.update();if(o&&a.name&&(a.placeId||a.longitude&&a.latitude))o.disabled=!1;if(q)q.link=a.website,q.disabled=!a.website,q.update();if(c){if(a.name&&(a.placeId||a.longitude&&a.latitude))c.disabled=!1;nokia.mh5.dom[f?"addClass":"removeClass"](c.root,"saved")}}this.resize();nokia.mh5.event.fire(this,"update",a)}},visibleDidChange:function(a){g.visibleDidChange.call(this,a);a?(nokia.mh5.dom.addEvent(nokia.mh5.win,
"viewportchange",this.resize,!1),this.resize(),this._errorMessage&&(nokia.mh5.event.fire(this,"error",{message:this._errorMessage}),delete this._errorMessage)):nokia.mh5.dom.removeEvent(nokia.mh5.win,"viewportchange",this.resize,!1)},unitSystemDidChange:function(){this.recommendations&&this.recommendations.list.renderedItems&&this.recommendations.list.renderedItems.forEach(function(a){a.update&&a.update()})}}});nokia.mh5.provide("nokia.mh5.components.Search");
nokia.mh5.components.Search=new nokia.mh5.Class(nokia.mh5.ui.Container,function(g){function a(){var a=d.getLocalStorageValue("history");return a?JSON.parse(a):[]}var c,f,d=nokia.mh5.utils,b=function(a){return a.toLowerCase().charAt(0)===f.toLowerCase()},e=function(a){return 0<=a.toLowerCase().indexOf(f)};return{statics:{SEARCH_COMPLETION:{add:function(b){if(b){var c=a(),e=c.indexOf(b),e=~e&&c.splice(e,1)[0];100<c.unshift(e||b)&&c.pop();d.setLocalStorageValue("history",JSON.stringify(c))}},get:function(d,
g,m){var p=this.searchAdapter,o=this.parameters,q=o&&o.limit,v,s,d=d.trim();c&&clearTimeout(c);2<d.length&&p&&p.getSuggestions?c=setTimeout(function(){c=null;o.limit=m;p.getSuggestions(d,o,g);o.limit=q},200):(v=a(),f=d.toLowerCase(),q=d&&1==d.length&&v.filter(b),s=!(q&&q.length)&&e,g((s?v.filter(s):q||v).splice(0,m||4)))}}},children:["input","completion"],input:{control:nokia.mh5.ui.TextInput,type:"search"},cssClass:"mh5_Search",completion:{control:nokia.mh5.ui.List,cssClass:"mh5_SearchCompletion",
visible:!1,itemClass:new nokia.mh5.Class(nokia.mh5.ui.Control,function(a){return{rootHtmlElementName:"li",constructor:function(b,c){a.constructor.call(this,b,c);var d=RegExp(this.parent.parent.query.replace(/[#-.]|[\[-\^]|[?|{}\/]/g,"\\$&"),"i");this.root.innerHTML=nokia.mh5.utils.escapeHTML(this.text).replace(d,'<span class="mh5_secondaryColorBright">$&</span>')}}}),listeners:{tap:function(a){var b=this.parent;b.query=a.data.item.text;b.input.blur();b.search()}}},searchAdapter:nokia.mh5.adapters.Search,
completionAdapter:nokia.mh5.components.Search.SEARCH_COMPLETION,parameters:{},constructor:function(a,b){this.searchAdapter=a.searchAdapter?a.searchAdapter:this.searchAdapter;this.completionAdapter=a.completionAdapter?a.completionAdapter:nokia.mh5.components.Search.SEARCH_COMPLETION;g.constructor.call(this,a,b)},build:function(){var a=nokia.mh5.event.add,b=this.input,c=this.query,d=this.parameters;Object.defineProperty(this,"parameters",{get:function(){return this._parameters},set:function(a){this._parameters=
{};nokia.mh5.each(a,function(a,b){this._parameters[b]="function"===typeof a?a.bind(this):a},this)}});if(d)this.parameters=d;Object.defineProperty(this,"query",{get:function(){return b.value},set:function(a){b.value=a}});if(c)this.query=c;this.completionAdapter&&nokia.mh5.ui.Control.watch(b,"value",this,this._updateCompletion);a(b,"submit",this.search.bind(this));a(b,"focus",this._onFocus.bind(this));a(b,"blur",this._onBlur.bind(this));g.build.call(this)},search:function(){var a=nokia.mh5.event.fire;
this.completion.visible=!1;this.query?(this.completionAdapter&&this.completionAdapter.add(this.query),a(this,"beforesearch",{query:this.query}).defaultPrevented||this.searchAdapter.search(this.query,this.parameters,function(b){a(this,"success",b)}.bind(this),function(b){a(this,"error",b)}.bind(this))):a(this,"clear")},_onFocus:function(){if(this.completionAdapter)this._updateCompletion(),this.completion.visible=!0},_onBlur:function(){var a=this.completion;a.visible&&setTimeout(function(){a.visible=
!1},nokia.mh5.platform.blackberry?1E3:250)},_updateCompletion:function(){var a=this.completion;this.completionAdapter.get.call(this,this.input.value,function(b){a.items=b.map(function(a){return{text:a}})},4)}}});nokia.mh5.provide("nokia.mh5.components.Route");
nokia.mh5.components.Route=new nokia.mh5.Class(nokia.mh5.ui.Container,function(g){var a=nokia.mh5.geolocation,c=nokia.mh5.i18n,f=c("currentLocation"),d=nokia.mh5.ui.Control.prototype.getRootOwnerByClass,b=new nokia.mh5.Class(nokia.mh5.ui.Control,function(){var a=nokia.mh5.dom.addClass,b=nokia.mh5.dom.removeClass;return{rootHtmlElementName:"li",innerHTML:"<div class='mh5_ListItem_name'>"+f+"</div><div></div>",update:function(c){var d=this.root.lastChild;switch(c){case "active":b(d,"mh5_spinner","mh5_hidden");
a(d,"mh5_position_available");break;case "waiting":b(d,"mh5_position_available","mh5_hidden");a(d,"mh5_spinner");break;default:b(d,"mh5_spinner","mh5_position_available"),a(d,"mh5_hidden")}}}}),e;return{routeAdapter:nokia.mh5.adapters.Route,constructor:e=function(a,b){this.routeAdapter=a.routeAdapter?a.routeAdapter:this.routeAdapter;g.constructor.call(this,a,b)},build:function(){var b=this.parameters||{mode:"walk"},c=this.from,m=this.to,p=nokia.mh5.event,o=p.add,q=p.fire,v=this.inputs.from,s=this.inputs.to,
p=function(b){var c=d.call(this,e),g=s==b.target?"to":"from",h=c[g+"List"],b=b.data.results,n=0<b.length;(h.visible=n)?h.items=b:this.input.value=c[g]&&c[g].name||"from"==g&&a.available&&f||""},u=function(a){q(d.call(this,e),"error",a.data)};Object.defineProperties(this,{parameters:{enumerable:!0,get:function(){return this._routeParameters},set:function(a){this._routeParameters={};nokia.mh5.each(a,function(a,b){this._routeParameters[b]="function"===typeof a?a.bind(this):a},this);this.mode.button.select(this._routeParameters.mode);
this.route()}},from:{enumerable:!0,get:function(){return this._from},set:function(a){this._from=a;this.inputs.from.input.value=a&&a.name||"";this.route()}},to:{enumerable:!0,get:function(){return this._to},set:function(a){this._to=a;this.inputs.to.input.value=a&&a.name||"";this.route()}}});!b.mode&&(b.mode="walk");b&&(this.parameters=b);c&&(this.from=c);m&&(this.to=m);o(v,"beforesearch",function(b){if(b.data.query==f)b.preventDefault(),a.available?this.parent.parent.from={name:f,latitude:a.latitude,
longitude:a.longitude}:v.input.value=""});o(v,"success",p);o(v,"error",u);o(v,"clear",function(){var b=d.call(this,e);b.from&&b.from.name!=f&&a.available?b.from={name:f,latitude:a.latitude,longitude:a.longitude}:(b.from=void 0,q(b,"clear"))});o(s,"success",p);o(s,"error",u);o(s,"clear",function(){d.call(this,e).to=void 0;q(d.call(this,e),"clear")});o(a,"positionactivate",function(){var b=this.inputs.from,c=b.completion.renderedItems;""===b.input.value&&(this.from={name:f,latitude:a.latitude,longitude:a.longitude});
c.length&&c[0].update&&c[0].update("active")}.bind(this));o(a,["positionerror","positiondeactivate","positionlost"],function(){this.inputs.from.input.value==f&&(this.from=void 0)}.bind(this));g.build.call(this)},cssClass:"mh5_Route",children:["inputs","mode","fromList","toList"],inputs:{control:nokia.mh5.ui.Container,cssClass:"mh5_inputs",layout:{type:nokia.mh5.ui.ColumnLayout},children:["from","to"],from:{control:nokia.mh5.components.Search,completionAdapter:{get:function(b,c){var d=a.status,e="active"==
d||"waiting"==d;nokia.mh5.components.Search.SEARCH_COMPLETION.get.call(this,b,function(a){e&&a.unshift(f);c(a)},e?3:4)},add:function(a){a!=f&&nokia.mh5.components.Search.SEARCH_COMPLETION.add(a)}},completion:{itemsDidChange:function(c){var d=c.length&&c[0].text==f,e=a.status;d&&(c[0].itemClass=b);this.constructor.prototype.itemsDidChange.call(this,c);d&&this.renderedItems[0].update(e)}},input:{placeholder:c("from"),cssClass:"mh5_TextInput mh5_secondaryColorBrightPH mh5_secondaryColorBright"}},to:{control:nokia.mh5.components.Search,
input:{placeholder:c("to"),cssClass:"mh5_TextInput mh5_secondaryColorBrightPH mh5_secondaryColorBright"}}},mode:{control:nokia.mh5.ui.Container,children:["button"],button:{control:nokia.mh5.ui.SegmentedButton,cssClass:"mh5_SegmentedIconButton mh5_mode mh5_ColumnLayout",items:["drive","walk","pt"].map(function(a){return{iconClass:"mh5_icon_"+a,value:a}}),onValueChange:function(a){var b=d.call(this,e),c=b.parameters;if(c.mode!==a)c.mode=a,b.route()}}},fromList:{control:nokia.mh5.ui.List,itemClass:nokia.mh5.components.PlaceListItem,
visible:!1,onClick:function(a){this.parent.from=this.items[a];this.visible=!1}},toList:{control:nokia.mh5.ui.List,itemClass:nokia.mh5.components.PlaceListItem,visible:!1,onClick:function(a){this.parent.to=this.items[a];this.visible=!1}},route:function(){var b=nokia.mh5.event.fire,c=this,d=c.from&&c.from.name!=f&&c.from||a.available&&a.coords,e=c.to,g=c.parameters,q;if(d&&e&&(q=b(c,"beforeroute",{from:d,to:e,parameters:g}),!q.defaultPrevented))q=d.name==f&&delete d.name,c._from=c._from||{},c._from.latitude=
d.latitude,c._from.longitude=d.longitude,c.routeAdapter.fetch([d,e],g,function(a){b(c,"success",a)},function(a){b(c,"error",{message:a})}),q&&(d.name=f)}}});nokia.mh5.provide("nokia.mh5.components.IncidentDetails");
nokia.mh5.components.IncidentDetails=new nokia.mh5.Class(nokia.mh5.ui.Container,function(g){function a(a){return 10>a?"0"+a:a}function c(b){return b.toLocaleDateString()+" "+b.getHours()+":"+a(b.getMinutes())+":"+a(b.getSeconds())}var f=nokia.mh5.dom,d=nokia.mh5.i18n,b=nokia.mh5.win,e=[d("maps.Traffic.critical"),d("maps.Traffic.major"),d("maps.Traffic.minor")];return{control:nokia.mh5.ui.Container,children:["filler","title","data","fillup"],layout:{type:nokia.mh5.ui.RowLayout},filler:{control:nokia.mh5.ui.Control,
cssClass:"mh5_incidentDetailsFiller",onClick:function(){this.parent.visible=!1}},title:{control:nokia.mh5.ui.Container,cssClass:"mh5_incidentDetailsTitle mh5_standardBackgroundColorDark"},data:{control:nokia.mh5.ui.Container,cssClass:"mh5_incidentDetailsData"},fillup:{control:nokia.mh5.ui.Control,cssClass:"mh5_fillup"},cssClass:"mh5_IncidentDetails",build:function(){this.resize=this.resize.bind(this);g.build.call(this)},resize:function(){var a=this.getContentRoot();f[a.offsetHeight>this.root.offsetHeight?
"addClass":"removeClass"](a.parentNode,"mh5_fillupDisable");this._scroll&&b.setTimeout(this._scroll.refresh,1)},vScroll:!0,bounce:!1,incident:null,incidentDidChange:function(a){if(a){var f,g=a.icon,a=a.incident;f="<p>"+(d("maps.Traffic.incidentStartTime")+": "+c(a.startTime)+"<br>"+d("maps.Traffic.incidentEndTime")+": "+c(a.endTime)+"</p>");this.title.root.innerHTML=f;f="<div class='header'><img src='"+g+"'></img><h1 class='mh5_title'>"+a.type+"</h1></div><p>"+d("maps.Traffic.incidentDescription",
{origin:a.origin,direction:a.direction})+"</p><p>";f+=d(a.end?a.bidirectional?"maps.Traffic.incidentBidir":"maps.Traffic.incidentUnidir":"maps.Traffic.incidentAt",{start:a.start,end:a.end})+"<br>"+a.description+"</p><p>"+d("maps.Traffic.criticalityTitle")+": "+e[a.criticality]+"</p>";this.data.root.innerHTML=f}else this.title.root.innerHTML="",this.data.root.innerHTML="";var p=this;b.setTimeout(function(){p.resize()},500)},visibleDidChange:function(a){a?(f.addEvent(b,"viewportchange",this.resize,
!1),this.resize()):f.removeEvent(b,"viewportchange",this.resize,!1);g.visibleDidChange.call(this,a)}}});nokia.mh5.provide("nokia.mh5.maps.NavigationDisclaimerDialog");
nokia.mh5.maps.NavigationDisclaimerDialog=new nokia.mh5.Class(nokia.mh5.ui.Dialog,function(g){var a=nokia.mh5,c=a.i18n,f,d=a.ui.Container,b=a.ui.Control,e=a.ui.Button,h=a.event,j=a.platform,m=a.dom.query(".mh5_audio")[0],p;return{cssClass:"mh5_NavigationDisclaimerDialog mh5_modal mh5_modalBg",control:d,children:["contents"],contents:{control:d,layout:{type:a.ui.RowLayout},children:["header","content","buttonContainer"],header:{control:d,children:["headline"],cssClass:"mh5_dialogHeader",headline:{control:d,
rootHtmlElementName:"h1",cssClass:"mh5_title",innerHTML:c("maps.Nav.disclaimerTitle")+" <label>("+c("beta")+")</label>"}},content:{control:d,cssClass:"mh5_content",children:["instructions","successText","spinner"],instructions:{control:b,cssClass:"mh5_instructions mh5_primaryColorDark",innerHTML:"<ul><li>"+c("maps.Nav.disclaimerPoint1")+"</li><li>"+c("maps.Nav.disclaimerPoint2")+"</li><li>"+c("maps.Nav.disclaimerPoint3")+"</li><li>"+c("maps.Nav.disclaimerPoint4")+"</li></ul>"},successText:{control:b,
visible:!1,cssClass:"mh5_actionText",innerHTML:c("maps.Nav.success")},spinner:{control:b,visible:!1,cssClass:"mh5_spinner_big_bright"}},buttonContainer:{control:d,cssClass:"mh5_screenContainer",children:["buttons"],buttons:{control:d,cssClass:"mh5_buttonContainer",children:["cancelButton","downloadButton","startButton"],cancelButton:{control:e,cssClass:"mh5_Button mh5_textButton",text:c("cancel"),onClick:function(){f.visible=!1}},downloadButton:{control:e,cssClass:"mh5_Button mh5_textButton",text:c("maps.Nav.load")},
startButton:{control:e,cssClass:"mh5_Button mh5_textButton",visible:!1,text:c("maps.Nav.start"),onClick:function(){f._startJourney()}}}}},disableUpdatePosition:!0,allowScrolling:!0,build:function(){f=this;m&&m.readyState===HTMLMediaElement.HAVE_ENOUGH_DATA&&~m.currentSrc.indexOf(a.components.settings.get("unitSystem")+"_audio.mp3")?(f._readyToStart(),f.contents.content.successText.visible=!1):h.add(f.contents.buttonContainer.buttons.downloadButton.root,"down",f._downloadAudio);g.build.call(this)},
_downloadAudio:function(){var b=f.contents.content,c=f.contents.buttonContainer.buttons.downloadButton,d=a.components.settings.get("unitSystem"),e=m&&!~m.currentSrc.indexOf(d+"_audio.mp3"),g=5;if(!m||e)e&&m.parentNode.removeChild(m),m=a.doc.createElement("audio"),m.src=j.android_webview?"http://m.maps.nokia.com/fw/audio/"+d+"_audio.mp3":a.assetsPath+"audio/"+d+"_audio.mp3",a.dom.addClass(m,"mh5_audio"),a.doc.body.appendChild(m);h.add(m,"canplaythrough",function C(){h.remove(m,"canplaythrough",C);
a.win.clearTimeout(p);f._readyToStart()});h.add(m,"error",function B(){g--?m.load():(h.remove(m,"error",B),g=5,f._showError())});p=a.win.setTimeout(f._showError,15E3);b.spinner.visible=c.disabled=!0;j.ios&&m.readyState===HTMLMediaElement.HAVE_NOTHING?m.load():m.readyState===HTMLMediaElement.HAVE_ENOUGH_DATA&&f._readyToStart()},_showError:function(){var b=f.contents.content,d=f.contents.buttonContainer.buttons.downloadButton;b.spinner.visible=d.disabled=!1;d.text=c("retry");b.successText.root.innerHTML=
c("maps.Nav.tryAgain");b.successText.visible=!0;a.win.clearTimeout(p)},_readyToStart:function(){var a=f.contents.content,b=f.contents.buttonContainer.buttons;a.spinner.visible=b.downloadButton.visible=!1;a.successText.visible=b.startButton.visible=!0},_startJourney:function(){f._closeDialog();f.onFinish&&f.onFinish()}}});nokia.mh5.provide("nokia.mh5.app.commonLayout");
(function(g){var a=Math.PI,c=a/2,f=3*c,d,b=function(a){var b,c;h(a);if(a==nokia.mh5.app.controller.current.page.details&&a!=a.parent._shadowDetails)b=a.parent.map,(c=b.getPois(a.place,!0))&&b.moveTo(a.getMapCenterToShowPoiInGap(c,-c.image.height/2))},e=function(a){var b=nokia.mh5.maps.analytics;b.log({gn:"map:place details",pl:b.getPlaceId(a),c19:b.getContext(a),v19:"~c19",c32:"place details",ev:"prodView",v34:a.ownerContent?"prime":"not prime"})},h=function(a){"_resizeTimeout"in a&&(g.clearTimeout(a._resizeTimeout),
delete a._resizeTimeout)},j=function(a){return this=="routeInfo"in a.data},m=nokia.mh5.geolocation,p=nokia.mh5.i18n,o=nokia.mh5.utils,q=nokia.mh5.components.settings,v=function(a,b,c,d,e){var c=d.geoToPoint(d.center),f=d.size.width/2,g=d.size.height/2,a=d.geoToPoint(a);return d.pointToGeo({x:c.x-(d.size.width/2-(f-(c.x-a.x))),y:c.y-(e.offsetTop+e.offsetHeight/2-(g-(c.y-a.y)))+b})},s=p("currentLocation"),u={map:function(){return this.parent.parent.parent.parent.map}},D=function(b,e,g,h,j){d.beginPath();
d.moveTo(28*b,e*(15+j));d.lineTo(b*(18+j+h),e*(15+j));d.arc(b*(18+j+h),e*(15+j+h),h,0<e?f:c,0<b?a:0,0<b*e);d.lineTo(b*(18+j),e*g)},C=function(b,e,g){var h=g.time,j=g.distance,A=q.current.unitSystem,m=b.size,p=b.geoToPoint(e),s=b.geoToPoint(b.box[0]),e={summary:g,latitude:e.latitude,longitude:e.longitude,routeInfo:!0,locationX:160>p.x-s.x&&p.x-s.x<m.width/2?0:1,locationY:50>=m.height-(p.y-s.y)?1:0},g=nokia.mh5.extend({background:!1,renderOnly:!0,privilegeLevel:0},b.infoBubbleParams);j&&h?h=o.formatDistance(j,
A)+", "+o.formatTime(h):(h=600*Math.ceil(h/600),h=Math.floor(h/3600)+"hr "+h/60%60+"min");var p=h,h=document.createElement("canvas"),v=s=0,u=0,j=Math.round(32/12),B=Math.round(16/12),C=Math.round(160/12),K=0,A=e.locationX,m=e.locationY,ca,L;d=h.getContext("2d");u+=C+4.5;d.font="10pt Arial";d.textBaseline="bottom";d.fillStyle="rgb(255,255,255)";K=Math.max(K,d.measureText(p||" ").width);v+=K+16;u=u-4.5+10;h.width=v+16;h.height=u+14;d.save();d.translate(A?0:16,m?0:14);C=B/2;K=j+C;ca=v-K;L=u-K;d.fillStyle=
"rgba(0,15,26,0.85)";d.lineWidth=B;d.lineCap="round";d.moveTo(K,C);v=[ca,C,ca,K,j,f,0,v-C,L,ca,L,j,0,c,K,u-C,K,L,j,c,a,C,K,K,K,j,a,f];u=0;for(B=v.length;u<B;)d.lineTo(v[u++],v[u++]),d.arc(v[u++],v[u++],v[u++],v[u++],v[u++]);d.fill();d.textBaseline="top";d.fillStyle="#FFFFFF";d.font="10pt Arial";d.fillText(p,s+8,3.5);d.restore();p=A?-1:1;s=m?-1:1;d.translate(h.width*A,h.height*m);D(p,s,h.height,j,-1);d.strokeStyle="rgb(255,255,255)";d.stroke();D(p,s,h.height,j,0);d.lineTo(0,0);d.closePath();d.fillStyle=
"rgba(0,15,26,0.85)";d.fill();g.image=h;b.showInfoBubble(e,g)},B={control:nokia.mh5.components.IncidentDetails,visible:!1,detailsPoi:null,visibleDidChange:function(a,b){var c=this,d=c.parent,e=d.map;if(a)e.passive=!0,e.hideInfoBubble(e.infoBubbles.filter(j,!1)),c.detailsPoi=e.createPoi(c.incident.icon,c.incident),c.detailsPoi.privileged=!0,g.setTimeout(function(){nokia.mh5.dom.transition({node:c.root,transitionClass:"mh5_transition_slide",fromTransformClass:"mh5_transition_bottom",toTransformClass:"mh5_transition_middle"},
function(){nokia.mh5.dom.removeClass(c.root,"mh5_transition_slide","mh5_transition_middle");e.moveTo(v(c.detailsPoi,-c.detailsPoi.image.height/2,c.getRootOwnerByClass(nokia.mh5.ui.Page),e,c.filler.root));g.setTimeout(function(){if(d.incidentDetails.visible)d.detailsClose.visible=!0},400)});c.constructor.prototype.visibleDidChange.call(c,a,b)},0);else if(b){h(c);if(c.detailsPoi)e.removePoi(c.detailsPoi),c.detailsPoi=null;d.detailsClose.visible=!1;g.setTimeout(function(){nokia.mh5.dom.transition({node:c.root,
transitionClass:"mh5_transition_slide",fromTransformClass:"mh5_transition_middle",toTransformClass:"mh5_transition_bottom"},function(){c.constructor.prototype.visibleDidChange.call(c,a,b);nokia.mh5.dom.removeClass(c.root,"mh5_transition_slide","mh5_transition_bottom");if(c===d.incidentDetails){e.passive=!1;var f=c.parent.model.selection;if(f){var f=e.getPois(f,!0),g=nokia.mh5.extend({renderOnly:!0,left:f.data.icon},e.infoBubbleParams);g.content=["title","description"];e.showInfoBubble(f,g)}}})},0)}else c.constructor.prototype.visibleDidChange.call(c,
a,b)}},A=new nokia.mh5.Class(nokia.mh5.ui.Control,function(){return{rootHtmlElementName:"li",cssClass:"noresults"}});nokia.mh5.app.commonLayout={pages:["search","route","share","favourites"],controller:nokia.mh5.app.phoneController,search:{children:"header,map,traffic,detailsClose,list,details,incidentDetails,notification".split(","),layout:{type:nokia.mh5.ui.RowLayout},model:{query:"",data:[],selection:null,searchCenter:null,reset:function(){this.query="";this.data=[];this.searchCenter=this.selection=
null}},adapter:nokia.mh5.adapters.Search,unitSystemBinding:"nokia.mh5.components.settings#current.unitSystem",onlineStatusBinding:"nokia.mh5.components.settings#current.isOnline",header:{control:nokia.mh5.ui.Container,layout:{type:nokia.mh5.ui.ColumnLayout,align:"stretch"},rootHtmlElementName:"header",cssClass:"mh5_baseBackgroundColor",search:{control:nokia.mh5.components.Search,input:{cssClass:"mh5_TextInput mh5_secondaryColorBrightPH mh5_secondaryColorBright",placeholder:p("searchPlaces")},parameters:{map:function(){return this.parent.parent.map}},
listeners:{beforesearch:function(){var a=this.parent.parent,b=a.model;b.reset();a.map.hideInfoBubble();b.searchCenter=a.map.center;b.query=this.query;a.details.visible=!1;a.incidentDetails.visible=!1;a.showNotification(q.get("isOnline")?p("searching")+"...":p("Notification.goOnline"))},success:function(a){var b=a.data.results,a=a.data.box,c=this.parent.parent;c.resetNotification();0<b.length?(c.model.data=b,c.model.selection=b[0],c.map.hideInfoBubble(),c.map.showInfoBubble(c.map.getPois(b[0],!0)),
c.map.box=a||b,nokia.mh5.app.controller.updateHistoryEntry(),c.map.save(),nokia.mh5.maps.analytics.log({gn:c.map.visible?"map:search results":"list:search results",c36:c.model.query,c37:c.model.data.length,v39:"+1",c32:"search performed",ev:"event14"})):c.map.visible&&c.showNotification(p("Notification.noResultFound"),nokia.mh5.ui.Notification.TIMEOUT_DEFAULT)},error:function(){var a=this.parent.parent;a.resetNotification();a.showNotification(p("Notification.searchProblem"))},clear:function(){var a=
this.parent.parent,b=a.details;a.model.reset();a.map.hideInfoBubble();a.resetNotification();b.visible=!1}}}},detailsClose:{control:nokia.mh5.ui.Control,visible:!1,cssClass:"mh5_showDetails"},map:{control:nokia.mh5.components.Map,infoBubble:{content:["title"],listeners:{click:function(){var a=this.parent.parent,b=nokia.mh5.app.controller;e(this.data);a.model.mapMode=!0;b.updateHistoryEntry();(this.data.incident?a.incidentDetails:a.details).visible=!0;b.pushHistoryEntry("search",a.getNavigationState(),
a.getHash())}}},listeners:{poiclick:function(a){this.parent.model.selection=a.data[0].data;nokia.mh5.app.controller.updateHistoryEntry()},maplongpress:function(a){this.parent.model.selection=a.data;nokia.mh5.app.controller.updateHistoryEntry()},mapclick:function(){var a=this.parent.model;if(a.selection)a.selection=null,nokia.mh5.app.controller.updateHistoryEntry()}}},traffic:{control:nokia.mh5.components.Traffic,visible:!1},list:{control:nokia.mh5.ui.List,visible:!1,cssClass:"mh5_List mh5_searchResults"},
openDetailsTracking:function(a){var b=nokia.mh5.maps.analytics;b.log({gn:"list:place details",pl:b.getPlaceId(a),c19:b.getContext(a),v19:"~c19",c32:"place details",ev:"prodView",v34:a.ownerContent?"prime":"not prime"})},details:{control:nokia.mh5.components.PlaceDetails,visible:!1,customContent:{name:"mapoffset",cssClass:"mh5_PlaceDetailsMapOffset",before:"summary",onClick:function(){this.parent.visible=!1}},resize:function(){this.constructor.prototype.resize.apply(this,arguments);if(this.visible)h(this),
this._resizeTimeout=g.setTimeout(b,1E3,this)},listeners:{nearby:function(a){var b=a.data.place,c=a.data.index,d=this.getRootOwnerByClass(nokia.mh5.ui.Page),e=d.map,c=this.recommendations.list.renderedItems[c];h(this);if(d.transitionBetweenDetails){if(!c.distance)c.distance=1,c.update();nokia.mh5.dom.query(".mh5_ListItem_distance",c.root)[0].innerHTML='<span class="mh5_spinner"></span>'}a.preventDefault();d.model.reset();0<e.getPois().length&&e.removePoi(d.map.getPois());d.model.data=[b];d.model.selection=
b;nokia.mh5.app.controller.pushHistoryEntry("search",d.getNavigationState(),d.getHash())},share:function(a){nokia.mh5.app.controller.updateHistoryEntry();nokia.mh5.app.controller.share({data:a.data,metadata:{}})},route:function(a){nokia.mh5.app.controller.route({from:m.available&&m.coords,to:a.data})},addFavourite:function(a){var b;switch(a.data.status){case "removed":b="Notification.removedFromFavourites";break;case "added":b="Notification.addedToFavourites";break;case "failed2add":b="Notification.favouritesNoSaved"}this.parent.showNotification(p(b),
nokia.mh5.ui.Notification.TIMEOUT_DEFAULT)},error:function(a){this.parent.showNotification(a.data.message,nokia.mh5.ui.Notification.TIMEOUT_DEFAULT)}},getMapCenterToShowPoiInGap:function(a,b){var c=this.getRootOwnerByClass(nokia.mh5.ui.Page);return v(a,b,c,c.map,c.details.mapoffset.root)},visibleDidChange:function(a,b){var c,d,e,f;a?(c=this.parent,d=c.map,e=this,d.passive=!0,d.hideInfoBubble(),c.traffic.hideIncidents(),d.removePoi(d.getPois()),f=d.createPoi(o.place.getCategoryIcon(e.place),e.place),
g.setTimeout(function(){nokia.mh5.dom.transition({node:e.root,transitionClass:"mh5_transition_slide",fromTransformClass:"mh5_transition_bottom",toTransformClass:"mh5_transition_middle"},function(){nokia.mh5.dom.removeClass(e.root,"mh5_transition_slide","mh5_transition_middle");d.moveTo(e.getMapCenterToShowPoiInGap.call(e,f,-f.image.height/2));g.setTimeout(function(){c.details.visible&&nokia.mh5.dom.removeClass(c.detailsClose.root,"mh5_hidden")},400)});e.constructor.prototype.visibleDidChange.call(e,
a,b)},0)):b?(e=this,c=e.parent,d=c.map,h(e),nokia.mh5.dom.addClass(c.detailsClose.root,"mh5_hidden"),g.setTimeout(function(){nokia.mh5.dom.transition({node:e.root,transitionClass:"mh5_transition_slide",fromTransformClass:"mh5_transition_middle",toTransformClass:"mh5_transition_bottom"},function(){e.constructor.prototype.visibleDidChange.call(e,a,b);nokia.mh5.dom.removeClass(e.root,"mh5_transition_slide","mh5_transition_bottom");if(e===c.details){d.passive=!1;var f=e.parent.model,g=f.selection;d.removePoi(d.getPois());
f.data.forEach(function(a){d.createPoi(o.place.getCategoryIcon(a),a)});q.get("trafficIncidentsEnabled")&&c.traffic.showIncidents();g&&d.showInfoBubble(!~f.data.indexOf(g)?g:d.getPois(g,!0),nokia.mh5.extend({renderOnly:!0},d.infoBubbleParams))}})},0)):this.constructor.prototype.visibleDidChange.apply(this,arguments)}},incidentDetails:B,notification:{control:nokia.mh5.ui.Notification,visible:!1},showNotification:function(a,b){var c=this.notification;c.text=a;c.timeout=b||nokia.mh5.ui.Notification.TIMEOUT_INFINITY;
c.visible=!0},resetNotification:function(){var a=this.notification;a.timeout=nokia.mh5.ui.Notification.TIMEOUT_DEFAULT;a.visible=!1},build:function(){this.constructor.prototype.build.call(this);if(this.transitionBetweenDetails)this._shadowDetails=new nokia.mh5.components.PlaceDetails(nokia.mh5.app.layout.search.details),this._shadowDetails.parent=this;this.traffic.map=this.map},setModel:function(a){function b(){var c=e.parent.details,f;c.visible&&a.showDetails?(d.passive=!0,d.hideInfoBubble(),d.removePoi(d.getPois()),
f=d.createPoi(o.place.getCategoryIcon(a.selection),a.selection),d.moveTo(c.getMapCenterToShowPoiInGap(f,-f.image.height/2))):c.visible=!!a.showDetails}var c=this.model,d=this.map,e=this.details,f=this.incidentDetails;if(a&&a.hasOwnProperty("mapMode"))this.mapMode=a.mapMode||a.showDetails;if(a.data&&c.data!==a.data)c.reset(),c.data=a.data;if(a.searchCenter&&(!c.searchCenter||c.searchCenter.longitude!==a.searchCenter.longitude||c.searchCenter.latitude!==a.searchCenter.latitude))d.center=c.searchCenter=
a.searchCenter;if(a.query&&c.query!==a.query&&(c.query=a.query,!a.data&&this.header&&this.header.search))this.header.search.query=a.query,this.header.search.search();if(!a.query&&a.selection&&c.selection!==a.selection)if(0>c.data.indexOf(a.selection)){if(this.header&&this.header.search)this.header.search.query="";c.reset();e.adapter.fetch(a.selection,null,function(a){c.data=[a];c.selection=a;d.zoom=17;b()},function(){c.selection=a.selection;b()})}else c.selection=a.selection,b();else if(a.selection&&
c.selection!==a.selection)c.selection=a.selection,b();if(a.selection&&a.selection.longitude&&a.selection.latitude&&!e.visible)d.center=a.selection;if(!a.showDetails)f.visible?f.visible=!1:e.visible&&b()},unitSystemDidChange:function(){this.list.update()},onlineStatusDidChange:function(a){if(this.header&&this.header.search){var b=this.header.search,c=this.model;if(a){if(this._onlinePlaceHolder)b.input.placeholder=this._onlinePlaceHolder;this.resetNotification()}else b.query="",this._onlinePlaceHolder=
b.input.placeholder,b.input.placeholder=p("Notification.goOnlinePlaceHolder"),c.reset(),this.map.hideInfoBubble()}},onFavouritesChanged:function(a){if(a){var b=this.map.getPois(a,!0),c=new Image;if(b)c.src=o.place.getCategoryIcon(a),b.infoBubble?b.data.originalImage=c:c.onload=function(){b.image=c},this.list.update()}},_updateDetails:function(a){var b=this;if(a.incident)b.incidentDetails.incident=a;else if(b.details.visible&&b._shadowDetails){var c=function(){var a=b.details;nokia.mh5.event.remove(b._shadowDetails,
"done",c);b.getContentRoot().insertBefore(b._shadowDetails.root,a.root.nextSibling);b._shadowDetails._scroll.scrollToElement(a.parent.root);b.details=b._shadowDetails;b.details._selectedNearbyCategory=a._selectedNearbyCategory;b._shadowDetails=a;b._shadowDetails.visible=!1;b.details.visible=!0};nokia.mh5.event.add(b._shadowDetails,"done",c);b._shadowDetails.place=a}else b.details.place=a},getNavigationState:function(){var a=this.constructor.prototype.getNavigationState.call(this);a.showDetails=this.details.visible;
return a},visibleDidChange:function(a,b){this.constructor.prototype.visibleDidChange.call(this,a);nokia.mh5.ui.Control[a?"watch":"removeBinding"](nokia.mh5.components.favourites,"changedFavourite",this,this.onFavouritesChanged);a&&this.details.visible?this.details.resize():h(this.details);a&&!b&&this.traffic.reloadIncidents()}},route:{model:{from:null,to:null,parameters:{mode:"walk"},selection:null,data:[],reset:function(){this.selection=this.to=this.from=null;this.data=[]}},children:"header,map,traffic,maneuvers,detailsClose,incidentDetails,notification".split(","),
layout:{type:nokia.mh5.ui.RowLayout},header:{control:nokia.mh5.ui.Container,rootHtmlElementName:"header",cssClass:"mh5_baseBackgroundColor",children:["route"],route:{control:nokia.mh5.components.Route,children:["inputs","border","mode","fromList","toList"],border:{control:nokia.mh5.ui.Control,cssClass:"mh5_border mh5_secondaryBackgroundColorDark"},inputs:{from:{parameters:u},to:{parameters:u}},mode:{children:["button","timetravel","toggle","go"],cssClass:"mh5_bottomPart",layout:{type:nokia.mh5.ui.ColumnLayout},
timetravel:{control:nokia.mh5.ui.Container,cssClass:"mh5_box-flex1"},toggle:{control:nokia.mh5.ui.Button,cssClass:"mh5_maneuvers",visible:!1,onClick:function(){var a=this.parent.parent.parent.parent.maneuvers,b={type:"fade",mode:a.visible?"out":"in",node:a.root,persistence:!0,callback:a.visible&&function(){a.visible=!1;nokia.mh5.dom.removeClass(this.root,"mh5_ListMode");nokia.mh5.dom.fireEvent(nokia.mh5.win,"hideAddressBar")}.bind(this)};nokia.mh5.dom.doTransition(b);if(!a.visible)a.visible=!0,nokia.mh5.dom.addClass(this.root,
"mh5_ListMode")},index:0},go:{control:nokia.mh5.ui.Button,cssClass:"mh5_navigation",visible:!1,onClick:function(){new nokia.mh5.maps.NavigationDisclaimerDialog({onFinish:function(){var a=this.parent.parent,b=this.from;nokia.mh5.app.controller.navigate(this.to,(!("name"in b)||b.name==s)&&{shape:a.map.route,maneuvers:a.maneuvers.items})}.bind(this.parent.parent)})}}},fromList:{visibleDidChange:function(a){this.constructor.prototype.visibleDidChange.call(this,a);if(a=this.parent.parent.parent)nokia.mh5.dom[this.visible?
"addClass":"removeClass"](a.notification.root,"mh5_listmode")}},toList:{visibleDidChange:function(a){this.constructor.prototype.visibleDidChange.call(this,a);if(a=this.parent.parent.parent)nokia.mh5.dom[this.visible?"addClass":"removeClass"](a.notification.root,"mh5_listmode")}}}},map:{control:nokia.mh5.components.Map,addressLookup:!1,moveToUserPosition:!1,infobubble:{content:["title"],listeners:{click:function(){var a=nokia.mh5.app.controller,b=this.data;b.incident?(b=this.parent.parent,a.updateHistoryEntry(),
b.incidentDetails.visible=!0,a.pushHistoryEntry("route",b.getNavigationState(),b.getHash())):b.routeInfo||(e(b),a.details(b))}}},listeners:{poiclick:function(a){var b=a.data[0];this.parent.model.selection=b.data;nokia.mh5.app.controller.updateHistoryEntry();a.defaultPrevented||(a.preventDefault(),b.infoBubble||(this.hideInfoBubble(this.infoBubbles.filter(j,!1)),b.data.name?this.showInfoBubble(b):this._triggerReverseGeoCoding(b)))},maplongpress:function(a){this.parent.model.selection=a.data;nokia.mh5.app.controller.updateHistoryEntry();
this.hideInfoBubble(this.infoBubbles.filter(j,!1));a.preventDefault()},mapclick:function(a){var b=this.parent.model;if(b.selection)b.selection=null,nokia.mh5.app.controller.updateHistoryEntry();this.hideInfoBubble(this.infoBubbles.filter(j,!1));a.preventDefault()}},_triggerReverseGeoCoding:function(a){var b=this,c=nokia.mh5.adapters.Search,d=a.data;c.reverseGeoCode(d,{appId:this.appId,appCode:this.appCode},function(e){c.merge(d,e);b.showInfoBubble(a,void 0)})}},traffic:{control:nokia.mh5.components.Traffic,
visible:!1},unitSystemBinding:"nokia.mh5.components.settings#current.unitSystem",onlineStatusBinding:"nokia.mh5.components.settings#current.isOnline",unitSystemDidChange:function(){var a=this.model,b=this.map.infoBubbles.filter(j,!0)[0];b&&(this.map.hideInfoBubble(b),C(this.map,a.to,b.data.summary));this.maneuvers.renderedItems.forEach(function(a){a.update&&a.update()})},onlineStatusDidChange:function(a,b){a&&!1===b?this.resetNotification():b&&this.showNotification(p("Notification.goOnline"))},maneuvers:{control:nokia.mh5.ui.List,
cssClass:"mh5_List mh5_Maneuvers",itemClass:nokia.mh5.components.RouteListItem,visible:!1},detailsClose:{control:nokia.mh5.ui.Control,visible:!1,cssClass:"mh5_showDetails"},incidentDetails:B,notification:{control:nokia.mh5.ui.Notification,visible:!1},_pushSearchResultListToHistory:!0,cssClass:"mh5_Page mh5_RoutePage mh5_TrafficPage",build:function(){var a=nokia.mh5.dom.addEvent,b=nokia.mh5.dom.removeEvent,c=this,d=c.map,e=c.header.route.inputs,f=e.from,h=e.to,o=f.input,v=h.input,u=c.header.route,
e=m.status,B=function(){b(c.map.root,"down",this._inputBlurBound);b(c.maneuvers.root,"down",this._inputBlurBound)},D=function(b){var d=this,e=u.inputs,f=v==b.target?"to":"from",g="from"==f?"to":"from",h=d.value===s&&m.available;c.map.tracking=!1;e[g].visible=!1;nokia.mh5.dom.removeClass(d.root.firstChild,h?"mh5_current":"mh5_"+f);this._inputBlurBound=this._inputBlurBound||function(){h=d.value===s&&m.available;e[g].visible=!0;d.value&&nokia.mh5.dom.addClass(d.root.firstChild,h?"mh5_current":"mh5_"+
f);d.blur()};a(c.map.root,"down",this._inputBlurBound);a(c.maneuvers.root,"down",this._inputBlurBound)},ya=function(a){c.incidentDetails.visible=!1;f==a.target&&a.data.query==s?(a.preventDefault(),h.visible=!0):q.get("isOnline")?c.showNotification(p("searching")+"..."):(a.preventDefault(),(h==a.target?f:h).visible=!0,c.showNotification(p("Notification.goOnline")))},K=function(a){var b="from"==(h==a.target?"to":"from")?"to":"from",a=0<a.data.results.length;c.listMode=c.listMode||c.maneuvers.visible;
c.resetNotification();if(a){if(c._pushSearchResultListToHistory)nokia.mh5.app.controller.route(),c._pushSearchResultListToHistory=!1,c.maneuvers.visible=!1}else c.showNotification("No results found",nokia.mh5.ui.Notification.TIMEOUT_DEFAULT),u.inputs[b].visible=!0},ca=function(a){var b=u.toList==a.target?"to":"from",e=c.model;u.mode.toggle.visible=c.maneuvers.visible=c.listMode;c.listMode=!1;nokia.mh5.dom.addClass(u.inputs[b].input.root.firstChild,"mh5_"+b);u.inputs["to"==b?"from":"to"].visible=!0;
c[b+"Poi"]&&d.removePoi(c[b+"Poi"]);c[b+"Poi"]=d.createPoi(nokia.mh5.assetsPath+"img/"+b+".png",a.data.item);c[b+"Poi"].privilegeLevel=1;if(!m.available)e[b]=u[b],e.parameters=u.parameters,nokia.mh5.app.controller.updateHistoryEntry()};c.constructor.prototype.build.call(this);a(o,"focus",D);a(o,"blur",B);a(v,"focus",D);a(v,"blur",B);a(f,"beforesearch",ya);a(h,"beforesearch",ya);a(f,"success",K);a(h,"success",K);a(u,"beforeroute",function(a){var b=a.data,e=nokia.mh5.dom,f=this.inputs.from.input,g=
this.inputs.to.input,n=b.from,h=b.to,j=b.parameters.mode,t=c.model;if("pt"==j)this.originalMapSchema=q.get("mapSchema"),q.set("mapSchema","normal.day.grey");else if(this.originalMapSchema)q.set("mapSchema",this.originalMapSchema),this.originalMapSchema=null;d.box=[n,h];d._map.route=[];d.hideInfoBubble();c.fromPoi&&d.removePoi(c.fromPoi);c.toPoi&&d.removePoi(c.toPoi);e.removeClass(f.root.firstChild,"mh5_from","mh5_current");e.removeClass(g.root.firstChild,"mh5_to");c.fromPoi=d.createPoi(nokia.mh5.assetsPath+
"img/from.png",n);c.toPoi=d.createPoi(nokia.mh5.assetsPath+"img/to.png",h);c.fromPoi.privilegeLevel=c.toPoi.privilegeLevel=1;e.addClass(f.root.firstChild,n.name?"mh5_from":"mh5_current");e.addClass(g.root.firstChild,"mh5_to");t.from=n;t.to=h;t.parameters=b.parameters;c.visible&&nokia.mh5.app.controller.updateHistoryEntry();c.traffic&&c.traffic.reloadIncidents();"walk"==j&&5E4<nokia.mh5.math.pointDistance(n,h)?(b=q.current.unitSystem,c.showNotification(p("Error.routeTooLong",{maxWalkingDistance:("mi"==
b?30:50)+b})),a.preventDefault()):c.showNotification(p("Notification.routeCalculation"))});a(u,"success",function(a){var b=this.parameters.mode,e=u.mode,f=u.inputs,a=a.data,n=c.model,h=d.infoBubbles.filter(j,!0)[0],t;t=a.shape;c.timeTraveling?c.showNotification(p("Notification.trafficInBeta"),nokia.mh5.ui.Notification.TIMEOUT_DEFAULT):c.resetNotification();c.maneuvers.items=a.maneuvers;e.toggle.visible=f.from.visible=f.to.visible=!0;g.setTimeout(function(){d._map.route=t},10);d.box=a.box||t;h&&d.hideInfoBubble(h);
C(d,n.to,a.summary);nokia.mh5.maps.analytics.log({gn:"route displayed",c32:"route displayed",ev:"event26",c35:b,v35:"~c35"})});a(u,"error",function(a){var b=u.mode;b.toggle.visible=c.listMode||c.maneuvers.visible;b.go.visible=!1;u.inputs.from.visible=u.inputs.to.visible=!0;c.showNotification(a.data.message||p("Notification.noRoutingService"),nokia.mh5.ui.Notification.TIMEOUT_DEFAULT);c.maneuvers.items=[{itemClass:A}]});a(u,"clear",function(){var a=u.inputs,b=u.mode,e=c.model;u.from||d.removePoi(c.fromPoi);
u.to||d.removePoi(c.toPoi);d.route=[];var f=d.infoBubbles.filter(j,!0)[0];d.hideInfoBubble(f);c.maneuvers.items=[];a.from.visible=a.to.visible=!0;b.go.visible=b.toggle.visible=!1;e.from=u.from;e.to=u.to;e.parameters=u.parameters;nokia.mh5.app.controller.updateHistoryEntry()});a(u.fromList,"tap",ca);a(u.toList,"tap",ca);a(m,"positionactivate",function(){u.to||c.resetNotification();if(!c.fromPoi)c.fromPoi=d.createPoi(nokia.mh5.assetsPath+"img/from.png",{latitude:m.latitude,longitude:m.longitude,name:s});
c.fromPoi.privilegeLevel=1;(o.value==s||""===o.value)&&nokia.mh5.dom.addClass(o.root.firstChild,"mh5_current")});a(m,["positionerror","positionlost","positiondeactivate"],function(){u.mode.go.visible=!1;u.from||c.showNotification(p("Notification.cantFindLocation"))});nokia.mh5.ui.Control.watch(this.model,"selection",this,function(a){c.incidentDetails.incident=a&&a.incident?a:null});if(("inactive"==e||"waiting"==e||"error"==e)&&(!u.from||!u.from.latitude||!u.from.longitude))c.showNotification(p("Notification.lookingForCurrentPosition")),
("inactive"==e||"error"==e)&&m.activate();this.traffic.map=d},showNotification:function(a,b){var c=this.notification;c.timeout=b||nokia.mh5.ui.Notification.TIMEOUT_INFINITY;c.text=a;c.visible=!0},resetNotification:function(){var a=this.notification;a.timeout=nokia.mh5.ui.Notification.TIMEOUT_DEFAULT;a.visible=!1},visibleDidChange:function(a,b){var c=nokia.mh5.dom,d=this.header.route,e=d.inputs,f=e.from.input,g=f.root.firstChild,e=e.to.input.root.firstChild,h=this.map;nokia.mh5.maps.analytics.logIfVisible(this,
{gn:"directions",c32:"directions"});(h.visible=a)&&!b&&this.traffic.reloadIncidents();if(m.available&&(""===f.value||f.value==s)){if(!this.fromPoi)this.fromPoi=h.createPoi(nokia.mh5.assetsPath+"img/from.png",m.coords);this.fromPoi.privilegeLevel=1;f.value=s;c.addClass(g,"mh5_current")}else c.removeClass(g,"mh5_from","mh5_current"),c.removeClass(e,"mh5_to"),d.from&&c.addClass(g,"mh5_from"),d.to&&c.addClass(e,"mh5_to")},setModel:function(a){var b=this.header.route,c=this.model,d=this.map,e=this.traffic,
f=nokia.mh5.dom.addEvent;if(a.traffic&&!c.traffic)c.traffic=b.traffic=!0,c.parameters=b.parameters={mode:"drive"},q.isFirstTime=!1,f(m,"positionactivate",function(){d.zoom=11}),f(m,["positionerror","positionlost","positiondeactivate"],function(){d.zoom=9}),nokia.mh5.event.one(d,"ready",function(){e.enableTraffic()});if(!a.showDetails&&this.incidentDetails.visible)this.incidentDetails.visible=!1;if(c.parameters!=a.parameters)c.parameters=b.parameters=a.parameters||b.parameters||{mode:"walk"};if(c.from!=
a.from)c.from=b.from=a.from||b.from;if(c.to!=a.to)c.to=b.to=a.to||b.to}},share:{children:["storyCreator"],model:{data:null},storyCreator:{control:nokia.mh5.connectors.story.StoryCreator},setModel:function(a){this.model.data=a.data;this.storyCreator.update(a.data)},visibleDidChange:function(a){this.constructor.prototype.visibleDidChange.call(this,a);this.storyCreator.visible=a}},favourites:{children:["favourites"],favourites:{control:nokia.mh5.connectors.favourites.FavouritesViewer},visibleDidChange:function(a){this.constructor.prototype.visibleDidChange.call(this,
a);this.favourites.visible=a}}}})(nokia.mh5.win);nokia.mh5.provide("nokia.mh5.components.PlaceTabletListItem");
nokia.mh5.components.PlaceTabletListItem=new nokia.mh5.Class(nokia.mh5.ui.Control,function(g){return{rootHtmlElementName:"li",cssClass:"mh5_ListItem",constructor:function(a,c){g.constructor.call(this,a,c);this.update()},update:function(){var a,c=!(!this.distance||!this.ratingValue),f=/(\d+(\.\d+)?)(\w+)/;a=""+('<img src="'+nokia.mh5.utils.place.getCategoryIcon(this)+'"></img>');a=a+'<div class="mh5_RowLayout"><div class="mh5_ListItem_name" onclick="javascript:void(0)">'+(!this.placeId&&this.name?
this.name.split(",")[0]:this.name);a+="</div>";this.address&&(a=a+'<div class="mh5_ListItem_address" onclick="javascript:void(0)">'+(this.address.replace(/(.*?)\,\ (.*)/,'$1,<br><span class="mh5_ellipsis">$2</span>')+"</div>"));c&&(a+='<div class="mh5_ColumnLayout">');if(this.ratingValue)this._rating=this._rating||new nokia.mh5.ui.Rating,this._rating.value=this.ratingValue,a+=this._rating.root.outerHTML;this.distance&&(f=nokia.mh5.utils.formatDistance(this.distance,nokia.mh5.components.settings.current.unitSystem).match(f),
a+='<div class="mh5_ListItem_distance"><span>'+f[1]+"</span>"+f[3]+"</div>");c&&(a+="</div>");this.root.innerHTML=a}}});nokia.mh5.provide("nokia.mh5.app.tabletLayout");
(function(){nokia.mh5.app.tabletLayout={search:{cssClass:"mh5_Page mh5_SearchPage",header:{children:["search"]},list:{layout:{type:nokia.mh5.ui.ColumnLayout},itemClass:nokia.mh5.components.PlaceTabletListItem,hScroll:!0,itemsDidChange:function(a){this.constructor.prototype.itemsDidChange.call(this,a);this.visible=0<a.length?!0:!1;this.parent.map.resize()},listeners:{tap:function(a){var a=a.data.item,c=this.parent,f=c.map,d=nokia.mh5.app.controller;c.model.selection!==a?(this.parent.model.selection=
a,d.updateHistoryEntry(),f.hideInfoBubble(),f.showInfoBubble(f.getPois(a,!0))):(c.details.visible=!0,d.pushHistoryEntry("search",c.getNavigationState(),c.getHash()),c.openDetailsTracking(a))}}},build:function(){nokia.mh5.app.commonLayout.search.build.call(this);var a=this.header;if(a&&a.search){var c=a.search.input,f=nokia.mh5.event.add;f(c,"focus",function(){this.map.tracking=!1;if(!this._mapTapEventHandler)this._mapTapEventHandler=function(){c.blur();if(nokia.mh5.platform.android){var a=document.createElement("input");
a.setAttribute("type","text");document.body.appendChild(a);setTimeout(function(){a.focus();setTimeout(function(){a.setAttribute("style","display:none;");document.body.removeChild(a)},5)},5)}},f(this.map.root,"down",this._mapTapEventHandler);f(this.map.root,"down",this._mapTapEventHandler);f(this.list.root,"down",this._mapTapEventHandler)}.bind(this));f(c,"blur",function(){nokia.mh5.event.remove(this.map.root,"down",this._mapTapEventHandler);nokia.mh5.event.remove(this.list.root,"down",this._mapTapEventHandler)}.bind(this))}nokia.mh5.ui.Control.watch(this.model,
"selection",this,function(a,b){var c=this.list;if(b){var f=c.items.indexOf(b);0<=f&&(nokia.mh5.dom.removeClass(c.renderedItems[f].root,"mh5_selected"),nokia.mh5.dom.removeClass(c.root,"mh5_selected"))}if(a){this._updateDetails(a);var g=c.items.indexOf(a);if(0<=g&&(nokia.mh5.dom.addClass(c.renderedItems[g].root,"mh5_selected"),nokia.mh5.dom.addClass(c.root,"mh5_selected"),c._scroll)){var f=c.root.offsetLeft,m=c.root.offsetWidth,p=f+m,o=c.renderedItems[g].root.offsetLeft,g=c.renderedItems[g].root.offsetWidth,
q=o+g,v=c._scroll.x;o+v<f?c.scrollTo(-o+g/2,0):q+v>p&&c.scrollTo(-o+m-3*g/2,0)}}});nokia.mh5.ui.Control.watch(this.model,"data",this,function(a,b){if(0<a.length)this.list.items=a,a.forEach(function(a){this.map.createPoi(nokia.mh5.utils.place.getCategoryIcon(a),a)}.bind(this));else if(b&&0!==b.length)this.list.items=[],nokia.mh5.components.Traffic.removeNonTrafficPois(this.map)})},onFavouritesChanged:function(a){nokia.mh5.app.commonLayout.search.onFavouritesChanged.call(this,a);a=this.list.items.indexOf(this.model.selection);
0<=a&&nokia.mh5.dom.addClass(this.list.renderedItems[a].root,"mh5_selected")},unitSystemDidChange:function(){nokia.mh5.app.commonLayout.search.unitSystemDidChange.call(this);var a=this.list;if(this.model.selection){var c=a.items.indexOf(this.model.selection);0<=c&&(nokia.mh5.dom.addClass(a.renderedItems[c].root,"mh5_selected"),nokia.mh5.dom.addClass(a.root,"mh5_selected"))}},visibleDidChange:function(a){nokia.mh5.app.commonLayout.search.visibleDidChange.apply(this,arguments);this.map.visible=a}}};
var g={};nokia.mh5.extendDeep(g,nokia.mh5.app.commonLayout);nokia.mh5.extendDeep(g,nokia.mh5.app.tabletLayout);g.controller=nokia.mh5.app.commonLayout.controller;nokia.mh5.app.tabletLayout=g})(nokia.mh5.win);nokia.mh5.provide("nokia.mh5.app.phoneLayout");
(function(){var g=nokia.mh5.i18n;nokia.mh5.app.phoneLayout={search:{children:"header,map,traffic,detailsClose,list,details,incidentDetails,noResults,notification".split(","),cssClass:"mh5_Page mh5_SearchPage",noResults:{cssClass:"mh5_noresults",control:nokia.mh5.ui.Control,innerHTML:'<div class="mh5_noresultstxt">'+g("Notification.noResult")+"</div>",visible:!1},mapMode:!0,mapModeDidChange:function(a,c){if(void 0!==c){var f=this,d=f.map,b=f.details,e=f.model,g=0<e.data.length?f.list:f.noResults;transitionsObject=
{type:"fade",mode:f.mapMode?"out":"in",node:g.root,persistence:!0};if(f.header)nokia.mh5.dom[a?"removeClass":"addClass"](f.header.toggle.root,"mh5_ListMode");f.mapMode?(transitionsObject.callback=function(){d.resize();g.visible=!1;if(f._showDetailsAfterListFading&&e.selection)b.visible=!0,f._showDetailsAfterListFading=!1},d.visible=!0,nokia.mh5.event.fire(nokia.mh5.win,"hideAddressBar",{},!0,!0)):(transitionsObject.callback=function(){d.visible=!1},g.visible=!0);nokia.mh5.dom.doTransition(transitionsObject)}},
header:{children:["search","toggle"],layout:{type:nokia.mh5.ui.ColumnLayout},search:{listeners:{clear:function(){nokia.mh5.app.commonLayout.search.header.search.listeners.clear.call(this);var a=this.parent.parent;if(!a.mapMode)a.mapMode=!0,a.header.toggle.visible=!1;nokia.mh5.app.controller.updateHistoryEntry()}}},toggle:{control:nokia.mh5.ui.Button,cssClass:"mh5_Button mh5_modeToggle",visible:!1,onClick:function(){var a=this.parent.parent;a.mapMode=!a.mapMode;nokia.mh5.maps.analytics.log({gn:a.mapMode?
"map":"list",c32:a.mapMode?"map toggle":"list toggle"})}}},list:{itemClass:nokia.mh5.components.PlaceListItem,itemsDidChange:function(a){this.constructor.prototype.itemsDidChange.call(this,a);var c=this.parent,f=c.header&&c.header.toggle,a=0<a.length;c.mapMode?f&&!c.details.visible&&(f.visible=a):(this.visible=a,c.noResults.visible=!a)},listeners:{tap:function(a){var a=a.data.item,c=this.parent,f=c.map,d=nokia.mh5.app.controller;if(c.model.selection!==a)c.model.selection=a,f.hideInfoBubble(),f.showInfoBubble(f.getPois(a,
!0));c.model.mapMode=!1;d.updateHistoryEntry();d.pushHistoryEntry("search",c.getNavigationState(),c.getHash());c._showDetailsAfterListFading=c.mapMode=!0;c.openDetailsTracking(a)}}},details:{visibleDidChange:function(a,c){var f=this.parent;if(f&&this!==f._shadowDetails){var d=f.header&&f.header.toggle;d&&(d.visible=!a&&0<f.model.data.length)}nokia.mh5.app.commonLayout.search.details.visibleDidChange.apply(this,arguments)}},incidentDetails:{visibleDidChange:function(a){var c=this.parent,f=c.header&&
c.header.toggle;if(f)f.visible=!a&&0<c.model.data.length;nokia.mh5.app.commonLayout.search.incidentDetails.visibleDidChange.apply(this,arguments)}},build:function(){nokia.mh5.app.commonLayout.search.build.call(this);var a=this.header;if(a&&a.search){var c=a.search.input,f=nokia.mh5.event.add;f(c,"focus",function(){this.map.tracking=!1;a.toggle.visible=!1;if(!this._mapTapEventHandler)this._mapTapEventHandler=function(){c.blur();if(nokia.mh5.platform.android){var a=document.createElement("input");a.setAttribute("type",
"text");document.body.appendChild(a);setTimeout(function(){a.focus();setTimeout(function(){a.setAttribute("style","display:none;");document.body.removeChild(a)},5)},5)}},f(this.map.root,"down",this._mapTapEventHandler)}.bind(this));f(c,"blur",function(){nokia.mh5.event.remove(this.map.root,"down",this._mapTapEventHandler);this._mapTapEventHandler=null;a.toggle.visible=!(!this.model.data.length&&this.mapMode||this.details.visible)}.bind(this))}nokia.mh5.ui.Control.watch(this.model,"data",this,function(a,
b){if(0<a.length)this.list.items=a,a.forEach(function(a){this.map.createPoi(nokia.mh5.utils.place.getCategoryIcon(a),a)}.bind(this));else if(b&&0!==b.length)this.list.items=[],nokia.mh5.components.Traffic.removeNonTrafficPois(this.map)});nokia.mh5.ui.Control.watch(this.model,"selection",this,function(a){a&&this._updateDetails(a)})},visibleDidChange:function(a){nokia.mh5.app.commonLayout.search.visibleDidChange.apply(this,arguments);if(this.mapMode)this.map.visible=a}}};g={};nokia.mh5.extendDeep(g,
nokia.mh5.app.commonLayout);nokia.mh5.extendDeep(g,nokia.mh5.app.phoneLayout);g.controller=nokia.mh5.app.commonLayout.controller;nokia.mh5.app.phoneLayout=g})(nokia.mh5.win);nokia.mh5.provide("nokia.mh5.app.configurator");
(function(){var g=nokia.mh5.resolve,a=nokia.mh5.components.settings,c=Object.prototype.hasOwnProperty,f={search:{searchAdapter:"header.search",placeholder:"header.search.input"}},d=["phone","tablet"],b=["from","to"];nokia.mh5.app.configure=function(e,h){var j,m,p,o,q=e.phoneLayout,v=e.tabletLayout,s=nokia.mh5.extendDeep,u=h.details&&h.details.customContent;h.distanceUnit&&a.set("unitSystem",h.distanceUnit);h.positionDisabled&&nokia.mh5.geolocation.disable();if(h.details&&(delete h.details.customContent,
p=q.search.details,o=v.search.details,s(p,h.details),s(o,h.details),u))p.customContent=[].concat(p.customContent).concat(u),o.customContent=[].concat(o.customContent).concat(u),h.details.customContent=u;if(c.call(h,"search")&&!h.search)q.search.header=v.search.header=null;if(h.map){h.map.schema&&a.set("mapSchema",h.map.schema);p=q.search.map;o=v.search.map;j=q.route.map;m=v.route.map;if(c.call(h.map,"positionButton")&&!h.map.positionButton)p.positionButton=o.positionButton=j.positionButton=m.positionButton=
null;if(c.call(h.map,"settingsButton")&&!h.map.settingsButton)p.settingsButton=o.settingsButton=j.settingsButton=m.settingsButton=null}if(h.route)for(p=0;o=d[p];p++)for(s=0;u=b[s];s++)if(m=h.route[u+"Placeholder"])j=e[o+"Layout"].route.header.route.inputs[u],j.input=j.input||{},j.input.placeholder=m;for(j in f)if(c.call(h,j)&&h[j])for(m in f[j])c.call(h[j],m)&&(p=g(f[j][m],q[j]),o=g(f[j][m],v[j]),p[m]=o[m]=h[j][m])}})(nokia.mh5.win);nokia.mh5.provide("nokia.mh5.app.Application");
(function(){var g=nokia.mh5.i18n,a=nokia.mh5.components.settings;nokia.mh5.app.Application=new nokia.mh5.Class(function(){return{layouts:["phoneLayout","tabletLayout"],phoneLayout:nokia.mh5.app.phoneLayout,tabletLayout:nokia.mh5.app.tabletLayout,constructor:function(a){nokia.mh5.extendDeep(this,a);if(this.appId)nokia.mh5.appId=this.appId;if(this.appCode)nokia.mh5.appCode=this.appCode;if(!nokia.mh5.appId||!nokia.mh5.appCode)throw Error(g("Error.applicationCredential"));this.configuration&&nokia.mh5.app.configure(this,
this.configuration);var f=this.getLayout(),d=nokia.mh5.app.layout=this[f],b=nokia.mh5.app.controller=d.controller;b.manipulateUrl=a.manipulateUrl||!1;b.browserHistory=void 0===this.browserHistory?!0:this.browserHistory;this.hideAddressBar&&(nokia.mh5.dom.addEvent(nokia.mh5.win,"load",nokia.mh5.platform.hideAddressBar,!1),nokia.mh5.dom.addEvent(nokia.mh5.win,"hideAddressBar",nokia.mh5.platform.hideAddressBar,!1),nokia.mh5.dom.addEvent(nokia.mh5.win,"orientationchange",nokia.mh5.platform.hideAddressBar,
!1),nokia.mh5.event.fire(nokia.mh5.win,"orientationchange",{},!0,!0));b.domNode=this.domNode?nokia.mh5.doc.querySelector(this.domNode):nokia.mh5.doc.body;this.bindIsOnline();nokia.mh5.sso.init();nokia.mh5.dom.addClass(b.domNode,"mh5_app");nokia.mh5.dom.addClass(b.domNode,"mh5_"+f);"default"===nokia.mh5.platform.android.browser&&4<=nokia.mh5.platform.android.version&&nokia.mh5.dom.addClass(b.domNode,"mh5_android4");b.setConfiguration(d);if(!d.pages||!d.pages.length)throw Error("no pages are defined in "+
f);if(!~d.pages.indexOf(d.initialPage))d.initialPage=d.pages[0];b.switchTo(d.initialPage,this.startParams||{},{replaceLastHistoryEntry:!0});this.checkForOfflineMaps()},checkForOfflineMaps:function(){function c(b){a.set("hasOfflineMaps",!!b)}var f=nokia.mh5,d=f.app.controller.getMap(),b=d&&d.schema;f.platform.offlineStorageSupported?"normal.day"==b&&!a.current.isOnline&&d.showStoredTiles(c,c):setTimeout(c,0,0)},bindIsOnline:function(){function c(c){a.set("isOnline","online"==c.type)}a.set("isOnline",
nokia.mh5.win.navigator.onLine);nokia.mh5.win.addEventListener("online",c,!1);nokia.mh5.win.addEventListener("offline",c,!1)},getLayout:function(){return 1==this.layouts.length?this.layouts[0]:nokia.mh5.platform.phone?"phoneLayout":"tabletLayout"}}});nokia.mh5.app.embed=function(a){return new nokia.mh5.app.Application(a)}})(nokia.mh5.win);nokia.mh5.provide("nokia.mh5.internals.LoginDialog");
nokia.mh5.internals.LoginDialog=new nokia.mh5.Class(nokia.mh5.ui.Dialog,function(){return{allowScrolling:!0,content:{cssClass:"mh5_LoginDialog",control:nokia.mh5.ui.Control,rootHtmlElementName:"iframe",build:function(){this.root.src="server/sso/login_frame.php"}}}});nokia.mh5.provide("nokia.mh5.xhr");
(function(){nokia.mh5.xhr=function(g){var a=new XMLHttpRequest,c=g.handler,f=g.errorHandler,d=g.uri;a.onreadystatechange=function(){if(4==a.readyState)if(a.status&&(200>a.status||299<a.status))f&&f(Error("nokia.mh5.xhr: Error while loading "+d+": "+a.statusText||"unknown error occured"));else if(c)try{var b;a:switch(g.handleAs){case "JSON":b=a.responseText?JSON.parse(a.responseText):{};break a;case "XML":b=a.responseXML||{};break a;default:b=a.responseText}c(b)}catch(e){f&&f(e)}};a.open(g.method||
"GET",d,!g.sync);g.headers&&nokia.mh5.each(g.headers,function(b,c){a.setRequestHeader(c,b)});if("withCredentials"in a)a.withCredentials=!0;a.send(g.payload||null)}})();nokia.mh5.provide("nokia.mh5.ui.ProgressBar");
nokia.mh5.ui.ProgressBar=new nokia.mh5.Class(nokia.mh5.ui.Control,function(g){return{rootHtmlElementName:"div",innerHTML:"<div class='left'></div><div class='right'></div><div class='overlay'><div><div class='left'></div><div class='right'></div></div></div>",cssClass:"mh5_ProgressBar",progressRatio:0,targetProgressRatio:0,progressIncrement:0.02,refreshTimeout:1E3/30,constructor:function(){g.constructor.apply(this,arguments);this.refresh=this.refresh.bind(this);this.update()},update:function(){this.refresh()},
setProgress:function(a){a=Math.min(1,a);this.targetProgressRatio=a=Math.max(0,a);this.refresh()},refresh:function(){var a=this.targetProgressRatio-this.progressRatio,c;if(a)c=Math.abs(a),c<=this.progressIncrement?this.progressRatio=this.targetProgressRatio:(a/=Math.abs(a),this.progressRatio+=a*this.progressIncrement,setTimeout(this.refresh,this.refreshTimeout)),this.updateProgressDOM()},updateProgressDOM:function(){var a=this.root.children[0],c=this.root.children[1],f=this.root.children[2],d=f.children[0],
b=a.clientWidth+c.clientWidth;f.style.width=this.progressRatio*(a.clientWidth+2*c.clientWidth)+"px";d.style.width=b+"px"}}});var mappings={search:"search",details:"search",route:"route"};
(function(){var g=Math,a=/webkit/i.test(navigator.appVersion)?"webkit":/firefox/i.test(navigator.userAgent)?"Moz":"opera"in window?"O":"",c="WebKitCSSMatrix"in window&&"m11"in new WebKitCSSMatrix,f="ontouchstart"in window,d=a+"Transform"in document.documentElement.style,b=/android/gi.test(navigator.appVersion),e=/iphone|ipad/gi.test(navigator.appVersion),h=/playbook/gi.test(navigator.appVersion),j=e||h,m=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||
window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){return setTimeout(a,1)}}(),p=window.cancelRequestAnimationFrame||window.webkitCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||clearTimeout,o="onorientationchange"in window?"orientationchange":"resize",q=f?"touchstart":"mousedown",v=f?"touchmove":"mousemove",s=f?"touchend":"mouseup",u=f?"touchcancel":"mouseup",D="Moz"==a?"DOMMouseScroll":
"mousewheel",C="translate"+(c?"3d(":"("),B=c?",0)":")",h=function(g,n){var h=this,m;h.wrapper="object"==typeof g?g:document.getElementById(g);h.wrapper.style.overflow="hidden";h.scroller=h.wrapper.children[0];h.options={hScroll:!0,vScroll:!0,bounce:!0,bounceLock:!1,momentum:!0,lockDirection:!0,useTransform:!0,useTransition:!1,checkDOMChanges:!1,hScrollbar:!0,vScrollbar:!0,fixedScrollbar:b,hideScrollbar:e,fadeScrollbar:e&&c,scrollbarClass:"",zoom:!1,zoomMin:1,zoomMax:4,doubleTapZoom:2,wheelAction:"scroll",
snap:!1,snapThreshold:1,onRefresh:null,onBeforeScrollStart:function(a){a.preventDefault()},onScrollStart:null,onBeforeScrollMove:null,onScrollMove:null,onBeforeScrollEnd:null,onScrollEnd:null,onTouchEnd:null,onDestroy:null,onZoomStart:null,onZoom:null,onZoomEnd:null};for(m in n)h.options[m]=n[m];h.options.useTransform=d?h.options.useTransform:!1;h.options.hScrollbar=h.options.hScroll&&h.options.hScrollbar;h.options.vScrollbar=h.options.vScroll&&h.options.vScrollbar;h.options.zoom=h.options.useTransform&&
h.options.zoom;h.options.useTransition=j&&h.options.useTransition;h.scroller.style[a+"TransitionProperty"]=h.options.useTransform?"-"+a.toLowerCase()+"-transform":"top left";h.scroller.style[a+"TransitionDuration"]="0";h.scroller.style[a+"TransformOrigin"]="0 0";h.options.useTransition&&(h.scroller.style[a+"TransitionTimingFunction"]="cubic-bezier(0.33,0.66,0.66,1)");h.options.useTransform?h.scroller.style[a+"Transform"]=C+"0,0"+B:h.scroller.style.cssText+=";position:absolute;top:0;left:0";if(h.options.useTransition)h.options.fixedScrollbar=
!0;h.refresh();h._bind(o,window);h._bind(q);f||(h._bind("mouseout",h.wrapper),h._bind(D));if(h.options.checkDOMChanges)h.checkDOMTime=setInterval(function(){h._checkDOMChanges()},500)};h.prototype={enabled:!0,x:0,y:0,steps:[],scale:1,currPageX:0,currPageY:0,pagesX:[],pagesY:[],aniTime:null,wheelZoomCount:0,handleEvent:function(a){switch(a.type){case q:if(!f&&0!==a.button)break;this._start(a);break;case v:this._move(a);break;case s:case u:this._end(a);break;case o:this._resize();break;case D:this._wheel(a);
break;case "mouseout":this._mouseout(a);break;case "webkitTransitionEnd":this._transitionEnd(a)}},_checkDOMChanges:function(){!this.moved&&!this.zoomed&&!(this.animating||this.scrollerW==this.scroller.offsetWidth*this.scale&&this.scrollerH==this.scroller.offsetHeight*this.scale)&&this.refresh()},_scrollbar:function(b){var c=document,e;if(this[b+"Scrollbar"]){if(!this[b+"ScrollbarWrapper"]){e=c.createElement("div");this.options.scrollbarClass?e.className=this.options.scrollbarClass+b.toUpperCase():
e.style.cssText="position:absolute;z-index:100;"+("h"==b?"height:7px;bottom:1px;left:2px;right:"+(this.vScrollbar?"7":"2")+"px":"width:7px;bottom:"+(this.hScrollbar?"7":"2")+"px;top:2px;right:1px");e.style.cssText+=";pointer-events:none;-"+a+"-transition-property:opacity;-"+a+"-transition-duration:"+(this.options.fadeScrollbar?"350ms":"0")+";overflow:hidden;opacity:"+(this.options.hideScrollbar?"0":"1");this.wrapper.appendChild(e);this[b+"ScrollbarWrapper"]=e;e=c.createElement("div");if(!this.options.scrollbarClass)e.style.cssText=
"position:absolute;z-index:100;background:rgba(0,0,0,0.5);border:1px solid rgba(255,255,255,0.9);-"+a+"-background-clip:padding-box;-"+a+"-box-sizing:border-box;"+("h"==b?"height:100%":"width:100%")+";-"+a+"-border-radius:3px;border-radius:3px";e.style.cssText+=";pointer-events:none;-"+a+"-transition-property:-"+a+"-transform;-"+a+"-transition-timing-function:cubic-bezier(0.33,0.66,0.66,1);-"+a+"-transition-duration:0;-"+a+"-transform:"+C+"0,0"+B;this.options.useTransition&&(e.style.cssText+=";-"+
a+"-transition-timing-function:cubic-bezier(0.33,0.66,0.66,1)");this[b+"ScrollbarWrapper"].appendChild(e);this[b+"ScrollbarIndicator"]=e}"h"==b?(this.hScrollbarSize=this.hScrollbarWrapper.clientWidth,this.hScrollbarIndicatorSize=g.max(g.round(this.hScrollbarSize*this.hScrollbarSize/this.scrollerW),8),this.hScrollbarIndicator.style.width=this.hScrollbarIndicatorSize+"px",this.hScrollbarMaxScroll=this.hScrollbarSize-this.hScrollbarIndicatorSize,this.hScrollbarProp=this.hScrollbarMaxScroll/this.maxScrollX):
(this.vScrollbarSize=this.vScrollbarWrapper.clientHeight,this.vScrollbarIndicatorSize=g.max(g.round(this.vScrollbarSize*this.vScrollbarSize/this.scrollerH),8),this.vScrollbarIndicator.style.height=this.vScrollbarIndicatorSize+"px",this.vScrollbarMaxScroll=this.vScrollbarSize-this.vScrollbarIndicatorSize,this.vScrollbarProp=this.vScrollbarMaxScroll/this.maxScrollY);this._scrollbarPos(b,!0)}else this[b+"ScrollbarWrapper"]&&(d&&(this[b+"ScrollbarIndicator"].style[a+"Transform"]=""),this[b+"ScrollbarWrapper"].parentNode.removeChild(this[b+
"ScrollbarWrapper"]),this[b+"ScrollbarWrapper"]=null,this[b+"ScrollbarIndicator"]=null)},_resize:function(){var a=this;setTimeout(function(){a.refresh()},b?200:0)},_pos:function(b,c){b=this.hScroll?b:0;c=this.vScroll?c:0;this.options.useTransform?this.scroller.style[a+"Transform"]=C+b+"px,"+c+"px"+B+" scale("+this.scale+")":(b=g.round(b),c=g.round(c),this.scroller.style.left=b+"px",this.scroller.style.top=c+"px");this.x=b;this.y=c;this._scrollbarPos("h");this._scrollbarPos("v")},_scrollbarPos:function(b,
c){var d="h"==b?this.x:this.y;if(this[b+"Scrollbar"])d*=this[b+"ScrollbarProp"],0>d?(this.options.fixedScrollbar||(d=this[b+"ScrollbarIndicatorSize"]+g.round(3*d),8>d&&(d=8),this[b+"ScrollbarIndicator"].style["h"==b?"width":"height"]=d+"px"),d=0):d>this[b+"ScrollbarMaxScroll"]&&(this.options.fixedScrollbar?d=this[b+"ScrollbarMaxScroll"]:(d=this[b+"ScrollbarIndicatorSize"]-g.round(3*(d-this[b+"ScrollbarMaxScroll"])),8>d&&(d=8),this[b+"ScrollbarIndicator"].style["h"==b?"width":"height"]=d+"px",d=this[b+
"ScrollbarMaxScroll"]+(this[b+"ScrollbarIndicatorSize"]-d))),this[b+"ScrollbarWrapper"].style[a+"TransitionDelay"]="0",this[b+"ScrollbarWrapper"].style.opacity=c&&this.options.hideScrollbar?"0":"1",this[b+"ScrollbarIndicator"].style[a+"Transform"]=C+("h"==b?d+"px,0":"0,"+d+"px")+B},_start:function(b){var c=f?b.touches[0]:b,d,e;if(this.enabled){this.options.onBeforeScrollStart&&this.options.onBeforeScrollStart.call(this,b);(this.options.useTransition||this.options.zoom)&&this._transitionTime(0);this.zoomed=
this.animating=this.moved=!1;this.dirY=this.dirX=this.absDistY=this.absDistX=this.distY=this.distX=0;if(this.options.zoom&&f&&1<b.touches.length)e=g.abs(b.touches[0].pageX-b.touches[1].pageX),d=g.abs(b.touches[0].pageY-b.touches[1].pageY),this.touchesDistStart=g.sqrt(e*e+d*d),this.originX=g.abs(b.touches[0].pageX+b.touches[1].pageX-2*this.wrapperOffsetLeft)/2-this.x,this.originY=g.abs(b.touches[0].pageY+b.touches[1].pageY-2*this.wrapperOffsetTop)/2-this.y,this.options.onZoomStart&&this.options.onZoomStart.call(this,
b);if(this.options.momentum&&(this.options.useTransform?(d=getComputedStyle(this.scroller,null)[a+"Transform"].replace(/[^0-9-.,]/g,"").split(","),e=1*d[4],d=1*d[5]):(e=1*getComputedStyle(this.scroller,null).left.replace(/[^0-9-]/g,""),d=1*getComputedStyle(this.scroller,null).top.replace(/[^0-9-]/g,"")),e!=this.x||d!=this.y))this.options.useTransition?this._unbind("webkitTransitionEnd"):p(this.aniTime),this.steps=[],this._pos(e,d);this.absStartX=this.x;this.absStartY=this.y;this.startX=this.x;this.startY=
this.y;this.pointX=c.pageX;this.pointY=c.pageY;this.startTime=b.timeStamp||(new Date).getTime();this.options.onScrollStart&&this.options.onScrollStart.call(this,b);this._bind(v);this._bind(s);this._bind(u)}},_move:function(b){var c=f?b.touches[0]:b,d=c.pageX-this.pointX,e=c.pageY-this.pointY,h=this.x+d,j=this.y+e,m=b.timeStamp||(new Date).getTime();this.options.onBeforeScrollMove&&this.options.onBeforeScrollMove.call(this,b);if(this.options.zoom&&f&&1<b.touches.length)h=g.abs(b.touches[0].pageX-b.touches[1].pageX),
j=g.abs(b.touches[0].pageY-b.touches[1].pageY),this.touchesDist=g.sqrt(h*h+j*j),this.zoomed=!0,c=1/this.touchesDistStart*this.touchesDist*this.scale,c<this.options.zoomMin?c=0.5*this.options.zoomMin*Math.pow(2,c/this.options.zoomMin):c>this.options.zoomMax&&(c=2*this.options.zoomMax*Math.pow(0.5,this.options.zoomMax/c)),this.lastScale=c/this.scale,h=this.originX-this.originX*this.lastScale+this.x,j=this.originY-this.originY*this.lastScale+this.y,this.scroller.style[a+"Transform"]=C+h+"px,"+j+"px"+
B+" scale("+c+")",this.options.onZoom&&this.options.onZoom.call(this,b);else{this.pointX=c.pageX;this.pointY=c.pageY;if(0<h||h<this.maxScrollX)h=this.options.bounce?this.x+d/2:0<=h||0<=this.maxScrollX?0:this.maxScrollX;if(0<j||j<this.maxScrollY)j=this.options.bounce?this.y+e/2:0<=j||0<=this.maxScrollY?0:this.maxScrollY;if(6>this.absDistX&&6>this.absDistY)this.distX+=d,this.distY+=e,this.absDistX=g.abs(this.distX),this.absDistY=g.abs(this.distY);else{if(this.options.lockDirection)if(this.absDistX>
this.absDistY+5)j=this.y,e=0;else if(this.absDistY>this.absDistX+5)h=this.x,d=0;this.moved=!0;this._pos(h,j);this.dirX=0<d?-1:0>d?1:0;this.dirY=0<e?-1:0>e?1:0;if(300<m-this.startTime)this.startTime=m,this.startX=this.x,this.startY=this.y;this.options.onScrollMove&&this.options.onScrollMove.call(this,b)}}},_end:function(b){if(!(f&&0!=b.touches.length)){var c=this,d=f?b.changedTouches[0]:b,e,h,j={dist:0,time:0},m={dist:0,time:0},p=(b.timeStamp||(new Date).getTime())-c.startTime,o=c.x,q=c.y;c._unbind(v);
c._unbind(s);c._unbind(u);c.options.onBeforeScrollEnd&&c.options.onBeforeScrollEnd.call(c,b);if(c.zoomed)o=c.scale*c.lastScale,o=Math.max(c.options.zoomMin,o),o=Math.min(c.options.zoomMax,o),c.lastScale=o/c.scale,c.scale=o,c.x=c.originX-c.originX*c.lastScale+c.x,c.y=c.originY-c.originY*c.lastScale+c.y,c.scroller.style[a+"TransitionDuration"]="200ms",c.scroller.style[a+"Transform"]=C+c.x+"px,"+c.y+"px"+B+" scale("+c.scale+")",c.zoomed=!1,c.refresh(),c.options.onZoomEnd&&c.options.onZoomEnd.call(c,
b);else{if(c.moved){if(300>p&&c.options.momentum){j=o?c._momentum(o-c.startX,p,-c.x,c.scrollerW-c.wrapperW+c.x,c.options.bounce?c.wrapperW:0):j;m=q?c._momentum(q-c.startY,p,-c.y,0>c.maxScrollY?c.scrollerH-c.wrapperH+c.y:0,c.options.bounce?c.wrapperH:0):m;o=c.x+j.dist;q=c.y+m.dist;if(0<c.x&&0<o||c.x<c.maxScrollX&&o<c.maxScrollX)j={dist:0,time:0};if(0<c.y&&0<q||c.y<c.maxScrollY&&q<c.maxScrollY)m={dist:0,time:0}}if(j.dist||m.dist){p=g.max(g.max(j.time,m.time),10);if(c.options.snap)j=o-c.absStartX,m=
q-c.absStartY,g.abs(j)<c.options.snapThreshold&&g.abs(m)<c.options.snapThreshold?c.scrollTo(c.absStartX,c.absStartY,200):(snap=c._snap(o,q),o=snap.x,q=snap.y,p=g.max(snap.time,p));c.scrollTo(o,q,p)}else c.options.snap?(j=o-c.absStartX,m=q-c.absStartY,g.abs(j)<c.options.snapThreshold&&g.abs(m)<c.options.snapThreshold?c.scrollTo(c.absStartX,c.absStartY,200):(snap=c._snap(c.x,c.y),(snap.x!=c.x||snap.y!=c.y)&&c.scrollTo(snap.x,snap.y,snap.time))):c._resetPos(200)}else{if(f)c.doubleTapTimer&&c.options.zoom?
(clearTimeout(c.doubleTapTimer),c.doubleTapTimer=null,c.options.onZoomStart&&c.options.onZoomStart.call(c,b),c.zoom(c.pointX,c.pointY,1==c.scale?c.options.doubleTapZoom:1)):c.doubleTapTimer=setTimeout(function(){c.doubleTapTimer=null;for(e=d.target;1!=e.nodeType;)e=e.parentNode;if("SELECT"!=e.tagName&&"INPUT"!=e.tagName&&"TEXTAREA"!=e.tagName)h=document.createEvent("MouseEvents"),h.initMouseEvent("click",!0,!0,b.view,1,d.screenX,d.screenY,d.clientX,d.clientY,b.ctrlKey,b.altKey,b.shiftKey,b.metaKey,
0,null),h._fake=!0,e.dispatchEvent(h)},c.options.zoom?250:0);c._resetPos(200)}c.options.onTouchEnd&&c.options.onTouchEnd.call(c,b)}}},_resetPos:function(b){var c=0<=this.x?0:this.x<this.maxScrollX?this.maxScrollX:this.x,d=0<=this.y||0<this.maxScrollY?0:this.y<this.maxScrollY?this.maxScrollY:this.y;if(c==this.x&&d==this.y){if(this.moved)this.moved=!1,this.options.onScrollEnd&&this.options.onScrollEnd.call(this);if(this.hScrollbar&&this.options.hideScrollbar)"webkit"==a&&(this.hScrollbarWrapper.style[a+
"TransitionDelay"]="300ms"),this.hScrollbarWrapper.style.opacity="0";if(this.vScrollbar&&this.options.hideScrollbar)"webkit"==a&&(this.vScrollbarWrapper.style[a+"TransitionDelay"]="300ms"),this.vScrollbarWrapper.style.opacity="0"}else this.scrollTo(c,d,b||0)},_wheel:function(a){var b=this,c,d;"wheelDeltaX"in a?(c=a.wheelDeltaX/12,d=a.wheelDeltaY/12):c="detail"in a?d=3*-a.detail:d=-a.wheelDelta;if("zoom"==b.options.wheelAction){Math.pow(2,1/3*(d?d/Math.abs(d):0));if(d<b.options.zoomMin)d=b.options.zoomMin;
if(d>b.options.zoomMax)d=b.options.zoomMax;d!=b.scale&&(!b.wheelZoomCount&&b.options.onZoomStart&&b.options.onZoomStart.call(b,a),b.wheelZoomCount++,b.zoom(a.pageX,a.pageY,d,400),setTimeout(function(){b.wheelZoomCount--;!b.wheelZoomCount&&b.options.onZoomEnd&&b.options.onZoomEnd.call(b,a)},400))}else{c=b.x+c;d=b.y+d;if(0<c)c=0;else if(c<b.maxScrollX)c=b.maxScrollX;if(0<d)d=0;else if(d<b.maxScrollY)d=b.maxScrollY;b.scrollTo(c,d,0)}},_mouseout:function(a){var b=a.relatedTarget;if(b)for(;b=b.parentNode;)if(b==
this.wrapper)return;this._end(a)},_transitionEnd:function(a){a.target==this.scroller&&(this._unbind("webkitTransitionEnd"),this._startAni())},_startAni:function(){var a=this,b=a.x,c=a.y,d=(new Date).getTime(),e,f;if(!a.animating)if(a.steps.length){e=a.steps.shift();if(e.x==b&&e.y==c)e.time=0;a.animating=!0;a.moved=!0;a.options.useTransition?(a._transitionTime(e.time),a._pos(e.x,e.y),a.animating=!1,e.time?a._bind("webkitTransitionEnd"):a._resetPos(0)):function I(){var h=(new Date).getTime();if(h>=
d+e.time)a._pos(e.x,e.y),a.animating=!1,a.options.onAnimationEnd&&a.options.onAnimationEnd.call(a),a._startAni();else if(h=(h-d)/e.time-1,f=g.sqrt(1-h*h),h=(e.x-b)*f+b,a._pos(h,(e.y-c)*f+c),a.animating)a.aniTime=m(I)}()}else a._resetPos(400)},_transitionTime:function(b){b+="ms";this.scroller.style[a+"TransitionDuration"]=b;this.hScrollbar&&(this.hScrollbarIndicator.style[a+"TransitionDuration"]=b);this.vScrollbar&&(this.vScrollbarIndicator.style[a+"TransitionDuration"]=b)},_momentum:function(a,b,
c,d,e){var b=g.abs(a)/b,f=b*b/0.0012,h=0,h=0;0<a&&f>c?(c+=e/(6/(6.0E-4*(f/b))),b=b*c/f,f=c):0>a&&f>d&&(d+=e/(6/(6.0E-4*(f/b))),b=b*d/f,f=d);return{dist:f*(0>a?-1:1),time:g.round(b/6.0E-4)}},_offset:function(a){for(var b=-a.offsetLeft,c=-a.offsetTop;a=a.offsetParent;)b-=a.offsetLeft,c-=a.offsetTop;a!=this.wrapper&&(b*=this.scale,c*=this.scale);return{left:b,top:c}},_snap:function(a,b){var c,d,e;e=this.pagesX.length-1;for(c=0,d=this.pagesX.length;c<d;c++)if(a>=this.pagesX[c]){e=c;break}e==this.currPageX&&
0<e&&0>this.dirX&&e--;a=this.pagesX[e];d=(d=g.abs(a-this.pagesX[this.currPageX]))?500*(g.abs(this.x-a)/d):0;this.currPageX=e;e=this.pagesY.length-1;for(c=0;c<e;c++)if(b>=this.pagesY[c]){e=c;break}e==this.currPageY&&0<e&&0>this.dirY&&e--;b=this.pagesY[e];c=(c=g.abs(b-this.pagesY[this.currPageY]))?500*(g.abs(this.y-b)/c):0;this.currPageY=e;e=g.round(g.max(d,c))||200;return{x:a,y:b,time:e}},_bind:function(a,b){(b||this.scroller).addEventListener(a,this,!0)},_unbind:function(a,b){(b||this.scroller).removeEventListener(a,
this,!0)},destroy:function(){this.scroller.style[a+"Transform"]="";this.vScrollbar=this.hScrollbar=!1;this._scrollbar("h");this._scrollbar("v");this._unbind(o,window);this._unbind(q);this._unbind(v);this._unbind(s);this._unbind(u);this.options.hasTouch&&(this._unbind("mouseout",this.wrapper),this._unbind(D));this.options.useTransition&&this._unbind("webkitTransitionEnd");this.options.checkDOMChanges&&clearInterval(this.checkDOMTime);this.options.onDestroy&&this.options.onDestroy.call(this)},refresh:function(){var b,
c=0,d=0;if(this.scale<this.options.zoomMin)this.scale=this.options.zoomMin;this.wrapperW=this.wrapper.clientWidth||1;this.wrapperH=this.wrapper.clientHeight||1;this.scrollerW=g.round(this.scroller.offsetWidth*this.scale);this.scrollerH=g.round(this.scroller.offsetHeight*this.scale);this.maxScrollX=this.wrapperW-this.scrollerW;this.maxScrollY=this.wrapperH-this.scrollerH;this.dirY=this.dirX=0;this.hScroll=this.options.hScroll&&0>this.maxScrollX;this.vScroll=this.options.vScroll&&(!this.options.bounceLock&&
!this.hScroll||this.scrollerH>this.wrapperH);this.hScrollbar=this.hScroll&&this.options.hScrollbar;this.vScrollbar=this.vScroll&&this.options.vScrollbar&&this.scrollerH>this.wrapperH;b=this._offset(this.wrapper);this.wrapperOffsetLeft=-b.left;this.wrapperOffsetTop=-b.top;if("string"==typeof this.options.snap){this.pagesX=[];this.pagesY=[];els=this.scroller.querySelectorAll(this.options.snap);for(i=0,l=els.length;i<l;i++)c=this._offset(els[i]),c.left+=this.wrapperOffsetLeft,c.top+=this.wrapperOffsetTop,
this.pagesX[i]=c.left<this.maxScrollX?this.maxScrollX:c.left*this.scale,this.pagesY[i]=c.top<this.maxScrollY?this.maxScrollY:c.top*this.scale}else if(this.options.snap){for(this.pagesX=[];c>=this.maxScrollX;)this.pagesX[d]=c,c-=this.wrapperW,d++;this.maxScrollX%this.wrapperW&&(this.pagesX[this.pagesX.length]=this.maxScrollX-this.pagesX[this.pagesX.length-1]+this.pagesX[this.pagesX.length-1]);d=c=0;for(this.pagesY=[];c>=this.maxScrollY;)this.pagesY[d]=c,c-=this.wrapperH,d++;this.maxScrollY%this.wrapperH&&
(this.pagesY[this.pagesY.length]=this.maxScrollY-this.pagesY[this.pagesY.length-1]+this.pagesY[this.pagesY.length-1])}this._scrollbar("h");this._scrollbar("v");this.zoomed||(this.scroller.style[a+"TransitionDuration"]="0",this._resetPos(200))},scrollTo:function(a,b,c,d){var e=a;this.stop();e.length||(e=[{x:a,y:b,time:c,relative:d}]);for(a=0,b=e.length;a<b;a++){if(e[a].relative)e[a].x=this.x-e[a].x,e[a].y=this.y-e[a].y;this.steps.push({x:e[a].x,y:e[a].y,time:e[a].time||0})}this._startAni()},scrollToElement:function(a,
b){var c;if(a=a.nodeType?a:this.scroller.querySelector(a))c=this._offset(a),c.left+=this.wrapperOffsetLeft,c.top+=this.wrapperOffsetTop,c.left=0<c.left?0:c.left<this.maxScrollX?this.maxScrollX:c.left,c.top=0<c.top?0:c.top<this.maxScrollY?this.maxScrollY:c.top,b=void 0===b?g.max(2*g.abs(c.left),2*g.abs(c.top)):b,this.scrollTo(c.left,c.top,b)},scrollToPage:function(a,b,c){if(this.options.snap)a="next"==a?this.currPageX+1:"prev"==a?this.currPageX-1:a,b="next"==b?this.currPageY+1:"prev"==b?this.currPageY-
1:b,a=0>a?0:a>this.pagesX.length-1?this.pagesX.length-1:a,b=0>b?0:b>this.pagesY.length-1?this.pagesY.length-1:b,this.currPageX=a,this.currPageY=b,a=this.pagesX[a],b=this.pagesY[b];else{a*=-this.wrapperW;b*=-this.wrapperH;if(a<this.maxScrollX)a=this.maxScrollX;if(b<this.maxScrollY)b=this.maxScrollY}this.scrollTo(a,b,c||400)},disable:function(){this.stop();this._resetPos(0);this.enabled=!1;this._unbind(v);this._unbind(s);this._unbind(u)},enable:function(){this.enabled=!0},stop:function(){this.options.useTransition?
this._unbind("webkitTransitionEnd"):p(this.aniTime);this.steps=[];this.animating=this.moved=!1},zoom:function(b,c,d,e){var f=d/this.scale;if(this.options.useTransform)this.zoomed=!0,e=void 0===e?200:e,b=b-this.wrapperOffsetLeft-this.x,c=c-this.wrapperOffsetTop-this.y,this.x=b-b*f+this.x,this.y=c-c*f+this.y,this.scale=d,this.refresh(),this.x=0<this.x?0:this.x<this.maxScrollX?this.maxScrollX:this.x,this.y=0<this.y?0:this.y<this.maxScrollY?this.maxScrollY:this.y,this.scroller.style[a+"TransitionDuration"]=
e+"ms",this.scroller.style[a+"Transform"]=C+this.x+"px,"+this.y+"px"+B+" scale("+d+")",this.zoomed=!1},isReady:function(){return!this.moved&&!this.zoomed&&!this.animating}};"undefined"!==typeof exports?exports.iScroll=h:window.iScroll=h})();